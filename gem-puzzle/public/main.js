(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.boardWidth=40.8,this.marginSize=.1,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){let t="";const e=this.boardWidth+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let h=0;h<this.size;h+=1){i=this.arr[s][h];const n=this.arr[s][h]?"cell":"cell empty",o=!!this.arr[s][h],a=this.bgPosArr[i-1];r+=1,t+=`<div style='width:${this.cellSize}rem; height:${this.cellSize}rem; order:${r}; background-position: ${a}; background-size: ${e};' id='cell-${i}' class='${n}' draggable="${o}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s)}createBoard(){this.arr=[],this.bgPosArr=[],this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?(this.arr[t][e]=t*this.size+e+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*e)}% ${Math.round(100/(this.size-1)*t)}%`)):this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}checkWin(){const t=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?t[e][i]=e*this.size+i+1:t[e][i]=0}for(let e=0;e<this.size;e+=1)for(let i=0;i<this.size;i+=1)if(e+i!==2*(this.size-1)&&t[e][i]!==this.arr[e][i])return!1;return!0}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation()):this.emptyY-i>0&&(this.direction="right",this.moveAnimation()),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(document.querySelector(".board").innerHTML+=`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов`)}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,void(this.emptyY=i)}}init(){this.history=[],this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),this.removeBoard(),this.createBoard(),this.shuffle(),this.renderBoard(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}},i=document.createElement("header");i.classList.add("header"),i.innerHTML='<h1 class="heading">gem puzzle</h1>',document.body.appendChild(i);const s=document.createElement("div");s.classList.add("menu"),s.innerHTML='  \n  <div class="settings">\n    <button class="new-game btn">New</button>\n    <button class="save btn">Save</button>\n    <button class="load btn">Load</button>\n    <label for="fieldSize">Field size:</label>\n    <select id="fieldSize">\n      <option value="3">3</option>\n      <option selected="selected" value="4">4</option>\n      <option value="5">5</option>\n      <option value="6">6</option>\n      <option value="7">7</option>\n      <option value="8">8</option>\n    </select>\n  </div>\n  <div class="counters">\n    <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n    <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  </div>',document.body.appendChild(s),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({bgPosition:t.bgPosArr,history:t.history,size:t.size,boardTable:t.arr,time:e.currentTime,moves:t.movesCounter,zero:[t.emptyX,t.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{bgPosition:i,history:s,size:r,boardTable:h,time:n,moves:o,zero:a}=JSON.parse(localStorage.getItem("gameSave"));t.bgPosArr=i,t.history=s,t.size=r,e.currentTime=n,t.movesCounter=o,t.arr=h,t.load(),e.load(),[t.emptyX,t.emptyY]=a})),document.getElementById("fieldSize").addEventListener("change",(()=>{t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFuaW1hdGlvblRpbWUiLCJib2FyZFdpZHRoIiwibWFyZ2luU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJhcnIiLCJFcnJvciIsInB1c2giLCJpIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibW92ZSIsImNlbGxOdW1iZXIiLCJvcmRlciIsImoiLCJjbGFzc05hbWUiLCJkcmFnZ2FibGUiLCJiR3BvcyIsImJnUG9zQXJyIiwiY2VsbFNpemUiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInN0eWxlIiwid2lkdGgiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsInJvdW5kIiwicmVtUGVyVGljayIsInRpbWVQYXNzZWQiLCJlIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lciIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImRyYXciLCJ3aW4iLCJudW1iZXIiLCJsZW5ndGgiLCJhYnMiLCJtb3Zlc0NvdW50ZXIiLCJxdWVyeVNlbGVjdG9yIiwiemVybyIsIm1vdmVBbmltYXRpb24iLCJzZXRUaW1lb3V0IiwidGVtcCIsImNoZWNrV2luIiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwiY3JlYXRlQm9hcmQiLCJzaHVmZmxlIiwicmVuZGVyQm9hcmQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiY3VycmVudFRpbWUiLCJ0aW1lIiwic2VjVG9NaW5BbmRTZWMiLCJtaW51dGVzIiwic2VjIiwicmVuZGVyVGltZXIiLCJ0aW1lclN0b3AiLCJjYWxjQ3VycmVudFRpbWUiLCJoZWFkZXIiLCJtZW51IiwiaW5pdCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYmdQb3NpdGlvbiIsImJvYXJkVGFibGUiLCJtb3ZlcyIsInBhcnNlIiwiZ2V0SXRlbSIsImxvYWQiXSwibWFwcGluZ3MiOiJtQkFHQSxNQUFNQSxFQUFRLElDSEMsTUFDYixjQUNFQyxLQUFLQyxRQUFVLEdBQ2ZELEtBQUtFLEtBQU8sRUFDWkYsS0FBS0csT0FBUyxFQUNkSCxLQUFLSSxPQUFTLEVBQ2RKLEtBQUtLLGNBQWdCLElBQ3JCTCxLQUFLTSxXQUFhLEtBQ2xCTixLQUFLTyxXQUFhLEdBQ2xCUCxLQUFLUSxZQUFjLEtBQ2pCQyxTQUFTQyxpQkFBaUIsVUFBVUMsU0FBU0MsSUFDM0NILFNBQVNJLEtBQUtDLFlBQVlGLE9BS2hDLEtBQUtHLEdBQ0gsT0FBUUEsR0FDTixJQUFLLEtBQ0hmLEtBQUtnQixJQUFJaEIsS0FBS0csUUFBUUgsS0FBS0ksUUFBVUosS0FBS2dCLElBQUloQixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQ3BFSixLQUFLZ0IsSUFBSWhCLEtBQUtHLE9BQVMsR0FBR0gsS0FBS0ksUUFBVSxFQUN6Q0osS0FBS0csUUFBVSxFQUNmLE1BQ0YsSUFBSyxPQUNISCxLQUFLZ0IsSUFBSWhCLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtnQixJQUFJaEIsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS2dCLElBQUloQixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQVUsRUFDekNKLEtBQUtHLFFBQVUsRUFDZixN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SUFDbEJrRSxLQUFNakMsRUFBTWdDLFlBQ1ppQixNQUFPbkcsRUFBTTBELGFBQ2JFLEtBQU0sQ0FBRTVELEVBQU1JLE9BQVFKLEVBQU1LLGNBS2xDSyxTQUFTaUQsY0FBYyxTQUFTYyxpQkFBaUIsU0FBUyxLQUN4RCxNQUFNLFdBQUV3QixFQUFVLFFBQUUvRixFQUFPLEtBQUVDLEVBQUksV0FBRStGLEVBQVUsS0FBRWYsRUFBSSxNQUFFZ0IsRUFBSyxLQUFFdkMsR0FBU21DLEtBQUtLLE1BQ3hFUCxhQUFhUSxRQUFRLGFBRXZCckcsRUFBTStCLFNBQVdrRSxFQUNqQmpHLEVBQU1FLFFBQVVBLEVBQ2hCRixFQUFNRyxLQUFPQSxFQUNiK0MsRUFBTWdDLFlBQWNDLEVBQ3BCbkYsRUFBTTBELGFBQWV5QyxFQUNyQm5HLEVBQU1pQixJQUFNaUYsRUFDWmxHLEVBQU1zRyxPQUNOcEQsRUFBTW9ELFFBQ0p0RyxFQUFNSSxPQUFRSixFQUFNSyxRQUFXdUQsS0FHbkNsRCxTQUFTdUQsZUFBZSxhQUFhUSxpQkFBaUIsVUFBVSxLQUM5RHpFLEVBQU00RixPQUNOMUMsRUFBTTBDLFciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb2FyZCBmcm9tICcuL0JvYXJkLmpzJztcclxuaW1wb3J0IFRpbWVyIGZyb20gJy4vVGltZXIuanMnO1xyXG5cclxuY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoKTtcclxuY29uc3QgdGltZXIgPSBuZXcgVGltZXIoKTtcclxuXHJcbmNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hlYWRlcicpO1xyXG5oZWFkZXIuY2xhc3NMaXN0LmFkZCgnaGVhZGVyJyk7XHJcbmhlYWRlci5pbm5lckhUTUwgPSAnPGgxIGNsYXNzPVwiaGVhZGluZ1wiPmdlbSBwdXp6bGU8L2gxPic7XHJcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcclxuXHJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxubWVudS5jbGFzc0xpc3QuYWRkKCdtZW51Jyk7XHJcblxyXG5tZW51LmlubmVySFRNTCA9IGAgIFxyXG4gIDxkaXYgY2xhc3M9XCJzZXR0aW5nc1wiPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cIm5ldy1nYW1lIGJ0blwiPk5ldzwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cInNhdmUgYnRuXCI+U2F2ZTwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cImxvYWQgYnRuXCI+TG9hZDwvYnV0dG9uPlxyXG4gICAgPGxhYmVsIGZvcj1cImZpZWxkU2l6ZVwiPkZpZWxkIHNpemU6PC9sYWJlbD5cclxuICAgIDxzZWxlY3QgaWQ9XCJmaWVsZFNpemVcIj5cclxuICAgICAgPG9wdGlvbiB2YWx1ZT1cIjNcIj4zPC9vcHRpb24+XHJcbiAgICAgIDxvcHRpb24gc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiIHZhbHVlPVwiNFwiPjQ8L29wdGlvbj5cclxuICAgICAgPG9wdGlvbiB2YWx1ZT1cIjVcIj41PC9vcHRpb24+XHJcbiAgICAgIDxvcHRpb24gdmFsdWU9XCI2XCI+Njwvb3B0aW9uPlxyXG4gICAgICA8b3B0aW9uIHZhbHVlPVwiN1wiPjc8L29wdGlvbj5cclxuICAgICAgPG9wdGlvbiB2YWx1ZT1cIjhcIj44PC9vcHRpb24+XHJcbiAgICA8L3NlbGVjdD5cclxuICA8L2Rpdj5cclxuICA8ZGl2IGNsYXNzPVwiY291bnRlcnNcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wOjAwPC9zcGFuPjwvZGl2PlxyXG4gICAgPGRpdiBjbGFzcz1cIm1vdmVzXCI+PHNwYW4+TW92ZXM6PC9zcGFuPjxzcGFuIGNsYXNzPVwibW92ZVwiPjA8L3NwYW4+PC9kaXY+XHJcbiAgPC9kaXY+YDtcclxuXHJcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWVudSk7XHJcblxyXG5ib2FyZC5pbml0KCk7XHJcbnRpbWVyLmluaXQoKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctZ2FtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcclxuICAgICdnYW1lU2F2ZScsXHJcbiAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGJnUG9zaXRpb246IGJvYXJkLmJnUG9zQXJyLFxyXG4gICAgICBoaXN0b3J5OiBib2FyZC5oaXN0b3J5LFxyXG4gICAgICBzaXplOiBib2FyZC5zaXplLFxyXG4gICAgICBib2FyZFRhYmxlOiBib2FyZC5hcnIsXHJcbiAgICAgIHRpbWU6IHRpbWVyLmN1cnJlbnRUaW1lLFxyXG4gICAgICBtb3ZlczogYm9hcmQubW92ZXNDb3VudGVyLFxyXG4gICAgICB6ZXJvOiBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF1cclxuICAgIH0pXHJcbiAgKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGNvbnN0IHsgYmdQb3NpdGlvbiwgaGlzdG9yeSwgc2l6ZSwgYm9hcmRUYWJsZSwgdGltZSwgbW92ZXMsIHplcm8gfSA9IEpTT04ucGFyc2UoXHJcbiAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2FtZVNhdmUnKVxyXG4gICk7XHJcbiAgYm9hcmQuYmdQb3NBcnIgPSBiZ1Bvc2l0aW9uO1xyXG4gIGJvYXJkLmhpc3RvcnkgPSBoaXN0b3J5O1xyXG4gIGJvYXJkLnNpemUgPSBzaXplO1xyXG4gIHRpbWVyLmN1cnJlbnRUaW1lID0gdGltZTtcclxuICBib2FyZC5tb3Zlc0NvdW50ZXIgPSBtb3ZlcztcclxuICBib2FyZC5hcnIgPSBib2FyZFRhYmxlO1xyXG4gIGJvYXJkLmxvYWQoKTtcclxuICB0aW1lci5sb2FkKCk7XHJcbiAgWyBib2FyZC5lbXB0eVgsIGJvYXJkLmVtcHR5WSBdID0gemVybztcclxufSk7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcbn0pO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBCb2FyZCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMuc2l6ZSA9IDQ7XHJcbiAgICB0aGlzLmVtcHR5WCA9IDA7XHJcbiAgICB0aGlzLmVtcHR5WSA9IDA7XHJcbiAgICB0aGlzLmFuaW1hdGlvblRpbWUgPSA0MDA7XHJcbiAgICB0aGlzLmJvYXJkV2lkdGggPSA0MC44O1xyXG4gICAgdGhpcy5tYXJnaW5TaXplID0gMC4xO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCA9ICgpID0+IHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkJykuZm9yRWFjaCgoZWxlbSkgPT4ge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVkgLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2h1ZmZsZSgpIHtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplICoqIDM7IGkgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIGxldCBib2FyZCA9ICcnO1xyXG4gICAgY29uc3QgYm9hcmRXaWR0aCA9IGAke3RoaXMuYm9hcmRXaWR0aH1yZW1gO1xyXG4gICAgbGV0IGNlbGxOdW1iZXI7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIG9yZGVyID0gMTsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBjZWxsTnVtYmVyID0gdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5hcnJbaV1bal0gPyAnY2VsbCcgOiAnY2VsbCBlbXB0eSc7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlID0gISF0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBiR3BvcyA9IHRoaXMuYmdQb3NBcnJbY2VsbE51bWJlciAtIDFdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcblxyXG4gICAgICAgIGJvYXJkICs9IGA8ZGl2IHN0eWxlPSd3aWR0aDoke3RoaXMuY2VsbFNpemV9cmVtOyBoZWlnaHQ6JHt0aGlzXHJcbiAgICAgICAgICAuY2VsbFNpemV9cmVtOyBvcmRlcjoke29yZGVyfTsgYmFja2dyb3VuZC1wb3NpdGlvbjogJHtiR3Bvc307IGJhY2tncm91bmQtc2l6ZTogJHtib2FyZFdpZHRofTsnIGlkPSdjZWxsLSR7Y2VsbE51bWJlcn0nIGNsYXNzPScke2NsYXNzTmFtZX0nIGRyYWdnYWJsZT1cIiR7ZHJhZ2dhYmxlfVwiPiR7Y2VsbE51bWJlcn08L2Rpdj5gO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdib2FyZCcpO1xyXG4gICAgZWxlbWVudC5zdHlsZS53aWR0aCA9IGJvYXJkV2lkdGg7XHJcbiAgICBlbGVtZW50LmlubmVySFRNTCA9IGJvYXJkO1xyXG5cclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIHRoaXMuYXJyID0gW107XHJcbiAgICB0aGlzLmJnUG9zQXJyID0gW107XHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHRoaXMuYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgICAgdGhpcy5iZ1Bvc0Fyci5wdXNoKFxyXG4gICAgICAgICAgICBgJHtNYXRoLnJvdW5kKDEwMCAvICh0aGlzLnNpemUgLSAxKSAqIGopfSUgJHtNYXRoLnJvdW5kKDEwMCAvICh0aGlzLnNpemUgLSAxKSAqIGkpfSVgXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcmVtUGVyVGljayA9IHRoaXMuY2VsbFNpemUgLyB0aGlzLmFuaW1hdGlvblRpbWUgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIGNoZWNrV2luKCkge1xyXG4gICAgY29uc3Qgd2luID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHdpbltpXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICB3aW5baV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHdpbltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBpZiAod2luW2ldW2pdICE9PSB0aGlzLmFycltpXVtqXSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgc3dhcChudW1iZXIpIHtcclxuICAgIGlmICh0aGlzLmluQW5pbWF0aW9uKSByZXR1cm47XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFyci5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYXJyW2ldLmxlbmd0aDsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXJyW2ldW2pdID09PSBudW1iZXIpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlYIC0gaSkgPD0gMSAmJiB0aGlzLmVtcHR5WSAtIGogPT09IDApIHx8XHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WSAtIGopIDw9IDEgJiYgdGhpcy5lbXB0eVggLSBpID09PSAwKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIE1vdmUgY291bnRlclxyXG4gICAgICAgICAgICB0aGlzLm1vdmVzQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgemVybyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXX1gKTtcclxuICAgICAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFycltpXVtqXX1gKTtcclxuXHJcbiAgICAgICAgICAgIC8vICBmaW5kIHdoZXJlIGFyZSB3ZSBtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYIC0gaSA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICd1cCc7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVggLSBpID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2Rvd24nO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlZIC0gaiA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gemVyby5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB6ZXJvLnN0eWxlLm9yZGVyID0gdGhpcy5lLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS5vcmRlciA9IHRlbXA7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYID09PSB0aGlzLmVtcHR5WSAmJiB0aGlzLmVtcHR5WSA9PT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICAgICAgICAgICcuYm9hcmQnXHJcbiAgICAgICAgICAgICAgICAgICkuaW5uZXJIVE1MICs9IGDQo9GA0LAhINCS0Ysg0YDQtdGI0LjQu9C4INCz0L7Qu9C+0LLQvtC70L7QvNC60YMg0LfQsCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJylcclxuICAgICAgICAgICAgICAgICAgICAuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyYDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcblxyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXNcclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSAwO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuICAgIHRoaXMuc2l6ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS52YWx1ZTtcclxuXHJcbiAgICB0aGlzLmNlbGxTaXplID0gcGFyc2VGbG9hdCh0aGlzLmJvYXJkV2lkdGggLyB0aGlzLnNpemUgLSAyICogdGhpcy5tYXJnaW5TaXplKS50b0ZpeGVkKDMpO1xyXG5cclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IHBhcnNlRmxvYXQodGhpcy5ib2FyZFdpZHRoIC8gdGhpcy5zaXplIC0gMiAqIHRoaXMubWFyZ2luU2l6ZSkudG9GaXhlZCgzKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XHJcbiAgICAvLyB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gIH1cclxuXHJcbiAgY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4gICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IDE7XHJcbiAgICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIH0sIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgc2VjVG9NaW5BbmRTZWMoKSB7XHJcbiAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MCk7XHJcblxyXG4gICAgdGhpcy5zZWMgPSAodGhpcy5jdXJyZW50VGltZSAlIDYwKS50b0ZpeGVkKDApO1xyXG4gICAgdGhpcy50aW1lciA9IGAke3RoaXMubWludXRlc306JHt0aGlzLnNlYyA8IDEwID8gJzAnIDogJyd9JHt0aGlzLnNlY31gO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJTdG9wKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWUpO1xyXG4gICAgdGhpcy50aW1lciA9ICcwOjAwJztcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclRpbWVyKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKS5pbm5lckhUTUwgPSB0aGlzLnRpbWVyO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbnVsbDtcclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuXHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==