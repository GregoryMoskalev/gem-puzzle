(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.arr=[],this.movesCounter=null,this.animationTime=400,this.cellSize=104,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter;let t,e="";for(let s=0,i=1;s<this.size;s+=1)for(let r=0;r<this.size;r+=1){t=this.arr[s][r];const h=this.arr[s][r]?"cell":"cell empty",a=!!this.arr[s][r];i+=1,e+=`<div style='order:${i};' id='cell-${t}' class='${h}' draggable="${a}">${t}</div>`}const s=document.createElement("div");s.classList.add("board"),s.innerHTML=e,document.body.appendChild(s)}createBoard(){this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}px)`;break;case"down":this.e.style.transform=`translate( 0, ${t}px)`;break;case"left":this.e.style.transform=`translate( ${-t}px, 0)`;break;case"right":this.e.style.transform=`translate( ${t}px, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let s=0;s<this.arr[e].length;s+=1)if(this.arr[e][s]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-s==0||Math.abs(this.emptyY-s)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][s]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-s<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-s>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform=""}),this.animationTime),[this.arr[e][s],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][s]],this.emptyX=e,this.emptyY=s,void console.table(this.arr)}}init(){this.removeBoard(),this.createBoard(),this.shuffle(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=document.createElement("header");e.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <div class="timer"><span>Timer:</span><span class="time">0</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n</header>',document.body.appendChild(e),t.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvYm9hcmQuanMiXSwibmFtZXMiOlsiYm9hcmQiLCJ0aGlzIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhcnIiLCJtb3Zlc0NvdW50ZXIiLCJhbmltYXRpb25UaW1lIiwiY2VsbFNpemUiLCJyZW1vdmVCb2FyZCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJlbGVtIiwiYm9keSIsInJlbW92ZUNoaWxkIiwiZGlyZWN0aW9uIiwiRXJyb3IiLCJwdXNoIiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1vdmUiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiY2VsbE51bWJlciIsIm9yZGVyIiwiaiIsImNsYXNzTmFtZSIsImRyYWdnYWJsZSIsImVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJweFBlclRpY2siLCJ0aW1lUGFzc2VkIiwiZSIsInN0eWxlIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lciIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImRyYXciLCJudW1iZXIiLCJsZW5ndGgiLCJhYnMiLCJ6ZXJvIiwiY29uc29sZSIsImxvZyIsIm1vdmVBbmltYXRpb24iLCJzZXRUaW1lb3V0IiwidGVtcCIsInRhYmxlIiwiY3JlYXRlQm9hcmQiLCJzaHVmZmxlIiwicmVuZGVyQm9hcmQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiaGVhZGVyIiwiaW5pdCJdLCJtYXBwaW5ncyI6Im1CQUdBLE1BQU1BLEVBQVEsSUNIQyxN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Ty9DLFVBQVksNk9BT25CZixTQUFTSSxLQUFLcUIsWUFBWXFDLEdBRTFCekUsRUFBTTBFLE9BRU4vRCxTQUFTYyxjQUFjLGFBQWF1QyxpQkFBaUIsU0FBUyxLQUM1RGhFLEVBQU0wRSxXIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQm9hcmQgZnJvbSAnLi9ib2FyZC5qcyc7XHJcbi8vIGltcG9ydCBUaW1lciBmcm9tICcuL3RpbWVyLmpzJztcclxuXHJcbmNvbnN0IGJvYXJkID0gbmV3IEJvYXJkKCk7XHJcblxyXG5jb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoZWFkZXInKTtcclxuXHJcbmhlYWRlci5pbm5lckhUTUwgPSBgICBcclxuPGhlYWRlciBjbGFzcz1cImhlYWRlclwiPlxyXG4gIDxidXR0b24gY2xhc3M9XCJuZXctZ2FtZVwiPk5ldyBnYW1lPC9idXR0b24+XHJcbiAgPGRpdiBjbGFzcz1cInRpbWVyXCI+PHNwYW4+VGltZXI6PC9zcGFuPjxzcGFuIGNsYXNzPVwidGltZVwiPjA8L3NwYW4+PC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cIm1vdmVzXCI+PHNwYW4+TW92ZXM6PC9zcGFuPjxzcGFuIGNsYXNzPVwibW92ZVwiPjA8L3NwYW4+PC9kaXY+XHJcbjwvaGVhZGVyPmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlYWRlcik7XHJcblxyXG5ib2FyZC5pbml0KCk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LWdhbWUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcbn0pO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBCb2FyZCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMuc2l6ZSA9IDQ7XHJcbiAgICB0aGlzLmVtcHR5WCA9IDA7XHJcbiAgICB0aGlzLmVtcHR5WSA9IDA7XHJcbiAgICB0aGlzLmFyciA9IFtdO1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSBudWxsO1xyXG4gICAgdGhpcy5hbmltYXRpb25UaW1lID0gNDAwO1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IDEwNDtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZCcpLmZvckVhY2goKGVsZW0pID0+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBsZXQgc2l6ZSA9IDQ7XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVkgLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2h1ZmZsZSgpIHtcclxuICAgIC8vIHRoaXMuZW1wdHlYID0gc2l6ZSAtIDE7XHJcbiAgICAvLyB0aGlzLmVtcHR5WSA9IHNpemUgLSAxO1xyXG4gICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemUgKiogMzsgaSArPSAxKSB7XHJcbiAgICAgIHN3aXRjaCAoTWF0aC5mbG9vcig0ICogTWF0aC5yYW5kb20oKSkpIHtcclxuICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVggIT09IDApIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgVVBcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgndXAnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBSSUdIVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVggIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgRE9XTlxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2Rvd24nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgndXAnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlZICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIExFRlRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdsZWZ0Jyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBSSUdIVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGkgLT0gMTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckJvYXJkKCkge1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSAwO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICBsZXQgYm9hcmQgPSAnJztcclxuICAgIGxldCBjZWxsTnVtYmVyO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwLCBvcmRlciA9IDE7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgY2VsbE51bWJlciA9IHRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuYXJyW2ldW2pdID8gJ2NlbGwnIDogJ2NlbGwgZW1wdHknO1xyXG4gICAgICAgIGNvbnN0IGRyYWdnYWJsZSA9ICEhdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgb3JkZXIgKz0gMTtcclxuICAgICAgICBib2FyZCArPSBgPGRpdiBzdHlsZT0nb3JkZXI6JHtvcmRlcn07JyBpZD0nY2VsbC0ke2NlbGxOdW1iZXJ9JyBjbGFzcz0nJHtjbGFzc05hbWV9JyBkcmFnZ2FibGU9XCIke2RyYWdnYWJsZX1cIj4ke2NlbGxOdW1iZXJ9PC9kaXY+YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcclxuXHJcbiAgICBlbGVtZW50LmlubmVySFRNTCA9IGJvYXJkO1xyXG5cclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIHRoaXMuZW1wdHlYID0gdGhpcy5zaXplIC0gMTtcclxuICAgIHRoaXMuZW1wdHlZID0gdGhpcy5zaXplIC0gMTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgdGhpcy5hcnJbaV0gPSBbXTtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGlmIChpICsgaiAhPT0gKHRoaXMuc2l6ZSAtIDEpICogMikge1xyXG4gICAgICAgICAgdGhpcy5hcnJbaV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRyYXcoKSB7XHJcbiAgICBjb25zdCBweFBlclRpY2sgPSB0aGlzLmNlbGxTaXplIC8gdGhpcy5hbmltYXRpb25UaW1lICogdGhpcy50aW1lUGFzc2VkO1xyXG4gICAgc3dpdGNoICh0aGlzLmRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7LXB4UGVyVGlja31weClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHtweFBlclRpY2t9cHgpYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXB4UGVyVGlja31weCwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7cHhQZXJUaWNrfXB4LCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVBbmltYXRpb24oKSB7XHJcbiAgICB0aGlzLmluQW5pbWF0aW9uID0gdHJ1ZTtcclxuICAgIHRoaXMuc3RhcnQgPSBEYXRlLm5vdygpO1xyXG5cclxuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMudGltZVBhc3NlZCA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0O1xyXG5cclxuICAgICAgaWYgKHRoaXMudGltZVBhc3NlZCA+PSB0aGlzLmFuaW1hdGlvblRpbWUpIHtcclxuICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpO1xyXG4gICAgICAgIHRoaXMuaW5BbmltYXRpb24gPSBmYWxzZTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfSwgMjApO1xyXG4gIH1cclxuXHJcbiAgc3dhcChudW1iZXIpIHtcclxuICAgIGlmICh0aGlzLmluQW5pbWF0aW9uKSByZXR1cm47XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFyci5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYXJyW2ldLmxlbmd0aDsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXJyW2ldW2pdID09PSBudW1iZXIpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlYIC0gaSkgPD0gMSAmJiB0aGlzLmVtcHR5WSAtIGogPT09IDApIHx8XHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WSAtIGopIDw9IDEgJiYgdGhpcy5lbXB0eVggLSBpID09PSAwKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIE1vdmUgY291bnRlclxyXG4gICAgICAgICAgICB0aGlzLm1vdmVzQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgemVybyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXX1gKTtcclxuICAgICAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFycltpXVtqXX1gKTtcclxuXHJcbiAgICAgICAgICAgIC8vICBmaW5kIHdoZXJlIGFyZSB3ZSBtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYIC0gaSA8IDApIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXAhJyk7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlYIC0gaSA+IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPCAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnbGVmdCc7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2xlZnQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gemVyby5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB6ZXJvLnN0eWxlLm9yZGVyID0gdGhpcy5lLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS5vcmRlciA9IHRlbXA7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuICAgICAgICAgICAgfSwgdGhpcy5hbmltYXRpb25UaW1lKTtcclxuXHJcbiAgICAgICAgICAgIFsgdGhpcy5hcnJbaV1bal0sIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gXSA9IFtcclxuICAgICAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldLFxyXG4gICAgICAgICAgICAgIHRoaXMuYXJyW2ldW2pdXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlYID0gaTtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eVkgPSBqO1xyXG4gICAgICAgICAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG5cclxuICAgIGNvbnNvbGUudGFibGUodGhpcy5hcnIpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=