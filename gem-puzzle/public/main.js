(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.cellSize=10.4,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":console.log(this.history.length-2,this.history.length,this.emptyX-1),this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}console.log(this.history)}renderBoard(){document.querySelector(".move").innerHTML=this.movesCounter;let t="";const e=this.cellSize*this.size+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let o=0;o<this.size;o+=1){i=this.arr[s][o];const h=this.arr[s][o]?"cell":"cell empty",n=!!this.arr[s][o],a=`${Math.round(100/(this.size-1)*o)}% ${Math.round(100/(this.size-1)*s)}%`;r+=1,t+=`<div style='order:${r}; background-position: ${a}; background-size: ${e};' id='cell-${i}' class='${h}' draggable="${n}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s),console.log(s.style.width,""+Math.floor(this.cellSize*this.size))}createBoard(){this.arr=[],this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}checkWin(){const t=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?t[e][i]=e*this.size+i+1:t[e][i]=0}console.log("check for win!",t,this.arr);for(let e=0;e<this.size;e+=1)for(let i=0;i<this.size;i+=1)if(e+i!==2*(this.size-1)&&t[e][i]!==this.arr[e][i])return!1;return console.log("win!",t,this.arr),!0}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(document.querySelector(".board").innerHTML+=`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов`)}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void console.table(this.arr)}}init(){this.size=document.getElementById("fieldSize").value,this.removeBoard(),this.createBoard(),this.shuffle(),this.movesCounter=0,this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}},i=document.createElement("header");i.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <button class="save">Save</button>\n  <button class="load">Load</button>\n  <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  <label for="fieldSize">Field size:</label>\n  <select id="fieldSize">\n  <option value="3">3</option>\n  <option selected="selected" value="4">4</option>\n  <option value="5">5</option>\n  <option value="6">6</option>\n  <option value="7">7</option>\n  <option value="8">8</option>\n</select>\n</header>',document.body.appendChild(i),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({history:t.history,size:t.size,boardTable:t.arr,time:e.currentTime,moves:t.movesCounter,zero:[t.emptyX,t.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{history:i,size:s,boardTable:r,time:o,moves:h,zero:n}=JSON.parse(localStorage.getItem("gameSave"));t.history=i,t.size=s,e.currentTime=o,t.movesCounter=h,t.arr=r,t.load(),e.load(),[t.emptyX,t.emptyY]=n,console.log(t.movesCounter)})),document.getElementById("fieldSize").addEventListener("change",(i=>{console.log(i.target.value),t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFuaW1hdGlvblRpbWUiLCJjZWxsU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiYXJyIiwiRXJyb3IiLCJwdXNoIiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1vdmUiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwibW92ZXNDb3VudGVyIiwiYm9hcmRXaWR0aCIsImNlbGxOdW1iZXIiLCJvcmRlciIsImoiLCJjbGFzc05hbWUiLCJkcmFnZ2FibGUiLCJiR3BvcyIsInJvdW5kIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJyZW1QZXJUaWNrIiwidGltZVBhc3NlZCIsImUiLCJ0cmFuc2Zvcm0iLCJpbkFuaW1hdGlvbiIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInRpbWVyIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiZHJhdyIsIndpbiIsIm51bWJlciIsImFicyIsInplcm8iLCJtb3ZlQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInRlbXAiLCJjaGVja1dpbiIsInRhYmxlIiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsImNyZWF0ZUJvYXJkIiwic2h1ZmZsZSIsInJlbmRlckJvYXJkIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJzd2FwIiwicGFyc2VJbnQiLCJkcmFnU3RhcnQiLCJkcmFnT3ZlciIsImRyYWdEcm9wIiwiZHJhZ0VuZCIsImN1cnJlbnRUaW1lIiwidGltZSIsInNlY1RvTWluQW5kU2VjIiwibWludXRlcyIsInNlYyIsInRvRml4ZWQiLCJyZW5kZXJUaW1lciIsInRpbWVyU3RvcCIsImNhbGNDdXJyZW50VGltZSIsImhlYWRlciIsImluaXQiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImJvYXJkVGFibGUiLCJtb3ZlcyIsInBhcnNlIiwiZ2V0SXRlbSIsImxvYWQiXSwibWFwcGluZ3MiOiJtQkFHQSxNQUFNQSxFQUFRLElDSEMsTUFDYixjQUNFQyxLQUFLQyxRQUFVLEdBQ2ZELEtBQUtFLEtBQU8sRUFDWkYsS0FBS0csT0FBUyxFQUNkSCxLQUFLSSxPQUFTLEVBQ2RKLEtBQUtLLGNBQWdCLElBQ3JCTCxLQUFLTSxTQUFXLEtBQ2hCTixLQUFLTyxZQUFjLEtBQ2pCQyxTQUFTQyxpQkFBaUIsVUFBVUMsU0FBU0MsSUFDM0NILFNBQVNJLEtBQUtDLFlBQVlGLE9BT2hDLEtBQUtHLEdBQ0gsT0FBUUEsR0FDTixJQUFLLEtBQ0hDLFFBQVFDLElBQUloQixLQUFLQyxRQUFRZ0IsT0FBUyxFQUFHakIsS0FBS0MsUUFBUWdCLE9BQVFqQixLQUFLRyxPQUFTLEdBRXhFSCxLQUFLa0IsSUFBSWxCLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtrQixJQUFJbEIsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS2tCLElBQUlsQixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQVUsRUFDekNKLEtBQUtHLFFBQVUsRUFDZixNQUNGLElBQUssT0FDSEgsS0FBS2tCLElBQUlsQixLQUFLRyxRQUFRSCxLQUFLSSxRQUFVSixLQUFLa0IsSUFBSWxCLEtBQUtHLE9BQVMsR0FBR0gsS0FBS0ksUUFDcEVKLEtBQUtrQixJQUFJbEIsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUFV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SixFQUFNSyxjQUtsQ0ksU0FBU2tCLGNBQWMsU0FBUzZDLGlCQUFpQixTQUFTLEtBQ3hELE1BQU0sUUFBRXRFLEVBQU8sS0FBRUMsRUFBSSxXQUFFNkYsRUFBVSxLQUFFZCxFQUFJLE1BQUVlLEVBQUssS0FBRXJDLEdBQVNrQyxLQUFLSSxNQUM1RE4sYUFBYU8sUUFBUSxhQUV2Qm5HLEVBQU1FLFFBQVVBLEVBQ2hCRixFQUFNRyxLQUFPQSxFQUNia0QsRUFBTTRCLFlBQWNDLEVBQ3BCbEYsRUFBTTZCLGFBQWVvRSxFQUNyQmpHLEVBQU1tQixJQUFNNkUsRUFDWmhHLEVBQU1vRyxPQUNOL0MsRUFBTStDLFFBQ0pwRyxFQUFNSSxPQUFRSixFQUFNSyxRQUFXdUQsRUFDakM1QyxRQUFRQyxJQUFJakIsRUFBTTZCLGlCQUdwQnBCLFNBQVN5RCxlQUFlLGFBQWFNLGlCQUFpQixVQUFXQyxJQUMvRHpELFFBQVFDLElBQUl3RCxFQUFJQyxPQUFPUCxPQUN2Qm5FLEVBQU0yRixPQUNOdEMsRUFBTXNDLFciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb2FyZCBmcm9tICcuL0JvYXJkLmpzJztcclxuaW1wb3J0IFRpbWVyIGZyb20gJy4vVGltZXIuanMnO1xyXG5cclxuY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoKTtcclxuY29uc3QgdGltZXIgPSBuZXcgVGltZXIoKTtcclxuXHJcbmNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hlYWRlcicpO1xyXG5cclxuaGVhZGVyLmlubmVySFRNTCA9IGAgIFxyXG48aGVhZGVyIGNsYXNzPVwiaGVhZGVyXCI+XHJcbiAgPGJ1dHRvbiBjbGFzcz1cIm5ldy1nYW1lXCI+TmV3IGdhbWU8L2J1dHRvbj5cclxuICA8YnV0dG9uIGNsYXNzPVwic2F2ZVwiPlNhdmU8L2J1dHRvbj5cclxuICA8YnV0dG9uIGNsYXNzPVwibG9hZFwiPkxvYWQ8L2J1dHRvbj5cclxuICA8ZGl2IGNsYXNzPVwidGltZXJcIj48c3Bhbj5UaW1lcjo8L3NwYW4+PHNwYW4gY2xhc3M9XCJ0aW1lXCI+MDowMDwvc3Bhbj48L2Rpdj5cclxuICA8ZGl2IGNsYXNzPVwibW92ZXNcIj48c3Bhbj5Nb3Zlczo8L3NwYW4+PHNwYW4gY2xhc3M9XCJtb3ZlXCI+MDwvc3Bhbj48L2Rpdj5cclxuICA8bGFiZWwgZm9yPVwiZmllbGRTaXplXCI+RmllbGQgc2l6ZTo8L2xhYmVsPlxyXG4gIDxzZWxlY3QgaWQ9XCJmaWVsZFNpemVcIj5cclxuICA8b3B0aW9uIHZhbHVlPVwiM1wiPjM8L29wdGlvbj5cclxuICA8b3B0aW9uIHNlbGVjdGVkPVwic2VsZWN0ZWRcIiB2YWx1ZT1cIjRcIj40PC9vcHRpb24+XHJcbiAgPG9wdGlvbiB2YWx1ZT1cIjVcIj41PC9vcHRpb24+XHJcbiAgPG9wdGlvbiB2YWx1ZT1cIjZcIj42PC9vcHRpb24+XHJcbiAgPG9wdGlvbiB2YWx1ZT1cIjdcIj43PC9vcHRpb24+XHJcbiAgPG9wdGlvbiB2YWx1ZT1cIjhcIj44PC9vcHRpb24+XHJcbjwvc2VsZWN0PlxyXG48L2hlYWRlcj5gO1xyXG5cclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG5cclxuYm9hcmQuaW5pdCgpO1xyXG50aW1lci5pbml0KCk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LWdhbWUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcbiAgdGltZXIuaW5pdCgpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYXZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXHJcbiAgICAnZ2FtZVNhdmUnLFxyXG4gICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBoaXN0b3J5OiBib2FyZC5oaXN0b3J5LFxyXG4gICAgICBzaXplOiBib2FyZC5zaXplLFxyXG4gICAgICBib2FyZFRhYmxlOiBib2FyZC5hcnIsXHJcbiAgICAgIHRpbWU6IHRpbWVyLmN1cnJlbnRUaW1lLFxyXG4gICAgICBtb3ZlczogYm9hcmQubW92ZXNDb3VudGVyLFxyXG4gICAgICB6ZXJvOiBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF1cclxuICAgIH0pXHJcbiAgKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGNvbnN0IHsgaGlzdG9yeSwgc2l6ZSwgYm9hcmRUYWJsZSwgdGltZSwgbW92ZXMsIHplcm8gfSA9IEpTT04ucGFyc2UoXHJcbiAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2FtZVNhdmUnKVxyXG4gICk7XHJcbiAgYm9hcmQuaGlzdG9yeSA9IGhpc3Rvcnk7XHJcbiAgYm9hcmQuc2l6ZSA9IHNpemU7XHJcbiAgdGltZXIuY3VycmVudFRpbWUgPSB0aW1lO1xyXG4gIGJvYXJkLm1vdmVzQ291bnRlciA9IG1vdmVzO1xyXG4gIGJvYXJkLmFyciA9IGJvYXJkVGFibGU7XHJcbiAgYm9hcmQubG9hZCgpO1xyXG4gIHRpbWVyLmxvYWQoKTtcclxuICBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF0gPSB6ZXJvO1xyXG4gIGNvbnNvbGUubG9nKGJvYXJkLm1vdmVzQ291bnRlcik7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpZWxkU2l6ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldnQpID0+IHtcclxuICBjb25zb2xlLmxvZyhldnQudGFyZ2V0LnZhbHVlKTtcclxuICBib2FyZC5pbml0KCk7XHJcbiAgdGltZXIuaW5pdCgpO1xyXG5cclxufSk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xyXG4gICAgdGhpcy5zaXplID0gNDtcclxuICAgIHRoaXMuZW1wdHlYID0gMDtcclxuICAgIHRoaXMuZW1wdHlZID0gMDtcclxuICAgIHRoaXMuYW5pbWF0aW9uVGltZSA9IDQwMDtcclxuICAgIHRoaXMuY2VsbFNpemUgPSAxMC40OyAvLyAgcmVtIHdpdGggbWFyZ2luXHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkID0gKCkgPT4ge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9hcmQnKS5mb3JFYWNoKChlbGVtKSA9PiB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gbGV0IHNpemUgPSA0O1xyXG5cclxuICBtb3ZlKGRpcmVjdGlvbikge1xyXG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuaGlzdG9yeS5sZW5ndGggLSAyLCB0aGlzLmhpc3RvcnkubGVuZ3RoLCB0aGlzLmVtcHR5WCAtIDEpO1xyXG5cclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggLSAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggLSAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlYIC09IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVggKz0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgKyAxXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgKyAxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVkgKz0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSAtIDFdO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSAtIDFdID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WSAtPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzaHVmZmxlKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemUgKiogMzsgaSArPSAxKSB7XHJcbiAgICAgIHN3aXRjaCAoTWF0aC5mbG9vcig0ICogTWF0aC5yYW5kb20oKSkpIHtcclxuICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVggIT09IDApIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgVVBcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgndXAnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBSSUdIVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVggIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgRE9XTlxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2Rvd24nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgndXAnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlZICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIExFRlRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdsZWZ0Jyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBSSUdIVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGkgLT0gMTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKHRoaXMuaGlzdG9yeSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBjb25zdCBib2FyZFdpZHRoID0gYCR7dGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZX1yZW1gO1xyXG4gICAgbGV0IGNlbGxOdW1iZXI7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIG9yZGVyID0gMTsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBjZWxsTnVtYmVyID0gdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5hcnJbaV1bal0gPyAnY2VsbCcgOiAnY2VsbCBlbXB0eSc7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlID0gISF0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBiR3BvcyA9IGAke01hdGgucm91bmQoMTAwIC8gKHRoaXMuc2l6ZSAtIDEpICogail9JSAke01hdGgucm91bmQoXHJcbiAgICAgICAgICAxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBpXHJcbiAgICAgICAgKX0lYDtcclxuICAgICAgICBvcmRlciArPSAxO1xyXG4gICAgICAgIGJvYXJkICs9IGA8ZGl2IHN0eWxlPSdvcmRlcjoke29yZGVyfTsgYmFja2dyb3VuZC1wb3NpdGlvbjogJHtiR3Bvc307IGJhY2tncm91bmQtc2l6ZTogJHtib2FyZFdpZHRofTsnIGlkPSdjZWxsLSR7Y2VsbE51bWJlcn0nIGNsYXNzPScke2NsYXNzTmFtZX0nIGRyYWdnYWJsZT1cIiR7ZHJhZ2dhYmxlfVwiPiR7Y2VsbE51bWJlcn08L2Rpdj5gO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdib2FyZCcpO1xyXG4gICAgZWxlbWVudC5zdHlsZS53aWR0aCA9IGJvYXJkV2lkdGg7XHJcbiAgICBlbGVtZW50LmlubmVySFRNTCA9IGJvYXJkO1xyXG5cclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coZWxlbWVudC5zdHlsZS53aWR0aCwgYCR7TWF0aC5mbG9vcih0aGlzLmNlbGxTaXplICogdGhpcy5zaXplKX1gKTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZUJvYXJkKCkge1xyXG4gICAgdGhpcy5hcnIgPSBbXTtcclxuICAgIHRoaXMuZW1wdHlYID0gdGhpcy5zaXplIC0gMTtcclxuICAgIHRoaXMuZW1wdHlZID0gdGhpcy5zaXplIC0gMTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgdGhpcy5hcnJbaV0gPSBbXTtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGlmIChpICsgaiAhPT0gKHRoaXMuc2l6ZSAtIDEpICogMikge1xyXG4gICAgICAgICAgdGhpcy5hcnJbaV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRyYXcoKSB7XHJcbiAgICBjb25zdCByZW1QZXJUaWNrID0gdGhpcy5jZWxsU2l6ZSAvIHRoaXMuYW5pbWF0aW9uVGltZSAqIHRoaXMudGltZVBhc3NlZDtcclxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAwLCAkey1yZW1QZXJUaWNrfXJlbSlgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHtyZW1QZXJUaWNrfXJlbSlgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHstcmVtUGVyVGlja31yZW0sIDApYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAke3JlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVBbmltYXRpb24oKSB7XHJcbiAgICB0aGlzLmluQW5pbWF0aW9uID0gdHJ1ZTtcclxuICAgIHRoaXMuc3RhcnQgPSBEYXRlLm5vdygpO1xyXG5cclxuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMudGltZVBhc3NlZCA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0O1xyXG5cclxuICAgICAgaWYgKHRoaXMudGltZVBhc3NlZCA+PSB0aGlzLmFuaW1hdGlvblRpbWUpIHtcclxuICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpO1xyXG4gICAgICAgIHRoaXMuaW5BbmltYXRpb24gPSBmYWxzZTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfSwgMjApO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tXaW4oKSB7XHJcbiAgICBjb25zdCB3aW4gPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgd2luW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHdpbltpXVtqXSA9IGkgKiB0aGlzLnNpemUgKyBqICsgMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd2luW2ldW2pdID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnY2hlY2sgZm9yIHdpbiEnLCB3aW4sIHRoaXMuYXJyKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIGlmICh3aW5baV1bal0gIT09IHRoaXMuYXJyW2ldW2pdKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ3dpbiEnLCB3aW4sIHRoaXMuYXJyKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgc3dhcChudW1iZXIpIHtcclxuICAgIGlmICh0aGlzLmluQW5pbWF0aW9uKSByZXR1cm47XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFyci5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYXJyW2ldLmxlbmd0aDsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXJyW2ldW2pdID09PSBudW1iZXIpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlYIC0gaSkgPD0gMSAmJiB0aGlzLmVtcHR5WSAtIGogPT09IDApIHx8XHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WSAtIGopIDw9IDEgJiYgdGhpcy5lbXB0eVggLSBpID09PSAwKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIE1vdmUgY291bnRlclxyXG4gICAgICAgICAgICB0aGlzLm1vdmVzQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgemVybyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXX1gKTtcclxuICAgICAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFycltpXVtqXX1gKTtcclxuXHJcbiAgICAgICAgICAgIC8vICBmaW5kIHdoZXJlIGFyZSB3ZSBtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYIC0gaSA8IDApIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXAhJyk7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlYIC0gaSA+IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPCAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnbGVmdCc7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2xlZnQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gemVyby5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB6ZXJvLnN0eWxlLm9yZGVyID0gdGhpcy5lLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS5vcmRlciA9IHRlbXA7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYID09PSB0aGlzLmVtcHR5WSAmJiB0aGlzLmVtcHR5WSA9PT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICAgICAgICAgICcuYm9hcmQnXHJcbiAgICAgICAgICAgICAgICAgICkuaW5uZXJIVE1MICs9IGDQo9GA0LAhINCS0Ysg0YDQtdGI0LjQu9C4INCz0L7Qu9C+0LLQvtC70L7QvNC60YMg0LfQsCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJylcclxuICAgICAgICAgICAgICAgICAgICAuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyYDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcblxyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuICAgICAgICAgICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnNpemUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykudmFsdWU7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnNodWZmbGUoKTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuXHJcbiAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcblxyXG4gICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XHJcbiAgICAvLyB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gIH1cclxuXHJcbiAgY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4gICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IDE7XHJcbiAgICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIH0sIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgc2VjVG9NaW5BbmRTZWMoKSB7XHJcbiAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MCk7XHJcblxyXG4gICAgdGhpcy5zZWMgPSAodGhpcy5jdXJyZW50VGltZSAlIDYwKS50b0ZpeGVkKDApO1xyXG4gICAgdGhpcy50aW1lciA9IGAke3RoaXMubWludXRlc306JHt0aGlzLnNlYyA8IDEwID8gJzAnIDogJyd9JHt0aGlzLnNlY31gO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJTdG9wKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWUpO1xyXG4gICAgdGhpcy50aW1lciA9ICcwOjAwJztcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclRpbWVyKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKS5pbm5lckhUTUwgPSB0aGlzLnRpbWVyO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbnVsbDtcclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuXHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==