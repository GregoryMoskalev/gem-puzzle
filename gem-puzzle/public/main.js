(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.cellSize=10.4,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){document.querySelector(".move").innerHTML=this.movesCounter;let t,e="";for(let i=0,s=1;i<this.size;i+=1)for(let r=0;r<this.size;r+=1){t=this.arr[i][r];const h=this.arr[i][r]?"cell":"cell empty",o=!!this.arr[i][r];s+=1,e+=`<div style='order:${s};' id='cell-${t}' class='${h}' draggable="${o}">${t}</div>`}const i=document.createElement("div");i.classList.add("board"),i.style.width=this.cellSize*this.size+"rem",i.innerHTML=e,document.body.appendChild(i),console.log(i.style.width,""+Math.floor(this.cellSize*this.size))}createBoard(){this.arr=[],this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform=""}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void console.table(this.arr)}}init(){this.size=document.getElementById("fieldSize").value,this.removeBoard(),this.createBoard(),this.shuffle(),this.movesCounter=0,this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}},i=document.createElement("header");i.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <button class="save">Save</button>\n  <button class="load">Load</button>\n  <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  <label for="fieldSize">Field size:</label>\n  <select id="fieldSize">\n  <option value="3">3</option>\n  <option selected="selected" value="4">4</option>\n  <option value="5">5</option>\n  <option value="6">6</option>\n  <option value="7">7</option>\n  <option value="8">8</option>\n</select>\n</header>',document.body.appendChild(i),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({history:t.history,size:t.size,boardTable:t.arr,time:e.currentTime,moves:t.movesCounter,zero:[t.emptyX,t.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{history:i,size:s,boardTable:r,time:h,moves:o,zero:n}=JSON.parse(localStorage.getItem("gameSave"));t.history=i,t.size=s,e.currentTime=h,t.movesCounter=o,t.arr=r,t.load(),e.load(),[t.emptyX,t.emptyY]=n,console.log(t.movesCounter)})),document.getElementById("fieldSize").addEventListener("change",(i=>{console.log(i.target.value),t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFuaW1hdGlvblRpbWUiLCJjZWxsU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJhcnIiLCJFcnJvciIsInB1c2giLCJpIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibW92ZSIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJtb3Zlc0NvdW50ZXIiLCJjZWxsTnVtYmVyIiwib3JkZXIiLCJqIiwiY2xhc3NOYW1lIiwiZHJhZ2dhYmxlIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJjb25zb2xlIiwibG9nIiwicmVtUGVyVGljayIsInRpbWVQYXNzZWQiLCJlIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lciIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImRyYXciLCJudW1iZXIiLCJsZW5ndGgiLCJhYnMiLCJ6ZXJvIiwibW92ZUFuaW1hdGlvbiIsInNldFRpbWVvdXQiLCJ0ZW1wIiwidGFibGUiLCJnZXRFbGVtZW50QnlJZCIsInZhbHVlIiwiY3JlYXRlQm9hcmQiLCJzaHVmZmxlIiwicmVuZGVyQm9hcmQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiY3VycmVudFRpbWUiLCJ0aW1lIiwic2VjVG9NaW5BbmRTZWMiLCJtaW51dGVzIiwic2VjIiwidG9GaXhlZCIsInJlbmRlclRpbWVyIiwidGltZXJTdG9wIiwiY2FsY0N1cnJlbnRUaW1lIiwiaGVhZGVyIiwiaW5pdCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYm9hcmRUYWJsZSIsIm1vdmVzIiwicGFyc2UiLCJnZXRJdGVtIiwibG9hZCJdLCJtYXBwaW5ncyI6Im1CQUdBLE1BQU1BLEVBQVEsSUNIQyxNQUNiLGNBQ0VDLEtBQUtDLFFBQVUsR0FDZkQsS0FBS0UsS0FBTyxFQUNaRixLQUFLRyxPQUFTLEVBQ2RILEtBQUtJLE9BQVMsRUFDZEosS0FBS0ssY0FBZ0IsSUFDckJMLEtBQUtNLFNBQVcsS0FDaEJOLEtBQUtPLFlBQWMsS0FDakJDLFNBQVNDLGlCQUFpQixVQUFVQyxTQUFTQyxJQUMzQ0gsU0FBU0ksS0FBS0MsWUFBWUYsT0FPaEMsS0FBS0csR0FDSCxPQUFRQSxHQUNOLElBQUssS0FDSGQsS0FBS2UsSUFBSWYsS0FBS0csUUFBUUgsS0FBS0ksUUFBVUosS0FBS2UsSUFBSWYsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS2UsSUFBSWYsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUFVLEVBQ3pDSixLQUFLRyxRQUFVLEVBQ2YsTUFDRixJQUFLLE9BQ0hILEtBQUtlLElBQUlmLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtlLElBQUlmLEtBQUtHLE9BQVMsR0FBR0gsS0FBS0ksUUFDcEVKLEtBQUtlLElBQUlmLEtBQUtHLE9BQVMsR0FBR0gsS0FBS0ksUUFBVSxFQUN6Q0osS0FBS0csUUFBVSxFQUNmLE1BQ0YsSUFBSyxRQUNISCxLQUFLZSxJQUFJZixLQUFLRyxRQUFRSCxLQUFLSSxRQUFVSixLQUFLZSxJQUFJZixLQUFLRyxRQUFRSCxLQUFLSSxPQUFTLEdBQ3pFSixLQUFLZSxJQUFJZixLQUFL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VUEsRUFDaEJGLEVBQU1HLEtBQU9BLEVBQ2I4QyxFQUFNMkIsWUFBY0MsRUFDcEI3RSxFQUFNMEIsYUFBZWtFLEVBQ3JCNUYsRUFBTWdCLElBQU0yRSxFQUNaM0YsRUFBTStGLE9BQ045QyxFQUFNOEMsUUFDSi9GLEVBQU1JLE9BQVFKLEVBQU1LLFFBQVdtRCxFQUNqQ2pCLFFBQVFDLElBQUl4QyxFQUFNMEIsaUJBR3BCakIsU0FBU29ELGVBQWUsYUFBYU0saUJBQWlCLFVBQVdDLElBQy9EN0IsUUFBUUMsSUFBSTRCLEVBQUlDLE9BQU9QLE9BQ3ZCOUQsRUFBTXNGLE9BQ05yQyxFQUFNcUMsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5pbXBvcnQgVGltZXIgZnJvbSAnLi9UaW1lci5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5jb25zdCB0aW1lciA9IG5ldyBUaW1lcigpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcblxyXG5oZWFkZXIuaW5uZXJIVE1MID0gYCAgXHJcbjxoZWFkZXIgY2xhc3M9XCJoZWFkZXJcIj5cclxuICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWVcIj5OZXcgZ2FtZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJzYXZlXCI+U2F2ZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJsb2FkXCI+TG9hZDwvYnV0dG9uPlxyXG4gIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wOjAwPC9zcGFuPjwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDxsYWJlbCBmb3I9XCJmaWVsZFNpemVcIj5GaWVsZCBzaXplOjwvbGFiZWw+XHJcbiAgPHNlbGVjdCBpZD1cImZpZWxkU2l6ZVwiPlxyXG4gIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gIDxvcHRpb24gc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiIHZhbHVlPVwiNFwiPjQ8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNVwiPjU8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNlwiPjY8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiN1wiPjc8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiOFwiPjg8L29wdGlvbj5cclxuPC9zZWxlY3Q+XHJcbjwvaGVhZGVyPmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlYWRlcik7XHJcblxyXG5ib2FyZC5pbml0KCk7XHJcbnRpbWVyLmluaXQoKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctZ2FtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcclxuICAgICdnYW1lU2F2ZScsXHJcbiAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGhpc3Rvcnk6IGJvYXJkLmhpc3RvcnksXHJcbiAgICAgIHNpemU6IGJvYXJkLnNpemUsXHJcbiAgICAgIGJvYXJkVGFibGU6IGJvYXJkLmFycixcclxuICAgICAgdGltZTogdGltZXIuY3VycmVudFRpbWUsXHJcbiAgICAgIG1vdmVzOiBib2FyZC5tb3Zlc0NvdW50ZXIsXHJcbiAgICAgIHplcm86IFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXVxyXG4gICAgfSlcclxuICApO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY29uc3QgeyBoaXN0b3J5LCBzaXplLCBib2FyZFRhYmxlLCB0aW1lLCBtb3ZlcywgemVybyB9ID0gSlNPTi5wYXJzZShcclxuICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYW1lU2F2ZScpXHJcbiAgKTtcclxuICBib2FyZC5oaXN0b3J5ID0gaGlzdG9yeTtcclxuICBib2FyZC5zaXplID0gc2l6ZTtcclxuICB0aW1lci5jdXJyZW50VGltZSA9IHRpbWU7XHJcbiAgYm9hcmQubW92ZXNDb3VudGVyID0gbW92ZXM7XHJcbiAgYm9hcmQuYXJyID0gYm9hcmRUYWJsZTtcclxuICBib2FyZC5sb2FkKCk7XHJcbiAgdGltZXIubG9hZCgpO1xyXG4gIFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSA9IHplcm87XHJcbiAgY29uc29sZS5sb2coYm9hcmQubW92ZXNDb3VudGVyKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2dCkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGV2dC50YXJnZXQudmFsdWUpO1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcblxyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hbmltYXRpb25UaW1lID0gNDAwO1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IDEwLjQ7IC8vICByZW0gd2l0aCBtYXJnaW5cclxuICAgIHRoaXMucmVtb3ZlQm9hcmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZCcpLmZvckVhY2goKGVsZW0pID0+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBsZXQgc2l6ZSA9IDQ7XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVkgLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2h1ZmZsZSgpIHtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplICoqIDM7IGkgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuICAgICAgICBjb25zdCBkcmFnZ2FibGUgPSAhIXRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J29yZGVyOiR7b3JkZXJ9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcbiAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gYCR7dGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZX1yZW1gO1xyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGVsZW1lbnQuc3R5bGUud2lkdGgsIGAke01hdGguZmxvb3IodGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZSl9YCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIHRoaXMuYXJyID0gW107XHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHRoaXMuYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcmVtUGVyVGljayA9IHRoaXMuY2VsbFNpemUgLyB0aGlzLmFuaW1hdGlvblRpbWUgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwIScpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3VwJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqIDwgMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmlnaHQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHplcm8uc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgemVyby5zdHlsZS5vcmRlciA9IHRoaXMuZS5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUub3JkZXIgPSB0ZW1wO1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcblxyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuICAgICAgICAgICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnNpemUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykudmFsdWU7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnNodWZmbGUoKTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuXHJcbiAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcblxyXG4gICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XHJcbiAgICAvLyB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gIH1cclxuXHJcbiAgY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4gICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IDE7XHJcbiAgICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIH0sIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgc2VjVG9NaW5BbmRTZWMoKSB7XHJcbiAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MCk7XHJcblxyXG4gICAgdGhpcy5zZWMgPSAodGhpcy5jdXJyZW50VGltZSAlIDYwKS50b0ZpeGVkKDApO1xyXG4gICAgdGhpcy50aW1lciA9IGAke3RoaXMubWludXRlc306JHt0aGlzLnNlYyA8IDEwID8gJzAnIDogJyd9JHt0aGlzLnNlY31gO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJTdG9wKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWUpO1xyXG4gICAgdGhpcy50aW1lciA9ICcwOjAwJztcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclRpbWVyKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKS5pbm5lckhUTUwgPSB0aGlzLnRpbWVyO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbnVsbDtcclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuXHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==