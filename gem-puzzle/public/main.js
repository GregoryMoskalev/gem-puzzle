(()=>{"use strict";class t{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}timerPause(){clearInterval(this.time)}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}}const e=new class{constructor(){this.timerC=new t,this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.boardWidth=40.8,this.marginSize=.1,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}back(){setTimeout((()=>{if(this.history.length){const[t,e]=this.history.pop();this.e=document.querySelector("#cell-"+this.arr[t][e]),this.emptyX<t?(this.direction="up",this.moveAnimation(300)):this.emptyX>t?(this.direction="down",this.moveAnimation(300)):this.emptyY<e?(this.direction="left",this.moveAnimation(300)):this.emptyY>e&&(this.direction="right",this.moveAnimation(300)),setTimeout((()=>{const i=this.arr[this.emptyX][this.emptyY];this.arr[this.emptyX][this.emptyY]=this.arr[t][e],this.arr[t][e]=i,this.emptyX=t,this.emptyY=e,this.removeBoard(),this.renderBoard(),this.back()}),this.animationTime-300)}else if(this.checkWin()){const t=document.querySelector(".board");t.classList.add("win"),t.innerHTML="<span class='win-text'>ЧИТЕР!</span>"}}),this.animationTime-300)}move(t){switch(t){case"up":0!==this.emptyX&&(this.history.length<=2||this.emptyX-1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"down":this.emptyX!==this.size-1&&(this.history.length<=2||this.emptyX+1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"right":this.emptyY!==this.size-1&&(this.history.length<=2||this.emptyY+1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"left":0!==this.emptyY&&(this.history.length<=2||this.emptyY-1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;default:throw new Error(">:(")}}createBoard(){const t=[];this.bgPosArr=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?(t[e][i]=e*this.size+i+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*i)}% ${Math.round(100/(this.size-1)*e)}%`)):t[e][i]=0}return t}shuffle(){for(this.history.push([this.emptyX,this.emptyY]),this.counter=0;this.counter<this.size**3;this.counter+=1)switch(Math.floor(4*Math.random())){case 0:this.move("up");break;case 1:this.move("right");break;case 2:this.move("down");break;case 3:this.move("left");break;default:throw new Error(">:(")}}renderBoard(){let t="";const e=this.boardWidth+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let h=0;h<this.size;h+=1){i=this.arr[s][h];const n=this.arr[s][h]?"cell":"cell empty",o=!!this.arr[s][h],a=this.bgPosArr[i-1];r+=1,t+=`<div style='width:${this.cellSize}rem; height:${this.cellSize}rem; order:${r}; background-position: ${a}; background-size: ${e};' id='cell-${i}' class='${n}' draggable="${o}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s)}draw(t){const e=this.cellSize/(this.animationTime-t)*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-e}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${e}rem)`;break;case"left":this.e.style.transform=`translate( ${-e}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${e}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(t){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw(t)}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(this.direction="up",this.moveAnimation(0)):this.emptyX-e>0?(this.direction="down",this.moveAnimation(0)):this.emptyY-i<0?(this.direction="left",this.moveAnimation(0)):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(0)),setTimeout((()=>{const e=t.style.order;if(t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()){this.timerC.timerPause();const t=document.querySelector(".board");t.classList.add("win"),t.innerHTML=`<span class='win-text'>Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов</span>`}}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void this.history.push([this.emptyX,this.emptyY])}}checkWin(){for(let t=0;t<this.size;t+=1)for(let e=0;e<this.size;e+=1)if(t+e!==2*(this.size-1)&&this.win[t][e]!==this.arr[t][e])return!1;return!0}init(){this.history=[],this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),this.removeBoard(),this.emptyX=this.size-1,this.emptyY=this.size-1,this.arr=this.createBoard(),this.win=this.createBoard(),this.shuffle(),this.renderBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),this.win=this.createBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},i=document.createElement("header");i.classList.add("header"),i.innerHTML='<h1 class="heading">gem puzzle</h1>',document.body.appendChild(i);const s=document.createElement("div");s.classList.add("menu"),s.innerHTML='  \n  <div class="settings">\n    <button style="position: absolute; top: 0;" class=\'cheat\'>CHEAT</button>\n    <button class="new-game btn">New</button>\n    <button class="save btn">Save</button>\n    <button class="load btn">Load</button>\n    <div class="size">\n      <select id="fieldSize">\n      <option selected="selected" value="4" disabled>Field size</option>\n        <option value="3">3</option>\n        <option value="4">4</option>\n        <option value="5">5</option>\n        <option value="6">6</option>\n        <option value="7">7</option>\n        <option value="8">8</option>\n      </select>\n    </div>\n  </div>\n  <div class="counters">\n    <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n    <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  </div>',document.body.appendChild(s),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({bgPosition:e.bgPosArr,history:e.history,size:e.size,boardTable:e.arr,time:e.timerC.currentTime,moves:e.movesCounter,zero:[e.emptyX,e.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{bgPosition:t,history:i,size:s,boardTable:r,time:h,moves:n,zero:o}=JSON.parse(localStorage.getItem("gameSave"));e.bgPosArr=t,e.history=i,e.size=s,e.timerC.currentTime=h,e.movesCounter=n,e.arr=r,e.load(),e.timerC.load(),[e.emptyX,e.emptyY]=o})),document.getElementById("fieldSize").addEventListener("change",(()=>{e.init(),e.timerC.init()})),document.querySelector(".cheat").addEventListener("click",(()=>{e.timerC.timerPause(),e.back()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL1RpbWVyLmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9Cb2FyZC5qcyJdLCJuYW1lcyI6WyJUaW1lciIsInRoaXMiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZXRJbnRlcnZhbCIsInNlY1RvTWluQW5kU2VjIiwibWludXRlcyIsIk1hdGgiLCJmbG9vciIsInNlYyIsInRvRml4ZWQiLCJ0aW1lciIsInJlbmRlclRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRpbWVyU3RvcCIsImNhbGNDdXJyZW50VGltZSIsImJvYXJkIiwidGltZXJDIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhbmltYXRpb25UaW1lIiwiYm9hcmRXaWR0aCIsIm1hcmdpblNpemUiLCJyZW1vdmVCb2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbSIsImJvZHkiLCJyZW1vdmVDaGlsZCIsInNldFRpbWVvdXQiLCJsZW5ndGgiLCJ4IiwieSIsInBvcCIsImUiLCJhcnIiLCJkaXJlY3Rpb24iLCJtb3ZlQW5pbWF0aW9uIiwidGVtcCIsInJlbmRlckJvYXJkIiwiYmFjayIsImNoZWNrV2luIiwid2luQm9hcmQiLCJjbGFzc0xpc3QiLCJhZGQiLCJwdXNoIiwiY291bnRlciIsIkVycm9yIiwiYmdQb3NBcnIiLCJpIiwiaiIsInJvdW5kIiwicmFuZG9tIiwibW92ZSIsImNlbGxOdW1iZXIiLCJvcmRlciIsImNsYXNzTmFtZSIsImRyYWdnYWJsZSIsImJHcG9zIiwiY2VsbFNpemUiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsInN0eWxlIiwid2lkdGgiLCJhcHBlbmRDaGlsZCIsIm1vZCIsInJlbVBlclRpY2siLCJ0aW1lUGFzc2VkIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJkcmF3IiwibnVtYmVyIiwiYWJzIiwibW92ZXNDb3VudGVyIiwiemVybyIsInRpbWVyUGF1c2UiLCJ3aW4iLCJnZXRFbGVtZW50QnlJZCIsInZhbHVlIiwicGFyc2VGbG9hdCIsImNyZWF0ZUJvYXJkIiwic2h1ZmZsZSIsImluaXQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiaGVhZGVyIiwibWVudSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYmdQb3NpdGlvbiIsImJvYXJkVGFibGUiLCJtb3ZlcyIsInBhcnNlIiwiZ2V0SXRlbSIsImxvYWQiXSwibWFwcGluZ3MiOiJtQkFBZSxNQUFNQSxFQUNuQixjQUNFQyxLQUFLQyxZQUFjLEVBSXJCLGtCQUNFRCxLQUFLRSxLQUFPQyxhQUFZLEtBQ3RCSCxLQUFLQyxhQUFlLEVBQ3BCRCxLQUFLSSxtQkFDSixLQUdMLGlCQUNFSixLQUFLSyxRQUFVQyxLQUFLQyxNQUFNUCxLQUFLQyxZQUFjLElBRTdDRCxLQUFLUSxLQUFPUixLQUFLQyxZQUFjLElBQUlRLFFBQVEsR0FDM0NULEtBQUtVLE1BQVEsR0FBR1YsS0FBS0ssV0FBV0wsS0FBS1EsSUFBTSxHQUFLLElBQU0sS0FBS1IsS0FBS1EsTUFDaEVSLEtBQUtXLGNBR1AsWUFDRUMsY0FBY1osS0FBS0UsTUFDbkJGLEtBQUtVLE1BQVEsT0FDYlYsS0FBS1csY0FHUCxhQUNFQyxjQUFjWixLQUFLRSxNQUdyQixjQUNFVyxTQUFTQyxjQUFjLFNBQVNDLFVBQVlmLEtBQUtVLE1BR25ELE9BQ0VWLEtBQUtnQixZQUNMaEIsS0FBS0MsWUFBYyxLQUNuQkQsS0FBS2lCLGtCQUdQLE9BQ0VqQixLQUFLZ0IsWUFDTGhCLEtBQUtJLGlCQUNMSixLQUFLVyxjQUVMWCxLQUFL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QVFKLEVBQU1LLFFBQVcwRCxLQUduQ3BFLFNBQVN1RSxlQUFlLGFBQWFPLGlCQUFpQixVQUFVLEtBQzlEekUsRUFBTXVFLE9BQ052RSxFQUFNQyxPQUFPc0UsVUFHZjVFLFNBQVNDLGNBQWMsVUFBVTZFLGlCQUFpQixTQUFTLEtBQ3pEekUsRUFBTUMsT0FBTytELGFBQ2JoRSxFQUFNMEIsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XHJcbiAgICAvLyB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gIH1cclxuXHJcbiAgY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4gICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IDE7XHJcbiAgICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIH0sIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgc2VjVG9NaW5BbmRTZWMoKSB7XHJcbiAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MCk7XHJcblxyXG4gICAgdGhpcy5zZWMgPSAodGhpcy5jdXJyZW50VGltZSAlIDYwKS50b0ZpeGVkKDApO1xyXG4gICAgdGhpcy50aW1lciA9IGAke3RoaXMubWludXRlc306JHt0aGlzLnNlYyA8IDEwID8gJzAnIDogJyd9JHt0aGlzLnNlY31gO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJTdG9wKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWUpO1xyXG4gICAgdGhpcy50aW1lciA9ICcwOjAwJztcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHRpbWVyUGF1c2UoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUaW1lcigpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJykuaW5uZXJIVE1MID0gdGhpcy50aW1lcjtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnRpbWVyU3RvcCgpO1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IG51bGw7XHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLnNlY1RvTWluQW5kU2VjKCk7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcblxyXG4gICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5cclxuY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoKTtcclxuXHJcbmNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hlYWRlcicpO1xyXG5oZWFkZXIuY2xhc3NMaXN0LmFkZCgnaGVhZGVyJyk7XHJcbmhlYWRlci5pbm5lckhUTUwgPSAnPGgxIGNsYXNzPVwiaGVhZGluZ1wiPmdlbSBwdXp6bGU8L2gxPic7XHJcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcclxuXHJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxubWVudS5jbGFzc0xpc3QuYWRkKCdtZW51Jyk7XHJcblxyXG5tZW51LmlubmVySFRNTCA9IGAgIFxyXG4gIDxkaXYgY2xhc3M9XCJzZXR0aW5nc1wiPlxyXG4gICAgPGJ1dHRvbiBzdHlsZT1cInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwO1wiIGNsYXNzPSdjaGVhdCc+Q0hFQVQ8L2J1dHRvbj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJuZXctZ2FtZSBidG5cIj5OZXc8L2J1dHRvbj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJzYXZlIGJ0blwiPlNhdmU8L2J1dHRvbj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJsb2FkIGJ0blwiPkxvYWQ8L2J1dHRvbj5cclxuICAgIDxkaXYgY2xhc3M9XCJzaXplXCI+XHJcbiAgICAgIDxzZWxlY3QgaWQ9XCJmaWVsZFNpemVcIj5cclxuICAgICAgPG9wdGlvbiBzZWxlY3RlZD1cInNlbGVjdGVkXCIgdmFsdWU9XCI0XCIgZGlzYWJsZWQ+RmllbGQgc2l6ZTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI0XCI+NDwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI1XCI+NTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI2XCI+Njwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI3XCI+Nzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI4XCI+ODwvb3B0aW9uPlxyXG4gICAgICA8L3NlbGVjdD5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJjb3VudGVyc1wiPlxyXG4gICAgPGRpdiBjbGFzcz1cInRpbWVyXCI+PHNwYW4+VGltZXI6PC9zcGFuPjxzcGFuIGNsYXNzPVwidGltZVwiPjA6MDA8L3NwYW4+PC9kaXY+XHJcbiAgICA8ZGl2IGNsYXNzPVwibW92ZXNcIj48c3Bhbj5Nb3Zlczo8L3NwYW4+PHNwYW4gY2xhc3M9XCJtb3ZlXCI+MDwvc3Bhbj48L2Rpdj5cclxuICA8L2Rpdj5gO1xyXG5cclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZW51KTtcclxuXHJcbmJvYXJkLmluaXQoKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctZ2FtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2F2ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFxyXG4gICAgJ2dhbWVTYXZlJyxcclxuICAgIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgYmdQb3NpdGlvbjogYm9hcmQuYmdQb3NBcnIsXHJcbiAgICAgIGhpc3Rvcnk6IGJvYXJkLmhpc3RvcnksXHJcbiAgICAgIHNpemU6IGJvYXJkLnNpemUsXHJcbiAgICAgIGJvYXJkVGFibGU6IGJvYXJkLmFycixcclxuICAgICAgdGltZTogYm9hcmQudGltZXJDLmN1cnJlbnRUaW1lLFxyXG4gICAgICBtb3ZlczogYm9hcmQubW92ZXNDb3VudGVyLFxyXG4gICAgICB6ZXJvOiBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF1cclxuICAgIH0pXHJcbiAgKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGNvbnN0IHsgYmdQb3NpdGlvbiwgaGlzdG9yeSwgc2l6ZSwgYm9hcmRUYWJsZSwgdGltZSwgbW92ZXMsIHplcm8gfSA9IEpTT04ucGFyc2UoXHJcbiAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2FtZVNhdmUnKVxyXG4gICk7XHJcbiAgYm9hcmQuYmdQb3NBcnIgPSBiZ1Bvc2l0aW9uO1xyXG4gIGJvYXJkLmhpc3RvcnkgPSBoaXN0b3J5O1xyXG4gIGJvYXJkLnNpemUgPSBzaXplO1xyXG4gIGJvYXJkLnRpbWVyQy5jdXJyZW50VGltZSA9IHRpbWU7XHJcbiAgYm9hcmQubW92ZXNDb3VudGVyID0gbW92ZXM7XHJcbiAgYm9hcmQuYXJyID0gYm9hcmRUYWJsZTtcclxuICBib2FyZC5sb2FkKCk7XHJcbiAgYm9hcmQudGltZXJDLmxvYWQoKTtcclxuICBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF0gPSB6ZXJvO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XHJcbiAgYm9hcmQuaW5pdCgpO1xyXG4gIGJvYXJkLnRpbWVyQy5pbml0KCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoZWF0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgYm9hcmQudGltZXJDLnRpbWVyUGF1c2UoKTtcclxuICBib2FyZC5iYWNrKCk7XHJcbn0pO1xyXG4iLCJpbXBvcnQgVGltZXIgZnJvbSAnLi9UaW1lci5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCb2FyZCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnRpbWVyQyA9IG5ldyBUaW1lcigpO1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hbmltYXRpb25UaW1lID0gNDAwO1xyXG4gICAgdGhpcy5ib2FyZFdpZHRoID0gNDAuODtcclxuICAgIHRoaXMubWFyZ2luU2l6ZSA9IDAuMTtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZCcpLmZvckVhY2goKGVsZW0pID0+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBiYWNrKCkge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmhpc3RvcnkubGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgWyB4LCB5IF0gPSB0aGlzLmhpc3RvcnkucG9wKCk7XHJcbiAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFyclt4XVt5XX1gKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZW1wdHlYIDwgeCkge1xyXG4gICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKDMwMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCA+IHgpIHtcclxuICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2Rvd24nO1xyXG4gICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKDMwMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSA8IHkpIHtcclxuICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKDMwMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSA+IHkpIHtcclxuICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigzMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCB0ZW1wID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt4XVt5XTtcclxuICAgICAgICAgIHRoaXMuYXJyW3hdW3ldID0gdGVtcDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlYID0geDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZID0geTtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgICAgICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuICAgICAgICAgIHRoaXMuYmFjaygpO1xyXG4gICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSAtIDMwMCk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja1dpbigpKSB7XHJcbiAgICAgICAgY29uc3Qgd2luQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9hcmQnKTtcclxuICAgICAgICB3aW5Cb2FyZC5jbGFzc0xpc3QuYWRkKCd3aW4nKTtcclxuICAgICAgICB3aW5Cb2FyZC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9J3dpbi10ZXh0Jz7Qp9CY0KLQldCgITwvc3Bhbj5gO1xyXG4gICAgICB9XHJcbiAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUgLSAzMDApO1xyXG4gIH1cclxuXHJcbiAgbW92ZShkaXJlY3Rpb24pIHtcclxuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCAhPT0gMCAmJlxyXG4gICAgICAgICAgKHRoaXMuaGlzdG9yeS5sZW5ndGggPD0gMiB8fCB0aGlzLmVtcHR5WCAtIDEgIT09IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMl1bMF0pXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggLSAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY291bnRlciAtPSAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlYICsgMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVswXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb3VudGVyIC09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEgJiZcclxuICAgICAgICAgICh0aGlzLmhpc3RvcnkubGVuZ3RoIDw9IDIgfHwgdGhpcy5lbXB0eVkgKyAxICE9PSB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDJdWzFdKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdO1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgKz0gMTtcclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNvdW50ZXIgLT0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlZICE9PSAwICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlZIC0gMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVsxXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSAtIDFdID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb3VudGVyIC09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIGNvbnN0IGFyciA9IFtdO1xyXG5cclxuICAgIHRoaXMuYmdQb3NBcnIgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIGFycltpXVtqXSA9IGkgKiB0aGlzLnNpemUgKyBqICsgMTtcclxuICAgICAgICAgIHRoaXMuYmdQb3NBcnIucHVzaChcclxuICAgICAgICAgICAgYCR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBqKX0lICR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBpKX0lYFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYXJyW2ldW2pdID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbiAgfVxyXG5cclxuICBzaHVmZmxlKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICBmb3IgKHRoaXMuY291bnRlciA9IDA7IHRoaXMuY291bnRlciA8IHRoaXMuc2l6ZSAqKiAzOyB0aGlzLmNvdW50ZXIgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgLy8gIE1PVkUgVVBcclxuXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ2Rvd24nKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVuZGVyQm9hcmQoKSB7XHJcbiAgICBsZXQgYm9hcmQgPSAnJztcclxuICAgIGNvbnN0IGJvYXJkV2lkdGggPSBgJHt0aGlzLmJvYXJkV2lkdGh9cmVtYDtcclxuICAgIGxldCBjZWxsTnVtYmVyO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwLCBvcmRlciA9IDE7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgY2VsbE51bWJlciA9IHRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuYXJyW2ldW2pdID8gJ2NlbGwnIDogJ2NlbGwgZW1wdHknO1xyXG4gICAgICAgIGNvbnN0IGRyYWdnYWJsZSA9ICEhdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgY29uc3QgYkdwb3MgPSB0aGlzLmJnUG9zQXJyW2NlbGxOdW1iZXIgLSAxXTtcclxuICAgICAgICBvcmRlciArPSAxO1xyXG5cclxuICAgICAgICBib2FyZCArPSBgPGRpdiBzdHlsZT0nd2lkdGg6JHt0aGlzLmNlbGxTaXplfXJlbTsgaGVpZ2h0OiR7dGhpc1xyXG4gICAgICAgICAgLmNlbGxTaXplfXJlbTsgb3JkZXI6JHtvcmRlcn07IGJhY2tncm91bmQtcG9zaXRpb246ICR7Ykdwb3N9OyBiYWNrZ3JvdW5kLXNpemU6ICR7Ym9hcmRXaWR0aH07JyBpZD0nY2VsbC0ke2NlbGxOdW1iZXJ9JyBjbGFzcz0nJHtjbGFzc05hbWV9JyBkcmFnZ2FibGU9XCIke2RyYWdnYWJsZX1cIj4ke2NlbGxOdW1iZXJ9PC9kaXY+YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcclxuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBib2FyZFdpZHRoO1xyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgZHJhdyhtb2QpIHtcclxuICAgIGNvbnN0IHJlbVBlclRpY2sgPSB0aGlzLmNlbGxTaXplIC8gKHRoaXMuYW5pbWF0aW9uVGltZSAtIG1vZCkgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKG1vZCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcobW9kKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigwKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKDApO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlZIC0gaiA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHRlbXAgPSB6ZXJvLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHplcm8uc3R5bGUub3JkZXIgPSB0aGlzLmUuc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLm9yZGVyID0gdGVtcDtcclxuXHJcbiAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICBpZiAodGhpcy5lbXB0eVggPT09IHRoaXMuZW1wdHlZICYmIHRoaXMuZW1wdHlZID09PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja1dpbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudGltZXJDLnRpbWVyUGF1c2UoKTtcclxuICAgICAgICAgICAgICAgICAgY29uc3Qgd2luQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9hcmQnKTtcclxuICAgICAgICAgICAgICAgICAgd2luQm9hcmQuY2xhc3NMaXN0LmFkZCgnd2luJyk7XHJcbiAgICAgICAgICAgICAgICAgIHdpbkJvYXJkLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0nd2luLXRleHQnPtCj0YDQsCEg0JLRiyDRgNC10YjQuNC70Lgg0LPQvtC70L7QstC+0LvQvtC80LrRgyDQt9CwICR7ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgICAgICAgICAnLnRpbWUnXHJcbiAgICAgICAgICAgICAgICAgICkuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyPC9zcGFuPmA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2hlY2tXaW4oKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIGlmICh0aGlzLndpbltpXVtqXSAhPT0gdGhpcy5hcnJbaV1bal0pIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnNpemUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykudmFsdWU7XHJcblxyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IHBhcnNlRmxvYXQodGhpcy5ib2FyZFdpZHRoIC8gdGhpcy5zaXplIC0gMiAqIHRoaXMubWFyZ2luU2l6ZSkudG9GaXhlZCgzKTtcclxuXHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcblxyXG4gICAgdGhpcy5lbXB0eVggPSB0aGlzLnNpemUgLSAxO1xyXG4gICAgdGhpcy5lbXB0eVkgPSB0aGlzLnNpemUgLSAxO1xyXG5cclxuICAgIHRoaXMuYXJyID0gdGhpcy5jcmVhdGVCb2FyZCgpO1xyXG4gICAgdGhpcy53aW4gPSB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcblxyXG4gICAgdGhpcy5zaHVmZmxlKCk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG4gICAgdGhpcy50aW1lckMuaW5pdCgpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IHBhcnNlRmxvYXQodGhpcy5ib2FyZFdpZHRoIC8gdGhpcy5zaXplIC0gMiAqIHRoaXMubWFyZ2luU2l6ZSkudG9GaXhlZCgzKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcbiAgICB0aGlzLndpbiA9IHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMudGltZXJDLmluaXQoKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9