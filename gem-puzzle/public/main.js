(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.cellSize=10.4,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":console.log(this.history.length-2,this.history.length,this.emptyX-1),this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}console.log(this.history)}renderBoard(){let t="";const e=this.cellSize*this.size+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let o=0;o<this.size;o+=1){i=this.arr[s][o];const h=this.arr[s][o]?"cell":"cell empty",n=!!this.arr[s][o],a=this.bgPosArr[i-1];r+=1,t+=`<div style='order:${r}; background-position: ${a}; background-size: ${e};' id='cell-${i}' class='${h}' draggable="${n}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s),console.log(s.style.width,""+Math.floor(this.cellSize*this.size))}createBoard(){this.arr=[],this.bgPosArr=[],this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?(this.arr[t][e]=t*this.size+e+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*e)}% ${Math.round(100/(this.size-1)*t)}%`)):this.arr[t][e]=0}console.log(this.bgPosArr)}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}checkWin(){const t=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?t[e][i]=e*this.size+i+1:t[e][i]=0}console.log("check for win!",t,this.arr);for(let e=0;e<this.size;e+=1)for(let i=0;i<this.size;i+=1)if(e+i!==2*(this.size-1)&&t[e][i]!==this.arr[e][i])return!1;return console.log("win!",t,this.arr),!0}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(document.querySelector(".board").innerHTML+=`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов`)}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void console.table(this.arr)}}init(){this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.removeBoard(),this.createBoard(),this.shuffle(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}},i=document.createElement("header");i.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <button class="save">Save</button>\n  <button class="load">Load</button>\n  <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  <label for="fieldSize">Field size:</label>\n  <select id="fieldSize">\n  <option value="3">3</option>\n  <option selected="selected" value="4">4</option>\n  <option value="5">5</option>\n  <option value="6">6</option>\n  <option value="7">7</option>\n  <option value="8">8</option>\n</select>\n</header>',document.body.appendChild(i),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({history:t.history,size:t.size,boardTable:t.arr,time:e.currentTime,moves:t.movesCounter,zero:[t.emptyX,t.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{history:i,size:s,boardTable:r,time:o,moves:h,zero:n}=JSON.parse(localStorage.getItem("gameSave"));t.history=i,t.size=s,e.currentTime=o,t.movesCounter=h,t.arr=r,t.load(),e.load(),[t.emptyX,t.emptyY]=n,console.log(t.movesCounter)})),document.getElementById("fieldSize").addEventListener("change",(i=>{console.log(i.target.value),t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFuaW1hdGlvblRpbWUiLCJjZWxsU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiYXJyIiwiRXJyb3IiLCJwdXNoIiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1vdmUiLCJib2FyZFdpZHRoIiwiY2VsbE51bWJlciIsIm9yZGVyIiwiaiIsImNsYXNzTmFtZSIsImRyYWdnYWJsZSIsImJHcG9zIiwiYmdQb3NBcnIiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInN0eWxlIiwid2lkdGgiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsInJvdW5kIiwicmVtUGVyVGljayIsInRpbWVQYXNzZWQiLCJlIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lciIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImRyYXciLCJ3aW4iLCJudW1iZXIiLCJhYnMiLCJtb3Zlc0NvdW50ZXIiLCJxdWVyeVNlbGVjdG9yIiwiemVybyIsIm1vdmVBbmltYXRpb24iLCJzZXRUaW1lb3V0IiwidGVtcCIsImNoZWNrV2luIiwidGFibGUiLCJnZXRFbGVtZW50QnlJZCIsInZhbHVlIiwiY3JlYXRlQm9hcmQiLCJzaHVmZmxlIiwicmVuZGVyQm9hcmQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiY3VycmVudFRpbWUiLCJ0aW1lIiwic2VjVG9NaW5BbmRTZWMiLCJtaW51dGVzIiwic2VjIiwidG9GaXhlZCIsInJlbmRlclRpbWVyIiwidGltZXJTdG9wIiwiY2FsY0N1cnJlbnRUaW1lIiwiaGVhZGVyIiwiaW5pdCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYm9hcmRUYWJsZSIsIm1vdmVzIiwicGFyc2UiLCJnZXRJdGVtIiwibG9hZCJdLCJtYXBwaW5ncyI6Im1CQUdBLE1BQU1BLEVBQVEsSUNIQyxNQUNiLGNBQ0VDLEtBQUtDLFFBQVUsR0FDZkQsS0FBS0UsS0FBTyxFQUNaRixLQUFLRyxPQUFTLEVBQ2RILEtBQUtJLE9BQVMsRUFDZEosS0FBS0ssY0FBZ0IsSUFDckJMLEtBQUtNLFNBQVcsS0FDaEJOLEtBQUtPLFlBQWMsS0FDakJDLFNBQVNDLGlCQUFpQixVQUFVQyxTQUFTQyxJQUMzQ0gsU0FBU0ksS0FBS0MsWUFBWUYsT0FPaEMsS0FBS0csR0FDSCxPQUFRQSxHQUNOLElBQUssS0FDSEMsUUFBUUMsSUFBSWhCLEtBQUtDLFFBQVFnQixPQUFTLEVBQUdqQixLQUFLQyxRQUFRZ0IsT0FBUWpCLEtBQUtHLE9BQVMsR0FFeEVILEtBQUtrQixJQUFJbEIsS0FBS0csUUFBUUgsS0FBS0ksUUFBVUosS0FBS2tCLElBQUlsQixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQ3BFSixLQUFLa0IsSUFBSWxCLEtBQUtHLE9BQVMsR0FBR0gsS0FBS0ksUUFBVSxFQUN6Q0osS0FBS0csUUFBVSxFQUNmLE1BQ0YsSUFBSyxPQUNISCxLQUFLa0IsSUFBSWxCLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtrQixJQUFJbEIsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS2tCLElBQUlsQixLQUFLRyxPQUFTLEdBQUdI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LEtBQU1ILEVBQU1HLEtBQ1o4RixXQUFZakcsRUFBTW1CLElBQ2xCZ0UsS0FBTS9CLEVBQU04QixZQUNaZ0IsTUFBT2xHLEVBQU0yRCxhQUNiRSxLQUFNLENBQUU3RCxFQUFNSSxPQUFRSixFQUFNSyxjQUtsQ0ksU0FBU21ELGNBQWMsU0FBU2EsaUJBQWlCLFNBQVMsS0FDeEQsTUFBTSxRQUFFdkUsRUFBTyxLQUFFQyxFQUFJLFdBQUU4RixFQUFVLEtBQUVkLEVBQUksTUFBRWUsRUFBSyxLQUFFckMsR0FBU2tDLEtBQUtJLE1BQzVETixhQUFhTyxRQUFRLGFBRXZCcEcsRUFBTUUsUUFBVUEsRUFDaEJGLEVBQU1HLEtBQU9BLEVBQ2JpRCxFQUFNOEIsWUFBY0MsRUFDcEJuRixFQUFNMkQsYUFBZXVDLEVBQ3JCbEcsRUFBTW1CLElBQU04RSxFQUNaakcsRUFBTXFHLE9BQ05qRCxFQUFNaUQsUUFDSnJHLEVBQU1JLE9BQVFKLEVBQU1LLFFBQVd3RCxFQUNqQzdDLFFBQVFDLElBQUlqQixFQUFNMkQsaUJBR3BCbEQsU0FBUzBELGVBQWUsYUFBYU0saUJBQWlCLFVBQVdDLElBQy9EMUQsUUFBUUMsSUFBSXlELEVBQUlDLE9BQU9QLE9BQ3ZCcEUsRUFBTTRGLE9BQ054QyxFQUFNd0MsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5pbXBvcnQgVGltZXIgZnJvbSAnLi9UaW1lci5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5jb25zdCB0aW1lciA9IG5ldyBUaW1lcigpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcblxyXG5oZWFkZXIuaW5uZXJIVE1MID0gYCAgXHJcbjxoZWFkZXIgY2xhc3M9XCJoZWFkZXJcIj5cclxuICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWVcIj5OZXcgZ2FtZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJzYXZlXCI+U2F2ZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJsb2FkXCI+TG9hZDwvYnV0dG9uPlxyXG4gIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wOjAwPC9zcGFuPjwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDxsYWJlbCBmb3I9XCJmaWVsZFNpemVcIj5GaWVsZCBzaXplOjwvbGFiZWw+XHJcbiAgPHNlbGVjdCBpZD1cImZpZWxkU2l6ZVwiPlxyXG4gIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gIDxvcHRpb24gc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiIHZhbHVlPVwiNFwiPjQ8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNVwiPjU8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNlwiPjY8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiN1wiPjc8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiOFwiPjg8L29wdGlvbj5cclxuPC9zZWxlY3Q+XHJcbjwvaGVhZGVyPmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlYWRlcik7XHJcblxyXG5ib2FyZC5pbml0KCk7XHJcbnRpbWVyLmluaXQoKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctZ2FtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcclxuICAgICdnYW1lU2F2ZScsXHJcbiAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGhpc3Rvcnk6IGJvYXJkLmhpc3RvcnksXHJcbiAgICAgIHNpemU6IGJvYXJkLnNpemUsXHJcbiAgICAgIGJvYXJkVGFibGU6IGJvYXJkLmFycixcclxuICAgICAgdGltZTogdGltZXIuY3VycmVudFRpbWUsXHJcbiAgICAgIG1vdmVzOiBib2FyZC5tb3Zlc0NvdW50ZXIsXHJcbiAgICAgIHplcm86IFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXVxyXG4gICAgfSlcclxuICApO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY29uc3QgeyBoaXN0b3J5LCBzaXplLCBib2FyZFRhYmxlLCB0aW1lLCBtb3ZlcywgemVybyB9ID0gSlNPTi5wYXJzZShcclxuICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYW1lU2F2ZScpXHJcbiAgKTtcclxuICBib2FyZC5oaXN0b3J5ID0gaGlzdG9yeTtcclxuICBib2FyZC5zaXplID0gc2l6ZTtcclxuICB0aW1lci5jdXJyZW50VGltZSA9IHRpbWU7XHJcbiAgYm9hcmQubW92ZXNDb3VudGVyID0gbW92ZXM7XHJcbiAgYm9hcmQuYXJyID0gYm9hcmRUYWJsZTtcclxuICBib2FyZC5sb2FkKCk7XHJcbiAgdGltZXIubG9hZCgpO1xyXG4gIFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSA9IHplcm87XHJcbiAgY29uc29sZS5sb2coYm9hcmQubW92ZXNDb3VudGVyKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2dCkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGV2dC50YXJnZXQudmFsdWUpO1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcblxyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hbmltYXRpb25UaW1lID0gNDAwO1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IDEwLjQ7IC8vICByZW0gd2l0aCBtYXJnaW5cclxuICAgIHRoaXMucmVtb3ZlQm9hcmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZCcpLmZvckVhY2goKGVsZW0pID0+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBsZXQgc2l6ZSA9IDQ7XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDIsIHRoaXMuaGlzdG9yeS5sZW5ndGgsIHRoaXMuZW1wdHlYIC0gMSk7XHJcblxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVggLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WSArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNodWZmbGUoKSB7XHJcbiAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZSAqKiAzOyBpICs9IDEpIHtcclxuICAgICAgc3dpdGNoIChNYXRoLmZsb29yKDQgKiBNYXRoLnJhbmRvbSgpKSkge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG5cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCd1cCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgRE9XTlxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2Rvd24nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlZICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFJJR0hUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIExFRlRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdsZWZ0Jyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAhPT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgVVBcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCd1cCcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IDApIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFJJR0hUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuICAgICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgaSAtPSAxO1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2codGhpcy5oaXN0b3J5KTtcclxuICB9XHJcblxyXG4gIHJlbmRlckJvYXJkKCkge1xyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBjb25zdCBib2FyZFdpZHRoID0gYCR7dGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZX1yZW1gO1xyXG4gICAgbGV0IGNlbGxOdW1iZXI7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIG9yZGVyID0gMTsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBjZWxsTnVtYmVyID0gdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5hcnJbaV1bal0gPyAnY2VsbCcgOiAnY2VsbCBlbXB0eSc7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlID0gISF0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBiR3BvcyA9IHRoaXMuYmdQb3NBcnJbY2VsbE51bWJlciAtIDFdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J29yZGVyOiR7b3JkZXJ9OyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAke2JHcG9zfTsgYmFja2dyb3VuZC1zaXplOiAke2JvYXJkV2lkdGh9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcbiAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gYm9hcmRXaWR0aDtcclxuICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gYm9hcmQ7XHJcblxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhlbGVtZW50LnN0eWxlLndpZHRoLCBgJHtNYXRoLmZsb29yKHRoaXMuY2VsbFNpemUgKiB0aGlzLnNpemUpfWApO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQm9hcmQoKSB7XHJcbiAgICB0aGlzLmFyciA9IFtdO1xyXG4gICAgdGhpcy5iZ1Bvc0FyciA9IFtdO1xyXG4gICAgdGhpcy5lbXB0eVggPSB0aGlzLnNpemUgLSAxO1xyXG4gICAgdGhpcy5lbXB0eVkgPSB0aGlzLnNpemUgLSAxO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICB0aGlzLmFycltpXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IGkgKiB0aGlzLnNpemUgKyBqICsgMTtcclxuICAgICAgICAgIHRoaXMuYmdQb3NBcnIucHVzaChcclxuICAgICAgICAgICAgYCR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBqKX0lICR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBpKX0lYFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5hcnJbaV1bal0gPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2codGhpcy5iZ1Bvc0Fycik7XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcmVtUGVyVGljayA9IHRoaXMuY2VsbFNpemUgLyB0aGlzLmFuaW1hdGlvblRpbWUgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIGNoZWNrV2luKCkge1xyXG4gICAgY29uc3Qgd2luID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHdpbltpXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICB3aW5baV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHdpbltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ2NoZWNrIGZvciB3aW4hJywgd2luLCB0aGlzLmFycik7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBpZiAod2luW2ldW2pdICE9PSB0aGlzLmFycltpXVtqXSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCd3aW4hJywgd2luLCB0aGlzLmFycik7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwIScpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3VwJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqIDwgMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmlnaHQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHplcm8uc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgemVyby5zdHlsZS5vcmRlciA9IHRoaXMuZS5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUub3JkZXIgPSB0ZW1wO1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCA9PT0gdGhpcy5lbXB0eVkgJiYgdGhpcy5lbXB0eVkgPT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrV2luKCkpIHtcclxuICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgICAgICAgICAnLmJvYXJkJ1xyXG4gICAgICAgICAgICAgICAgICApLmlubmVySFRNTCArPSBg0KPRgNCwISDQktGLINGA0LXRiNC40LvQuCDQs9C+0LvQvtCy0L7Qu9C+0LzQutGDINC30LAgJHtkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGltZScpXHJcbiAgICAgICAgICAgICAgICAgICAgLmlubmVySFRNTH0g0LggJHtkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTH0g0YXQvtC00L7QsmA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xyXG5cclxuICAgICAgICAgICAgWyB0aGlzLmFycltpXVtqXSwgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSBdID0gW1xyXG4gICAgICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0sXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbaV1bal1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eVggPSBpO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WSA9IGo7XHJcbiAgICAgICAgICAgIGNvbnNvbGUudGFibGUodGhpcy5hcnIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpc1xyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSAwO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuICAgIHRoaXMuc2l6ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS52YWx1ZTtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG4gICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWQoKSB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG5cclxuICAgIGNvbnNvbGUudGFibGUodGhpcy5hcnIpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWVyIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuY3VycmVudFRpbWUgPSAwO1xyXG4gICAgLy8gdGhpcy50aW1lciA9ICcwOjAwJztcclxuICB9XHJcblxyXG4gIGNhbGNDdXJyZW50VGltZSgpIHtcclxuICAgIHRoaXMudGltZSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgdGhpcy5jdXJyZW50VGltZSArPSAxO1xyXG4gICAgICB0aGlzLnNlY1RvTWluQW5kU2VjKCk7XHJcbiAgICB9LCAxMDAwKTtcclxuICB9XHJcblxyXG4gIHNlY1RvTWluQW5kU2VjKCkge1xyXG4gICAgdGhpcy5taW51dGVzID0gTWF0aC5mbG9vcih0aGlzLmN1cnJlbnRUaW1lIC8gNjApO1xyXG5cclxuICAgIHRoaXMuc2VjID0gKHRoaXMuY3VycmVudFRpbWUgJSA2MCkudG9GaXhlZCgwKTtcclxuICAgIHRoaXMudGltZXIgPSBgJHt0aGlzLm1pbnV0ZXN9OiR7dGhpcy5zZWMgPCAxMCA/ICcwJyA6ICcnfSR7dGhpcy5zZWN9YDtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHRpbWVyU3RvcCgpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lKTtcclxuICAgIHRoaXMudGltZXIgPSAnMDowMCc7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUaW1lcigpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJykuaW5uZXJIVE1MID0gdGhpcy50aW1lcjtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnRpbWVyU3RvcCgpO1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IG51bGw7XHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLnNlY1RvTWluQW5kU2VjKCk7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcblxyXG4gICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=