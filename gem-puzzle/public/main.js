(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.cellSize=10.4,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){document.querySelector(".move").innerHTML=this.movesCounter;let t,e="";for(let i=0,s=1;i<this.size;i+=1)for(let r=0;r<this.size;r+=1){t=this.arr[i][r];const o=this.arr[i][r]?"cell":"cell empty",h=!!this.arr[i][r];s+=1,e+=`<div style='order:${s};' id='cell-${t}' class='${o}' draggable="${h}">${t}</div>`}const i=document.createElement("div");i.classList.add("board"),i.style.width=this.cellSize*this.size+"rem",i.innerHTML=e,document.body.appendChild(i),console.log(i.style.width,""+Math.floor(this.cellSize*this.size))}createBoard(){this.arr=[],this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}checkWin(){const t=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?t[e][i]=e*this.size+i+1:t[e][i]=0}console.log("check for win!",t,this.arr);for(let e=0;e<this.size;e+=1)for(let i=0;i<this.size;i+=1)if(e+i!==2*(this.size-1)&&t[e][i]!==this.arr[e][i])return!1;return console.log("win!",t,this.arr),!0}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform=""}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,console.table(this.arr),void(this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(document.querySelector(".board").innerHTML=`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов`))}}init(){this.size=document.getElementById("fieldSize").value,this.removeBoard(),this.createBoard(),this.shuffle(),this.movesCounter=0,this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}},i=document.createElement("header");i.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <button class="save">Save</button>\n  <button class="load">Load</button>\n  <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  <label for="fieldSize">Field size:</label>\n  <select id="fieldSize">\n  <option value="3">3</option>\n  <option selected="selected" value="4">4</option>\n  <option value="5">5</option>\n  <option value="6">6</option>\n  <option value="7">7</option>\n  <option value="8">8</option>\n</select>\n</header>',document.body.appendChild(i),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({history:t.history,size:t.size,boardTable:t.arr,time:e.currentTime,moves:t.movesCounter,zero:[t.emptyX,t.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{history:i,size:s,boardTable:r,time:o,moves:h,zero:n}=JSON.parse(localStorage.getItem("gameSave"));t.history=i,t.size=s,e.currentTime=o,t.movesCounter=h,t.arr=r,t.load(),e.load(),[t.emptyX,t.emptyY]=n,console.log(t.movesCounter)})),document.getElementById("fieldSize").addEventListener("change",(i=>{console.log(i.target.value),t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFuaW1hdGlvblRpbWUiLCJjZWxsU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJhcnIiLCJFcnJvciIsInB1c2giLCJpIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibW92ZSIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJtb3Zlc0NvdW50ZXIiLCJjZWxsTnVtYmVyIiwib3JkZXIiLCJqIiwiY2xhc3NOYW1lIiwiZHJhZ2dhYmxlIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJjb25zb2xlIiwibG9nIiwicmVtUGVyVGljayIsInRpbWVQYXNzZWQiLCJlIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ0aW1lciIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImRyYXciLCJ3aW4iLCJudW1iZXIiLCJsZW5ndGgiLCJhYnMiLCJ6ZXJvIiwibW92ZUFuaW1hdGlvbiIsInNldFRpbWVvdXQiLCJ0ZW1wIiwidGFibGUiLCJjaGVja1dpbiIsImdldEVsZW1lbnRCeUlkIiwidmFsdWUiLCJjcmVhdGVCb2FyZCIsInNodWZmbGUiLCJyZW5kZXJCb2FyZCIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwidGFyZ2V0Iiwic3dhcCIsInBhcnNlSW50IiwiZHJhZ1N0YXJ0IiwiZHJhZ092ZXIiLCJkcmFnRHJvcCIsImRyYWdFbmQiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZWNUb01pbkFuZFNlYyIsIm1pbnV0ZXMiLCJzZWMiLCJ0b0ZpeGVkIiwicmVuZGVyVGltZXIiLCJ0aW1lclN0b3AiLCJjYWxjQ3VycmVudFRpbWUiLCJoZWFkZXIiLCJpbml0IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJib2FyZFRhYmxlIiwibW92ZXMiLCJwYXJzZSIsImdldEl0ZW0iLCJsb2FkIl0sIm1hcHBpbmdzIjoibUJBR0EsTUFBTUEsRUFBUSxJQ0hDLE1BQ2IsY0FDRUMsS0FBS0MsUUFBVSxHQUNmRCxLQUFLRSxLQUFPLEVBQ1pGLEtBQUtHLE9BQVMsRUFDZEgsS0FBS0ksT0FBUyxFQUNkSixLQUFLSyxjQUFnQixJQUNyQkwsS0FBS00sU0FBVyxLQUNoQk4sS0FBS08sWUFBYyxLQUNqQkMsU0FBU0MsaUJBQWlCLFVBQVVDLFNBQVNDLElBQzNDSCxTQUFTSSxLQUFLQyxZQUFZRixPQU9oQyxLQUFLRyxHQUNILE9BQVFBLEdBQ04sSUFBSyxLQUNIZCxLQUFLZSxJQUFJZixLQUFLRyxRQUFRSCxLQUFLSSxRQUFVSixLQUFLZSxJQUFJZixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQ3BFSixLQUFLZSxJQUFJZixLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQVUsRUFDekNKLEtBQUtHLFFBQVUsRUFDZixNQUNGLElBQUssT0FDSEgsS0FBS2UsSUFBSWYsS0FBS0csUUFBUUgsS0FBS0ksUUFBVUosS0FBS2UsSUFBSWYsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS2UsSUFBSWYsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUFVLEVBQ3pDSixLQUFLRyxRQUFVLEVBQ2YsTUFDRixJQUFLLFFBQ0hILEtBQUtlLElBQUlmLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtlLElBQUlmLEtBQUtHLFFBQVFILEtBQUtJLE9BQVMsR0FDekVK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aUJBR3BCakIsU0FBU3NELGVBQWUsYUFBYU0saUJBQWlCLFVBQVdDLElBQy9EL0IsUUFBUUMsSUFBSThCLEVBQUlDLE9BQU9QLE9BQ3ZCaEUsRUFBTXdGLE9BQ052QyxFQUFNdUMsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5pbXBvcnQgVGltZXIgZnJvbSAnLi9UaW1lci5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5jb25zdCB0aW1lciA9IG5ldyBUaW1lcigpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcblxyXG5oZWFkZXIuaW5uZXJIVE1MID0gYCAgXHJcbjxoZWFkZXIgY2xhc3M9XCJoZWFkZXJcIj5cclxuICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWVcIj5OZXcgZ2FtZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJzYXZlXCI+U2F2ZTwvYnV0dG9uPlxyXG4gIDxidXR0b24gY2xhc3M9XCJsb2FkXCI+TG9hZDwvYnV0dG9uPlxyXG4gIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wOjAwPC9zcGFuPjwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDxsYWJlbCBmb3I9XCJmaWVsZFNpemVcIj5GaWVsZCBzaXplOjwvbGFiZWw+XHJcbiAgPHNlbGVjdCBpZD1cImZpZWxkU2l6ZVwiPlxyXG4gIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gIDxvcHRpb24gc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiIHZhbHVlPVwiNFwiPjQ8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNVwiPjU8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiNlwiPjY8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiN1wiPjc8L29wdGlvbj5cclxuICA8b3B0aW9uIHZhbHVlPVwiOFwiPjg8L29wdGlvbj5cclxuPC9zZWxlY3Q+XHJcbjwvaGVhZGVyPmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlYWRlcik7XHJcblxyXG5ib2FyZC5pbml0KCk7XHJcbnRpbWVyLmluaXQoKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctZ2FtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcclxuICAgICdnYW1lU2F2ZScsXHJcbiAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGhpc3Rvcnk6IGJvYXJkLmhpc3RvcnksXHJcbiAgICAgIHNpemU6IGJvYXJkLnNpemUsXHJcbiAgICAgIGJvYXJkVGFibGU6IGJvYXJkLmFycixcclxuICAgICAgdGltZTogdGltZXIuY3VycmVudFRpbWUsXHJcbiAgICAgIG1vdmVzOiBib2FyZC5tb3Zlc0NvdW50ZXIsXHJcbiAgICAgIHplcm86IFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXVxyXG4gICAgfSlcclxuICApO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY29uc3QgeyBoaXN0b3J5LCBzaXplLCBib2FyZFRhYmxlLCB0aW1lLCBtb3ZlcywgemVybyB9ID0gSlNPTi5wYXJzZShcclxuICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYW1lU2F2ZScpXHJcbiAgKTtcclxuICBib2FyZC5oaXN0b3J5ID0gaGlzdG9yeTtcclxuICBib2FyZC5zaXplID0gc2l6ZTtcclxuICB0aW1lci5jdXJyZW50VGltZSA9IHRpbWU7XHJcbiAgYm9hcmQubW92ZXNDb3VudGVyID0gbW92ZXM7XHJcbiAgYm9hcmQuYXJyID0gYm9hcmRUYWJsZTtcclxuICBib2FyZC5sb2FkKCk7XHJcbiAgdGltZXIubG9hZCgpO1xyXG4gIFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSA9IHplcm87XHJcbiAgY29uc29sZS5sb2coYm9hcmQubW92ZXNDb3VudGVyKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2dCkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGV2dC50YXJnZXQudmFsdWUpO1xyXG4gIGJvYXJkLmluaXQoKTtcclxuICB0aW1lci5pbml0KCk7XHJcblxyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hbmltYXRpb25UaW1lID0gNDAwO1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IDEwLjQ7IC8vICByZW0gd2l0aCBtYXJnaW5cclxuICAgIHRoaXMucmVtb3ZlQm9hcmQgPSAoKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib2FyZCcpLmZvckVhY2goKGVsZW0pID0+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBsZXQgc2l6ZSA9IDQ7XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVkgLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2h1ZmZsZSgpIHtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplICoqIDM7IGkgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuICAgICAgICBjb25zdCBkcmFnZ2FibGUgPSAhIXRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J29yZGVyOiR7b3JkZXJ9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcbiAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gYCR7dGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZX1yZW1gO1xyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGVsZW1lbnQuc3R5bGUud2lkdGgsIGAke01hdGguZmxvb3IodGhpcy5jZWxsU2l6ZSAqIHRoaXMuc2l6ZSl9YCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIHRoaXMuYXJyID0gW107XHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHRoaXMuYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcmVtUGVyVGljayA9IHRoaXMuY2VsbFNpemUgLyB0aGlzLmFuaW1hdGlvblRpbWUgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIGNoZWNrV2luKCkge1xyXG4gICAgY29uc3Qgd2luID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHdpbltpXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICB3aW5baV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHdpbltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ2NoZWNrIGZvciB3aW4hJywgd2luLCB0aGlzLmFycik7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBpZiAod2luW2ldW2pdICE9PSB0aGlzLmFycltpXVtqXSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCd3aW4hJywgd2luLCB0aGlzLmFycik7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwIScpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3VwJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqIDwgMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmlnaHQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHplcm8uc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgemVyby5zdHlsZS5vcmRlciA9IHRoaXMuZS5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUub3JkZXIgPSB0ZW1wO1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcblxyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuICAgICAgICAgICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5lbXB0eVggPT09IHRoaXMuZW1wdHlZICYmIHRoaXMuZW1wdHlZID09PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgICAgICAgJy5ib2FyZCdcclxuICAgICAgICAgICAgICAgICkuaW5uZXJIVE1MID0gYNCj0YDQsCEg0JLRiyDRgNC10YjQuNC70Lgg0LPQvtC70L7QstC+0LvQvtC80LrRgyDQt9CwICR7ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKVxyXG4gICAgICAgICAgICAgICAgICAuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyYDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXNcclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMuc2l6ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS52YWx1ZTtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSAwO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG5cclxuICAgIGNvbnNvbGUudGFibGUodGhpcy5hcnIpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuXHJcbiAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIC8vIHRoaXMudGltZXIgPSAnMDowMCc7XHJcbiAgfVxyXG5cclxuICBjYWxjQ3VycmVudFRpbWUoKSB7XHJcbiAgICB0aGlzLnRpbWUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY3VycmVudFRpbWUgKz0gMTtcclxuICAgICAgdGhpcy5zZWNUb01pbkFuZFNlYygpO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG5cclxuICBzZWNUb01pbkFuZFNlYygpIHtcclxuICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IodGhpcy5jdXJyZW50VGltZSAvIDYwKTtcclxuXHJcbiAgICB0aGlzLnNlYyA9ICh0aGlzLmN1cnJlbnRUaW1lICUgNjApLnRvRml4ZWQoMCk7XHJcbiAgICB0aGlzLnRpbWVyID0gYCR7dGhpcy5taW51dGVzfToke3RoaXMuc2VjIDwgMTAgPyAnMCcgOiAnJ30ke3RoaXMuc2VjfWA7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcbiAgfVxyXG5cclxuICB0aW1lclN0b3AoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgICB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyVGltZXIoKSB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGltZScpLmlubmVySFRNTCA9IHRoaXMudGltZXI7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuY3VycmVudFRpbWUgPSBudWxsO1xyXG4gICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuICB9XHJcblxyXG4gIGxvYWQoKSB7XHJcbiAgICB0aGlzLnRpbWVyU3RvcCgpO1xyXG4gICAgdGhpcy5zZWNUb01pbkFuZFNlYygpO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG5cclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG59XHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9