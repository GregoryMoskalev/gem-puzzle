(()=>{"use strict";class t{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}timerPause(){clearInterval(this.time)}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}}const e=new class{constructor(){this.timerC=new t,this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.boardWidth=40.8,this.marginSize=.1,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}randomImgNumber(t,e){this.imgNumb=Math.floor(Math.random()*(t-e)+e)}back(){setTimeout((()=>{if(this.history.length){const[t,e]=this.history.pop();this.e=document.querySelector("#cell-"+this.arr[t][e]),this.emptyX<t?(this.direction="up",this.moveAnimation(300)):this.emptyX>t?(this.direction="down",this.moveAnimation(300)):this.emptyY<e?(this.direction="left",this.moveAnimation(300)):this.emptyY>e&&(this.direction="right",this.moveAnimation(300)),setTimeout((()=>{const i=this.arr[this.emptyX][this.emptyY];this.arr[this.emptyX][this.emptyY]=this.arr[t][e],this.arr[t][e]=i,this.emptyX=t,this.emptyY=e,this.removeBoard(),this.renderBoard(),this.back()}),this.animationTime-300)}else this.checkWin()&&this.setWinMessage(!0)}),this.animationTime-300)}move(t){switch(t){case"up":0!==this.emptyX&&(this.history.length<=2||this.emptyX-1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"down":this.emptyX!==this.size-1&&(this.history.length<=2||this.emptyX+1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"right":this.emptyY!==this.size-1&&(this.history.length<=2||this.emptyY+1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"left":0!==this.emptyY&&(this.history.length<=2||this.emptyY-1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;default:throw new Error(">:(")}}createBoard(){const t=[];this.bgPosArr=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?(t[e][i]=e*this.size+i+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*i)}% ${Math.round(100/(this.size-1)*e)}%`)):t[e][i]=0}return t}shuffle(){for(this.history.push([this.emptyX,this.emptyY]),this.counter=0;this.counter<this.size**3;this.counter+=1)switch(Math.floor(4*Math.random())){case 0:this.move("up");break;case 1:this.move("right");break;case 2:this.move("down");break;case 3:this.move("left");break;default:throw new Error(">:(")}}renderBoard(){let t="";const e=this.boardWidth+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let h=0;h<this.size;h+=1){i=this.arr[s][h];const n=this.arr[s][h]?"cell":"cell empty",o=this.arr[s][h]?`background: url(../assets/${this.imgNumb}.jpg);`:"",a=!!this.arr[s][h],m=this.bgPosArr[i-1];r+=1,t+=`<div \n          style='width:${this.cellSize}rem;\n          height:${this.cellSize}rem;\n          order:${r};\n          ${o}\n          background-position: ${m};\n          background-size: ${e};'\n          id='cell-${i}'\n          class='${n}'\n          draggable="${a}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s)}draw(t){const e=this.cellSize/(this.animationTime-t)*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-e}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${e}rem)`;break;case"left":this.e.style.transform=`translate( ${-e}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${e}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(t){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw(t)}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(this.direction="up",this.moveAnimation(0)):this.emptyX-e>0?(this.direction="down",this.moveAnimation(0)):this.emptyY-i<0?(this.direction="left",this.moveAnimation(0)):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(0)),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(this.timerC.timerPause(),this.setWinMessage())}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void this.history.push([this.emptyX,this.emptyY])}}checkWin(){for(let t=0;t<this.size;t+=1)for(let e=0;e<this.size;e+=1)if(t+e!==2*(this.size-1)&&this.win[t][e]!==this.arr[t][e])return!1;return!0}setWinMessage(t){const e=document.querySelector(".board");e.classList.add("win"),e.innerHTML=t?"<span class='win-text'>ЧИТЕР!</span>":`<span class='win-text'>Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов</span>`,e.style.backgroundImage=`url(../assets/${this.imgNumb}.jpg)`}init(){this.randomImgNumber(150,1),this.history=[],this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),this.removeBoard(),this.emptyX=this.size-1,this.emptyY=this.size-1,this.arr=this.createBoard(),this.win=this.createBoard(),this.shuffle(),this.renderBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),this.win=this.createBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},i=document.createElement("header");i.classList.add("header"),i.innerHTML='<h1 class="heading">gem puzzle</h1>',document.body.appendChild(i);const s=document.createElement("div");s.classList.add("menu"),s.innerHTML='  \n  <div class="settings">\n    <button style="position: absolute; top: 0;" class=\'cheat\'>CHEAT</button>\n    <button class="new-game btn">New</button>\n    <button class="save btn">Save</button>\n    <button class="load btn">Load</button>\n    <div class="size">\n      <select id="fieldSize">\n      <option selected="selected" value="4" disabled>Field size</option>\n        <option value="3">3</option>\n        <option value="4">4</option>\n        <option value="5">5</option>\n        <option value="6">6</option>\n        <option value="7">7</option>\n        <option value="8">8</option>\n      </select>\n    </div>\n  </div>\n  <div class="counters">\n    <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n    <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  </div>',document.body.appendChild(s),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({bgPosition:e.bgPosArr,history:e.history,size:e.size,boardTable:e.arr,time:e.timerC.currentTime,moves:e.movesCounter,zero:[e.emptyX,e.emptyY],imgNumb:e.imgNumb}))})),document.querySelector(".load").addEventListener("click",(()=>{const{bgPosition:t,history:i,size:s,boardTable:r,time:h,moves:n,zero:o,imgNumb:a}=JSON.parse(localStorage.getItem("gameSave"));e.bgPosArr=t,e.history=i,e.size=s,e.timerC.currentTime=h,e.movesCounter=n,e.arr=r,[e.emptyX,e.emptyY]=o,e.imgNumb=a,e.load(),e.timerC.load()})),document.getElementById("fieldSize").addEventListener("change",(()=>{e.init(),e.timerC.init()})),document.querySelector(".cheat").addEventListener("click",(()=>{e.timerC.timerPause(),e.back()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL1RpbWVyLmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9Cb2FyZC5qcyJdLCJuYW1lcyI6WyJUaW1lciIsInRoaXMiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZXRJbnRlcnZhbCIsInNlY1RvTWluQW5kU2VjIiwibWludXRlcyIsIk1hdGgiLCJmbG9vciIsInNlYyIsInRvRml4ZWQiLCJ0aW1lciIsInJlbmRlclRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRpbWVyU3RvcCIsImNhbGNDdXJyZW50VGltZSIsImJvYXJkIiwidGltZXJDIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhbmltYXRpb25UaW1lIiwiYm9hcmRXaWR0aCIsIm1hcmdpblNpemUiLCJyZW1vdmVCb2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbSIsImJvZHkiLCJyZW1vdmVDaGlsZCIsIm1heCIsIm1pbiIsImltZ051bWIiLCJyYW5kb20iLCJzZXRUaW1lb3V0IiwibGVuZ3RoIiwieCIsInkiLCJwb3AiLCJlIiwiYXJyIiwiZGlyZWN0aW9uIiwibW92ZUFuaW1hdGlvbiIsInRlbXAiLCJyZW5kZXJCb2FyZCIsImJhY2siLCJjaGVja1dpbiIsInNldFdpbk1lc3NhZ2UiLCJwdXNoIiwiY291bnRlciIsIkVycm9yIiwiYmdQb3NBcnIiLCJpIiwiaiIsInJvdW5kIiwibW92ZSIsImNlbGxOdW1iZXIiLCJvcmRlciIsImNsYXNzTmFtZSIsImJnRm9yQ2VsbCIsImRyYWdnYWJsZSIsImJHcG9zIiwiY2VsbFNpemUiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInN0eWxlIiwid2lkdGgiLCJhcHBlbmRDaGlsZCIsIm1vZCIsInJlbVBlclRpY2siLCJ0aW1lUGFzc2VkIiwidHJhbnNmb3JtIiwiaW5BbmltYXRpb24iLCJzdGFydCIsIkRhdGUiLCJub3ciLCJkcmF3IiwibnVtYmVyIiwiYWJzIiwibW92ZXNDb3VudGVyIiwiemVybyIsInRpbWVyUGF1c2UiLCJ3aW4iLCJjaGVhdCIsIndpbkJvYXJkIiwiYmFja2dyb3VuZEltYWdlIiwicmFuZG9tSW1nTnVtYmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJjcmVhdGVCb2FyZCIsInNodWZmbGUiLCJpbml0IiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJzd2FwIiwicGFyc2VJbnQiLCJkcmFnU3RhcnQiLCJkcmFnT3ZlciIsImRyYWdEcm9wIiwiZHJhZ0VuZCIsImhlYWRlciIsIm1lbnUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImJnUG9zaXRpb24iLCJib2FyZFRhYmxlIiwibW92ZXMiLCJwYXJzZSIsImdldEl0ZW0iLCJsb2FkIl0sIm1hcHBpbmdzIjoibUJBQWUsTUFBTUEsRUFDbkIsY0FDRUMsS0FBS0MsWUFBYyxFQUlyQixrQkFDRUQsS0FBS0UsS0FBT0MsYUFBWSxLQUN0QkgsS0FBS0MsYUFBZSxFQUNwQkQsS0FBS0ksbUJBQ0osS0FHTCxpQkFDRUosS0FBS0ssUUFBVUMsS0FBS0MsTUFBTVAsS0FBS0MsWUFBYyxJQUU3Q0QsS0FBS1EsS0FBT1IsS0FBS0MsWUFBYyxJQUFJUSxRQUFRLEdBQzNDVCxLQUFLVSxNQUFRLEdBQUdWLEtBQUtLLFdBQVdMLEtBQUtRLElBQU0sR0FBSyxJQUFNLEtBQUtSLEtBQUtRLE1BQ2hFUixLQUFLVyxjQUdQLFlBQ0VDLGNBQWNaLEtBQUtFLE1BQ25CRixLQUFLVSxNQUFRLE9BQ2JWLEtBQUtXLGNBR1AsYUFDRUMsY0FBY1osS0FBS0UsTUFHckIsY0FDRVcsU0FBU0MsY0FBYyxTQUFTQyxVQUFZZixLQUFLVSxNQUduRCxPQUNFVixLQUFLZ0IsWUFDTGhCLEtBQUtDLFlBQWMsS0FDbkJELEtBQUtpQixrQkFHUCxPQUNFakIsS0FBS2dCLFlBQ0xoQixLQUFLSSxpQkFDTEosS0FBS1csY0FFTFgsS0FBS2lCLG1CQzVDVCxNQUFNQyxFQUFRLElDQUMsTUFDYixjQUNFbEIsS0FBS21CLE9BQVMsSUFBSXBCLEVBQ2xCQyxLQUFLb0IsUUFBVSxHQUNmcEIsS0FBS3FCLEtBQU8sRUFDWnJCLEtBQUtzQixPQUFTLEVBQ2R0QixLQUFLdUIsT0FBUyxFQUNkdkIsS0FBS3dCLGNBQWdCLElBQ3JCeEIsS0FBS3lCLFdBQWEsS0FDbEJ6QixLQUFLMEIsV0FBYSxHQUNsQjFCLEtBQUsyQixZQUFjLEtBQ2pCZCxTQUFTZSxpQkFBaUIsVUFBVUMsU0FBU0MsSUFDM0NqQixTQUFTa0IsS0FBS0MsWUFBWUYsT0FLaEMsZ0JBQWdCRyxFQUFLQyxHQUNuQmxDLEtBQUttQyxRQUFVN0IsS0FBS0MsTUFBTUQsS0FBSzhCLFVBQVlILEVBQU1DLEdBQU9BLEdBRzFELE9BQ0VHLFlBQVcsS0FDVCxHQUFJckMsS0FBS29CLFFBQVFrQixPQUFRLENBQ3ZCLE1BQVFDLEVBQUdDLEdBQU14QyxLQUFLb0IsUUFBUXFCLE1BQzlCekMsS0FBSzBDLEVBQUk3QixTQUFTQyxjQUFjLFNBQVNkLEtBQUsyQyxJQUFJSixHQUFHQyxJQUVqRHhDLEtBQUtzQixPQUFTaUIsR0FDaEJ2QyxLQUFLNEMsVUFBWSxLQUNqQjVDLEtBQUs2QyxjQUFjLE1BQ1Y3QyxLQUFLc0IsT0FBU2lCLEdBQ3ZCdkMsS0FBSzRDLFVBQVksT0FDakI1QyxLQUFLNkMsY0FBYyxNQUNWN0MsS0FBS3VCLE9BQVNpQixHQUN2QnhDLEtBQUs0QyxVQUFZLE9BQ2pCNUMsS0FBSzZDLGNBQWMsTUFDVjdDLEtBQUt1QixPQUFTaUIsSUFDdkJ4QyxLQUFLNEMsVUFBWSxRQUNqQjVDLEtBQUs2QyxjQUFjLE1BR3JCUixZQUFXLEtBQ1QsTUFBTVMsRUFBTzlDLEtBQUsyQyxJQUFJM0MsS0FBS3NCLFFBQVF0QixLQUFLdUIsUUFDeEN2QixLQUFLMkMsSUFBSTNDLEtBQUtzQixRQUFRdEIsS0FBS3VCLFFBQVV2QixLQUFLMkMsSUFBSUosR0FBR0MsR0FDakR4QyxLQUFLMkMsSUFBSUosR0FBR0MsR0FBS00sRUFDakI5QyxLQUFLc0IsT0FBU2lCLEVBQ2R2QyxLQUFLdUIsT0FBU2lCLEVBQ2R4QyxLQUFLMkIsY0FDTDNCLEtBQUsrQyxjQUNML0MsS0FBS2dELFNBQ0poRCxLQUFLd0IsY0FBZ0IsVUFDZnhCLEtBQUtpRCxZQUNkakQsS0FBS2tELGVBQWMsS0FFcEJsRCxLQUFLd0IsY0FBZ0IsS0FHMUIsS0FBS29CLEdBQ0gsT0FBUUEsR0FDTixJQUFLLEtBRWUsSUFBaEI1QyxLQUFLc0IsU0FDSnRCLEtBQUtvQixRQUFRa0IsUUFBVSxHQUFLdEMsS0FBS3NCLE9BQVMsSUFBTXRCLEtBQUtvQixRQUFRcEIsS0FBS29CLFFBQVFrQixPQUFTLEdBQUcsS0FFdkZ0QyxLQUFLMkMsSUFBSTNDLEtBQUtzQixRQUFRdEIsS0FBS3VCLFFBQVV2QixLQUFLMkMsSUFBSTNDLEtBQUtzQixPQUFTLEdBQUd0QixLQUFLdUIsUUFDcEV2QixLQUFLMkMsSUFBSTNDLEtBQUtzQixPQUFTLEdBQUd0QixLQUFLdUIsUUFBVSxFQUN6Q3ZCLEtBQUtzQixRQUFVLEVBQ2Z0QixLQUFLb0IsUUFBUStCLEtBQUssQ0FBRW5ELEtBQUtzQixPQUFRdEIsS0FBS3VCLFVBRXRDdkIsS0FBS29ELFNBQVcsRUFHbEIsTUFDRixJQUFLLE9BRURwRCxLQUFLc0IsU0FBV3RCLEtBQUtxQixLQUFPLElBQzNCckIsS0FBS29CLFFBQVFrQixRQUFVLEdBQUt0QyxLQUFLc0IsT0FBUyxJQUFNdEIsS0FBS29CLFFBQVFwQixLQUFLb0IsUUFBUWtCLE9BQVMsR0FBRyxLQUV2RnRDLEtBQUsyQyxJQUFJM0MsS0FBS3NCLFFBQVF0QixLQUFLdUIsUUFBVXZCLEtBQUsyQyxJQUFJM0MsS0FBS3NCLE9BQVMsR0FBR3RCLEtBQUt1QixRQUNwRXZCLEtBQUsyQyxJQUFJM0MsS0FBS3NCLE9BQVMsR0FBR3RCLEtBQUt1QixRQUFVLEVBQ3pDdkIsS0FBS3NCLFFBQVUsRUFDZnRCLEtBQUtvQixRQUFRK0IsS0FBSyxDQUFFbkQsS0FBS3NCLE9BQVF0QixLQUFLdUIsVUFFdEN2QixLQUFLb0QsU0FBVyxFQUVsQixNQUNGLElBQUssUUFFRHBELEtBQUt1QixTQUFXdkIsS0FBS3FCLEtBQU8sSUFDM0JyQixLQUFLb0IsUUFBUWtCLFFBQVUsR0FBS3RDLEtBQUt1QixPQUFTLElBQU12QixLQUFLb0IsUUFBUXBCLEtBQUtvQixRQUFRa0IsT0FBUyxHQUFHLEtBRXZGdEMsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixRQUFVdkIsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixPQUFTLEdBQ3pFdkIsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixPQUFTLEdBQUssRUFDekN2QixLQUFLdUIsUUFBVSxFQUNmdkIsS0FBS29CLFFBQVErQixLQUFLLENBQUVuRCxLQUFLc0IsT0FBUXRCLEtBQUt1QixVQUV0Q3ZCLEtBQUtvRCxTQUFXLEVBRWxCLE1BQ0YsSUFBSyxPQUVlLElBQWhCcEQsS0FBS3VCLFNBQ0p2QixLQUFLb0IsUUFBUWtCLFFBQVUsR0FBS3RDLEtBQUt1QixPQUFTLElBQU12QixLQUFLb0IsUUFBUXBCLEtBQUtvQixRQUFRa0IsT0FBUyxHQUFHLEtBRXZGdEMsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixRQUFVdkIsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixPQUFTLEdBQ3pFdkIsS0FBSzJDLElBQUkzQyxLQUFLc0IsUUFBUXRCLEtBQUt1QixPQUFTLEdBQUssRUFDekN2QixLQUFLdUIsUUFBVSxFQUNmdkIsS0FBS29CLFFBQVErQixLQUFLLENBQUVuRCxLQUFLc0IsT0FBUXRCLEtBQUt1QixVQUV0Q3ZCLEtBQUtvRCxTQUFXLEVBRWxCLE1BQ0YsUUFDRSxNQUFNLElBQUlDLE1BQU0sUUFJdEIsY0FDRSxNQUFNVixFQUFNLEdBRVozQyxLQUFLc0QsU0FBVyxHQUNoQixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSXZELEtBQUtxQixLQUFNa0MsR0FBSyxFQUFHLENBQ3JDWixFQUFJWSxHQUFLLEdBQ1QsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUl4RCxLQUFLcUIsS0FBTW1DLEdBQUssRUFDOUJELEVBQUlDLElBQXdCLEdBQWpCeEQsS0FBS3FCLEtBQU8sSUFDekJzQixFQUFJWSxHQUFHQyxHQUFLRCxFQUFJdkQsS0FBS3FCLEtBQU9tQyxFQUFJLEVBQ2hDeEQsS0FBS3NELFNBQVNILEtBQ1osR0FBRzdDLEtBQUttRCxNQUFNLEtBQU96RCxLQUFLcUIsS0FBTyxHQUFLbUMsT0FBT2xELEtBQUttRCxNQUFNLEtBQU96RCxLQUFLcUIsS0FBTyxHQUFLa0MsUUFHbEZaLEVBQUlZLEdBQUdDLEdBQUssRUFJbEIsT0FBT2IsRUFHVCxVQUVFLElBREEzQyxLQUFLb0IsUUFBUStCLEtBQUssQ0FBRW5ELEtBQUtzQixPQUFRdEIsS0FBS3VCLFNBQ2pDdkIsS0FBS29ELFFBQVUsRUFBR3BELEtBQUtvRCxRQUFVcEQsS0FBS3FCLE1BQVEsRUFBR3JCLEtBQUtvRCxTQUFXLEVBQ3BFLE9BQVE5QyxLQUFLQyxNQUFNLEVBQUlELEtBQUs4QixXQUMxQixLQUFLLEVBR0hwQyxLQUFLMEQsS0FBSyxNQUVWLE1BQ0YsS0FBSyxFQUVIMUQsS0FBSzBELEtBQUssU0FFVixNQUNGLEtBQUssRUFFSDFELEtBQUswRCxLQUFLLFFBRVYsTUFDRixLQUFLLEVBRUgxRCxLQUFLMEQsS0FBSyxRQUVWLE1BQ0YsUUFDRSxNQUFNLElBQUlMLE1BQU0sUUFLeEIsY0FDRSxJQUFJbkMsRUFBUSxHQUNaLE1BQU1PLEVBQWdCekIsS0FBS3lCLFdBQVIsTUFDbkIsSUFBSWtDLEVBRUosSUFBSyxJQUFJSixFQUFJLEVBQUdLLEVBQVEsRUFBR0wsRUFBSXZELEtBQUtxQixLQUFNa0MsR0FBSyxFQUM3QyxJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSXhELEtBQUtxQixLQUFNbUMsR0FBSyxFQUFHLENBQ3JDRyxFQUFhM0QsS0FBSzJDLElBQUlZLEdBQUdDLEdBRXpCLE1BQU1LLEVBQVk3RCxLQUFLMkMsSUFBSVksR0FBR0MsR0FBSyxPQUFTLGFBQ3RDTSxFQUFZOUQsS0FBSzJDLElBQUlZLEdBQUdDLEdBQUssNkJBQTZCeEQsS0FBS21DLGdCQUFrQixHQUVqRjRCLElBQWMvRCxLQUFLMkMsSUFBSVksR0FBR0MsR0FDMUJRLEVBQVFoRSxLQUFLc0QsU0FBU0ssRUFBYSxHQUN6Q0MsR0FBUyxFQUVUMUMsR0FBUyxpQ0FDUWxCLEtBQUtpRSxrQ0FDWGpFLEtBQUtpRSxpQ0FDTkwsaUJBQ05FLHFDQUNxQkUsa0NBQ0p2QywyQkFDUmtDLHdCQUNGRSw0QkFDSUUsTUFBY0osVUFJakMsTUFBTU8sRUFBVXJELFNBQVNzRCxjQUFjLE9BQ3ZDRCxFQUFRRSxVQUFVQyxJQUFJLFNBQ3RCSCxFQUFRSSxNQUFNQyxNQUFROUMsRUFDdEJ5QyxFQUFRbkQsVUFBWUcsRUFFcEJMLFNBQVNrQixLQUFLeUMsWUFBWU4sR0FHNUIsS0FBS08sR0FDSCxNQUFNQyxFQUFhMUUsS0FBS2lFLFVBQVlqRSxLQUFLd0IsY0FBZ0JpRCxHQUFPekUsS0FBSzJFLFdBQ3JFLE9BQVEzRSxLQUFLNEMsV0FDWCxJQUFLLEtBQ0g1QyxLQUFLMEMsRUFBRTRCLE1BQU1NLFVBQVksa0JBQWtCRixRQUMzQyxNQUNGLElBQUssT0FDSDFFLEtBQUswQyxFQUFFNEIsTUFBTU0sVUFBWSxpQkFBaUJGLFFBQzFDLE1BQ0YsSUFBSyxPQUNIMUUsS0FBSzBDLEVBQUU0QixNQUFNTSxVQUFZLGVBQWVGLFdBQ3hDLE1BQ0YsSUFBSyxRQUNIMUUsS0FBSzBDLEVBQUU0QixNQUFNTSxVQUFZLGNBQWNGLFdBQ3ZDLE1BQ0YsUUFDRSxNQUFNLElBQUlyQixNQUFNLFFBSXRCLGNBQWNvQixHQUNaekUsS0FBSzZFLGFBQWMsRUFDbkI3RSxLQUFLOEUsTUFBUUMsS0FBS0MsTUFFbEJoRixLQUFLVSxNQUFRUCxhQUFZLEtBR3ZCLEdBRkFILEtBQUsyRSxXQUFhSSxLQUFLQyxNQUFRaEYsS0FBSzhFLE1BRWhDOUUsS0FBSzJFLFlBQWMzRSxLQUFLd0IsY0FHMUIsT0FGQVosY0FBY1osS0FBS1UsWUFDbkJWLEtBQUs2RSxhQUFjLEdBSXJCN0UsS0FBS2lGLEtBQUtSLEtBQ1QsSUFHTCxLQUFLUyxHQUNILElBQUlsRixLQUFLNkUsWUFFVCxJQUFLLElBQUl0QixFQUFJLEVBQUdBLEVBQUl2RCxLQUFLMkMsSUFBSUwsT0FBUWlCLEdBQUssRUFDeEMsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUl4RCxLQUFLMkMsSUFBSVksR0FBR2pCLE9BQVFrQixHQUFLLEVBQzNDLEdBQUl4RCxLQUFLMkMsSUFBSVksR0FBR0MsS0FBTzBCLElBRWxCNUUsS0FBSzZFLElBQUluRixLQUFLc0IsT0FBU2lDLElBQU0sR0FBS3ZELEtBQUt1QixPQUFTaUMsR0FBTSxHQUN0RGxELEtBQUs2RSxJQUFJbkYsS0FBS3VCLE9BQVNpQyxJQUFNLEdBQUt4RCxLQUFLc0IsT0FBU2lDLEdBQU0sR0FDdkQsQ0FFQXZELEtBQUtvRixjQUFnQixFQUNyQnZFLFNBQVNDLGNBQWMsU0FBU0MsVUFBWWYsS0FBS29GLGFBRWpELE1BQU1DLEVBQU94RSxTQUFTQyxjQUFjLFNBQVNkLEtBQUsyQyxJQUFJM0MsS0FBS3NCLFFBQVF0QixLQUFLdUIsU0F5Q3hFLE9BeENBdkIsS0FBSzBDLEVBQUk3QixTQUFTQyxjQUFjLFNBQVNkLEtBQUsyQyxJQUFJWSxHQUFHQyxJQUdqRHhELEtBQUtzQixPQUFTaUMsRUFBSSxHQUNwQnZELEtBQUs0QyxVQUFZLEtBQ2pCNUMsS0FBSzZDLGNBQWMsSUFDVjdDLEtBQUtzQixPQUFTaUMsRUFBSSxHQUMzQnZELEtBQUs0QyxVQUFZLE9BQ2pCNUMsS0FBSzZDLGNBQWMsSUFDVjdDLEtBQUt1QixPQUFTaUMsRUFBSSxHQUMzQnhELEtBQUs0QyxVQUFZLE9BQ2pCNUMsS0FBSzZDLGNBQWMsSUFDVjdDLEtBQUt1QixPQUFTaUMsRUFBSSxJQUMzQnhELEtBQUs0QyxVQUFZLFFBQ2pCNUMsS0FBSzZDLGNBQWMsSUFHckJSLFlBQVcsS0FDVCxNQUFNUyxFQUFPdUMsRUFBS2YsTUFBTVYsTUFDeEJ5QixFQUFLZixNQUFNVixNQUFRNUQsS0FBSzBDLEVBQUU0QixNQUFNVixNQUNoQzVELEtBQUswQyxFQUFFNEIsTUFBTVYsTUFBUWQsRUFFckI5QyxLQUFLMEMsRUFBRTRCLE1BQU1NLFVBQVksR0FFckI1RSxLQUFLc0IsU0FBV3RCLEtBQUt1QixRQUFVdkIsS0FBS3VCLFNBQVd2QixLQUFLcUIsS0FBTyxHQUN6RHJCLEtBQUtpRCxhQUNQakQsS0FBS21CLE9BQU9tRSxhQUNadEYsS0FBS2tELG1CQUdSbEQsS0FBS3dCLGdCQUNOeEIsS0FBSzJDLElBQUlZLEdBQUdDLEdBQUl4RCxLQUFLMkMsSUFBSTNDLEtBQUtzQixRQUFRdEIsS0FBS3VCLFNBQVksQ0FDdkR2QixLQUFLMkMsSUFBSTNDLEtBQUtzQixRQUFRdEIsS0FBS3VCLFFBQzNCdkIsS0FBSzJDLElBQUlZLEdBQUdDLElBRWR4RCxLQUFLc0IsT0FBU2lDLEVBQ2R2RCxLQUFLdUIsT0FBU2lDLE9BRWR4RCxLQUFLb0IsUUFBUStCLEtBQUssQ0FBRW5ELEtBQUtzQixPQUFRdEIsS0FBS3VCLFVBU2hELFdBQ0UsSUFBSyxJQUFJZ0MsRUFBSSxFQUFHQSxFQUFJdkQsS0FBS3FCLEtBQU1rQyxHQUFLLEVBQ2xDLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJeEQsS0FBS3FCLEtBQU1tQyxHQUFLLEVBQ2xDLEdBQUlELEVBQUlDLElBQXdCLEdBQWpCeEQsS0FBS3FCLEtBQU8sSUFDckJyQixLQUFLdUYsSUFBSWhDLEdBQUdDLEtBQU94RCxLQUFLMkMsSUFBSVksR0FBR0MsR0FBSSxPQUFPLEVBS3BELE9BQU8sRUFHVCxjQUFjZ0MsR0FDWixNQUFNQyxFQUFXNUUsU0FBU0MsY0FBYyxVQUN4QzJFLEVBQVNyQixVQUFVQyxJQUFJLE9BR3JCb0IsRUFBUzFFLFVBRFB5RSxFQUNtQix1Q0FFQSx3REFBd0QzRSxTQUFTQyxjQUNwRixTQUNBQyxlQUFlRixTQUFTQyxjQUFjLFNBQVNDLHlCQUVuRDBFLEVBQVNuQixNQUFNb0IsZ0JBQWtCLGlCQUFpQjFGLEtBQUttQyxlQUd6RCxPQUNFbkMsS0FBSzJGLGdCQUFnQixJQUFLLEdBQzFCM0YsS0FBS29CLFFBQVUsR0FDZnBCLEtBQUtvRixhQUFlLEVBQ3BCdkUsU0FBU0MsY0FBYyxTQUFTQyxVQUFZZixLQUFLb0YsYUFDakRwRixLQUFLcUIsS0FBT1IsU0FBUytFLGVBQWUsYUFBYUMsTUFFakQ3RixLQUFLaUUsU0FBVzZCLFdBQVc5RixLQUFLeUIsV0FBYXpCLEtBQUtxQixLQUFPLEVBQUlyQixLQUFLMEIsWUFBWWpCLFFBQVEsR0FFdEZULEtBQUsyQixjQUVMM0IsS0FBS3NCLE9BQVN0QixLQUFLcUIsS0FBTyxFQUMxQnJCLEtBQUt1QixPQUFTdkIsS0FBS3FCLEtBQU8sRUFFMUJyQixLQUFLMkMsSUFBTTNDLEtBQUsrRixjQUNoQi9GLEtBQUt1RixJQUFNdkYsS0FBSytGLGNBRWhCL0YsS0FBS2dHLFVBRUxoRyxLQUFLK0MsY0FDTC9DLEtBQUttQixPQUFPOEUsT0FFWnBGLFNBQVNlLGlCQUFpQixTQUFTQyxTQUFTcUUsSUFDMUNBLEVBQUtDLGlCQUFpQixXQUFZQyxJQUNoQyxNQUFNdEUsRUFBT3NFLEVBQUlDLE9BQ2pCckcsS0FBS3NHLEtBQUtDLFNBQVN6RSxFQUFLZixVQUFXLFFBR3JDbUYsRUFBS0MsaUJBQWlCLFlBQWFuRyxLQUFLd0csV0FFeENOLEVBQUtDLGlCQUFpQixXQUFZbkcsS0FBS3lHLFVBRXZDUCxFQUFLQyxpQkFBaUIsT0FBUW5HLEtBQUswRyxVQUVuQ1IsRUFBS0MsaUJBQWlCLFVBQVduRyxLQUFLMkcsWUFJMUMsT0FDRTNHLEtBQUtpRSxTQUFXNkIsV0FBVzlGLEtBQUt5QixXQUFhekIsS0FBS3FCLEtBQU8sRUFBSXJCLEtBQUswQixZQUFZakIsUUFBUSxHQUN0RkksU0FBU0MsY0FBYyxTQUFTQyxVQUFZZixLQUFLb0YsYUFDakRwRixLQUFLMkIsY0FDTDNCLEtBQUsrQyxjQUNML0MsS0FBS3VGLElBQU12RixLQUFLK0YsY0FDaEIvRixLQUFLbUIsT0FBTzhFLE9BRVpwRixTQUFTZSxpQkFBaUIsU0FBU0MsU0FBU3FFLElBQzFDQSxFQUFLQyxpQkFBaUIsV0FBWUMsSUFDaEMsTUFBTXRFLEVBQU9zRSxFQUFJQyxPQUNqQnJHLEtBQUtzRyxLQUFLQyxTQUFTekUsRUFBS2YsVUFBVyxRQUdyQ21GLEVBQUtDLGlCQUFpQixZQUFhbkcsS0FBS3dHLFdBRXhDTixFQUFLQyxpQkFBaUIsV0FBWW5HLEtBQUt5RyxVQUV2Q1AsRUFBS0MsaUJBQWlCLE9BQVFuRyxLQUFLMEcsVUFFbkNSLEVBQUtDLGlCQUFpQixVQUFXbkcsS0FBSzJHLGNEbFl0Q0MsRUFBUy9GLFNBQVNzRCxjQUFjLFVBQ3RDeUMsRUFBT3hDLFVBQVVDLElBQUksVUFDckJ1QyxFQUFPN0YsVUFBWSxzQ0FDbkJGLFNBQVNrQixLQUFLeUMsWUFBWW9DLEdBRTFCLE1BQU1DLEVBQU9oRyxTQUFTc0QsY0FBYyxPQUNwQzBDLEVBQUt6QyxVQUFVQyxJQUFJLFFBRW5Cd0MsRUFBSzlGLFVBQVksbTBCQXVCakJGLFNBQVNrQixLQUFLeUMsWUFBWXFDLEdBRTFCM0YsRUFBTStFLE9BRU5wRixTQUFTQyxjQUFjLGFBQWFxRixpQkFBaUIsU0FBUyxLQUM1RGpGLEVBQU0rRSxVQUdScEYsU0FBU0MsY0FBYyxTQUFTcUYsaUJBQWlCLFNBQVMsS0FDeERXLGFBQWFDLFFBQ1gsV0FDQUMsS0FBS0MsVUFBVSxDQUNiQyxXQUFZaEcsRUFBTW9DLFNBQ2xCbEMsUUFBU0YsRUFBTUUsUUFDZkMsS0FBTUgsRUFBTUcsS0FDWjhGLFdBQVlqRyxFQUFNeUIsSUFDbEJ6QyxLQUFNZ0IsRUFBTUMsT0FBT2xCLFlBQ25CbUgsTUFBT2xHLEVBQU1rRSxhQUNiQyxLQUFNLENBQUVuRSxFQUFNSSxPQUFRSixFQUFNSyxRQUM1QlksUUFBU2pCLEVBQU1pQixjQUtyQnRCLFNBQVNDLGNBQWMsU0FBU3FGLGlCQUFpQixTQUFTLEtBQ3hELE1BQU0sV0FBRWUsRUFBVSxRQUFFOUYsRUFBTyxLQUFFQyxFQUFJLFdBQUU4RixFQUFVLEtBQUVqSCxFQUFJLE1BQUVrSCxFQUFLLEtBQUUvQixFQUFJLFFBQUVsRCxHQUFZNkUsS0FBS0ssTUFDakZQLGFBQWFRLFFBQVEsYUFFdkJwRyxFQUFNb0MsU0FBVzRELEVBQ2pCaEcsRUFBTUUsUUFBVUEsRUFDaEJGLEVBQU1HLEtBQU9BLEVBQ2JILEVBQU1DLE9BQU9sQixZQUFjQyxFQUMzQmdCLEVBQU1rRSxhQUFlZ0MsRUFDckJsRyxFQUFNeUIsSUFBTXdFLEdBQ1ZqRyxFQUFNSSxPQUFRSixFQUFNSyxRQUFXOEQsRUFDakNuRSxFQUFNaUIsUUFBVUEsRUFDaEJqQixFQUFNcUcsT0FDTnJHLEVBQU1DLE9BQU9vRyxVQUdmMUcsU0FBUytFLGVBQWUsYUFBYU8saUJBQWlCLFVBQVUsS0FDOURqRixFQUFNK0UsT0FDTi9FLEVBQU1DLE9BQU84RSxVQUdmcEYsU0FBU0MsY0FBYyxVQUFVcUYsaUJBQWlCLFNBQVMsS0FDekRqRixFQUFNQyxPQUFPbUUsYUFDYnBFLEVBQU04QixXIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIC8vIHRoaXMudGltZXIgPSAnMDowMCc7XHJcbiAgfVxyXG5cclxuICBjYWxjQ3VycmVudFRpbWUoKSB7XHJcbiAgICB0aGlzLnRpbWUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY3VycmVudFRpbWUgKz0gMTtcclxuICAgICAgdGhpcy5zZWNUb01pbkFuZFNlYygpO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG5cclxuICBzZWNUb01pbkFuZFNlYygpIHtcclxuICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IodGhpcy5jdXJyZW50VGltZSAvIDYwKTtcclxuXHJcbiAgICB0aGlzLnNlYyA9ICh0aGlzLmN1cnJlbnRUaW1lICUgNjApLnRvRml4ZWQoMCk7XHJcbiAgICB0aGlzLnRpbWVyID0gYCR7dGhpcy5taW51dGVzfToke3RoaXMuc2VjIDwgMTAgPyAnMCcgOiAnJ30ke3RoaXMuc2VjfWA7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcbiAgfVxyXG5cclxuICB0aW1lclN0b3AoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgICB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJQYXVzZSgpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclRpbWVyKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKS5pbm5lckhUTUwgPSB0aGlzLnRpbWVyO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbnVsbDtcclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuXHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgQm9hcmQgZnJvbSAnLi9Cb2FyZC5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcbmhlYWRlci5jbGFzc0xpc3QuYWRkKCdoZWFkZXInKTtcclxuaGVhZGVyLmlubmVySFRNTCA9ICc8aDEgY2xhc3M9XCJoZWFkaW5nXCI+Z2VtIHB1enpsZTwvaDE+JztcclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG5cclxuY29uc3QgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5tZW51LmNsYXNzTGlzdC5hZGQoJ21lbnUnKTtcclxuXHJcbm1lbnUuaW5uZXJIVE1MID0gYCAgXHJcbiAgPGRpdiBjbGFzcz1cInNldHRpbmdzXCI+XHJcbiAgICA8YnV0dG9uIHN0eWxlPVwicG9zaXRpb246IGFic29sdXRlOyB0b3A6IDA7XCIgY2xhc3M9J2NoZWF0Jz5DSEVBVDwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cIm5ldy1nYW1lIGJ0blwiPk5ldzwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cInNhdmUgYnRuXCI+U2F2ZTwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cImxvYWQgYnRuXCI+TG9hZDwvYnV0dG9uPlxyXG4gICAgPGRpdiBjbGFzcz1cInNpemVcIj5cclxuICAgICAgPHNlbGVjdCBpZD1cImZpZWxkU2l6ZVwiPlxyXG4gICAgICA8b3B0aW9uIHNlbGVjdGVkPVwic2VsZWN0ZWRcIiB2YWx1ZT1cIjRcIiBkaXNhYmxlZD5GaWVsZCBzaXplPC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjNcIj4zPC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjRcIj40PC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjVcIj41PC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjZcIj42PC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjdcIj43PC9vcHRpb24+XHJcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjhcIj44PC9vcHRpb24+XHJcbiAgICAgIDwvc2VsZWN0PlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cImNvdW50ZXJzXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwidGltZXJcIj48c3Bhbj5UaW1lcjo8L3NwYW4+PHNwYW4gY2xhc3M9XCJ0aW1lXCI+MDowMDwvc3Bhbj48L2Rpdj5cclxuICAgIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDwvZGl2PmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lbnUpO1xyXG5cclxuYm9hcmQuaW5pdCgpO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy1nYW1lJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgYm9hcmQuaW5pdCgpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYXZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXHJcbiAgICAnZ2FtZVNhdmUnLFxyXG4gICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBiZ1Bvc2l0aW9uOiBib2FyZC5iZ1Bvc0FycixcclxuICAgICAgaGlzdG9yeTogYm9hcmQuaGlzdG9yeSxcclxuICAgICAgc2l6ZTogYm9hcmQuc2l6ZSxcclxuICAgICAgYm9hcmRUYWJsZTogYm9hcmQuYXJyLFxyXG4gICAgICB0aW1lOiBib2FyZC50aW1lckMuY3VycmVudFRpbWUsXHJcbiAgICAgIG1vdmVzOiBib2FyZC5tb3Zlc0NvdW50ZXIsXHJcbiAgICAgIHplcm86IFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSxcclxuICAgICAgaW1nTnVtYjogYm9hcmQuaW1nTnVtYlxyXG4gICAgfSlcclxuICApO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY29uc3QgeyBiZ1Bvc2l0aW9uLCBoaXN0b3J5LCBzaXplLCBib2FyZFRhYmxlLCB0aW1lLCBtb3ZlcywgemVybywgaW1nTnVtYiB9ID0gSlNPTi5wYXJzZShcclxuICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYW1lU2F2ZScpXHJcbiAgKTtcclxuICBib2FyZC5iZ1Bvc0FyciA9IGJnUG9zaXRpb247XHJcbiAgYm9hcmQuaGlzdG9yeSA9IGhpc3Rvcnk7XHJcbiAgYm9hcmQuc2l6ZSA9IHNpemU7XHJcbiAgYm9hcmQudGltZXJDLmN1cnJlbnRUaW1lID0gdGltZTtcclxuICBib2FyZC5tb3Zlc0NvdW50ZXIgPSBtb3ZlcztcclxuICBib2FyZC5hcnIgPSBib2FyZFRhYmxlO1xyXG4gIFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSA9IHplcm87XHJcbiAgYm9hcmQuaW1nTnVtYiA9IGltZ051bWI7XHJcbiAgYm9hcmQubG9hZCgpO1xyXG4gIGJvYXJkLnRpbWVyQy5sb2FkKCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpZWxkU2l6ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcbiAgYm9hcmQudGltZXJDLmluaXQoKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hlYXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC50aW1lckMudGltZXJQYXVzZSgpO1xyXG4gIGJvYXJkLmJhY2soKTtcclxufSk7XHJcbiIsImltcG9ydCBUaW1lciBmcm9tICcuL1RpbWVyLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudGltZXJDID0gbmV3IFRpbWVyKCk7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMuc2l6ZSA9IDQ7XHJcbiAgICB0aGlzLmVtcHR5WCA9IDA7XHJcbiAgICB0aGlzLmVtcHR5WSA9IDA7XHJcbiAgICB0aGlzLmFuaW1hdGlvblRpbWUgPSA0MDA7XHJcbiAgICB0aGlzLmJvYXJkV2lkdGggPSA0MC44O1xyXG4gICAgdGhpcy5tYXJnaW5TaXplID0gMC4xO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCA9ICgpID0+IHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkJykuZm9yRWFjaCgoZWxlbSkgPT4ge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHJhbmRvbUltZ051bWJlcihtYXgsIG1pbikge1xyXG4gICAgdGhpcy5pbWdOdW1iID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pO1xyXG4gIH1cclxuXHJcbiAgYmFjaygpIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5oaXN0b3J5Lmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IFsgeCwgeSBdID0gdGhpcy5oaXN0b3J5LnBvcCgpO1xyXG4gICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbeF1beV19YCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmVtcHR5WCA8IHgpIHtcclxuICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3VwJztcclxuICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigzMDApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVggPiB4KSB7XHJcbiAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigzMDApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgPCB5KSB7XHJcbiAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigzMDApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgPiB5KSB7XHJcbiAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdyaWdodCc7XHJcbiAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oMzAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbeF1beV07XHJcbiAgICAgICAgICB0aGlzLmFyclt4XVt5XSA9IHRlbXA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCA9IHg7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WSA9IHk7XHJcbiAgICAgICAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICAgICAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcbiAgICAgICAgICB0aGlzLmJhY2soKTtcclxuICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUgLSAzMDApO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgIHRoaXMuc2V0V2luTWVzc2FnZSh0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfSwgdGhpcy5hbmltYXRpb25UaW1lIC0gMzAwKTtcclxuICB9XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVggIT09IDAgJiZcclxuICAgICAgICAgICh0aGlzLmhpc3RvcnkubGVuZ3RoIDw9IDIgfHwgdGhpcy5lbXB0eVggLSAxICE9PSB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDJdWzBdKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVggLSAxXVt0aGlzLmVtcHR5WV0gPSAwO1xyXG4gICAgICAgICAgdGhpcy5lbXB0eVggLT0gMTtcclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNvdW50ZXIgLT0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCAhPT0gdGhpcy5zaXplIC0gMSAmJlxyXG4gICAgICAgICAgKHRoaXMuaGlzdG9yeS5sZW5ndGggPD0gMiB8fCB0aGlzLmVtcHR5WCArIDEgIT09IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMl1bMF0pXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCArPSAxO1xyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY291bnRlciAtPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlZICE9PSB0aGlzLnNpemUgLSAxICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlZICsgMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVsxXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgKyAxXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb3VudGVyIC09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLmVtcHR5WSAhPT0gMCAmJlxyXG4gICAgICAgICAgKHRoaXMuaGlzdG9yeS5sZW5ndGggPD0gMiB8fCB0aGlzLmVtcHR5WSAtIDEgIT09IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMl1bMV0pXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXSA9IDA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WSAtPSAxO1xyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY291bnRlciAtPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3JlYXRlQm9hcmQoKSB7XHJcbiAgICBjb25zdCBhcnIgPSBbXTtcclxuXHJcbiAgICB0aGlzLmJnUG9zQXJyID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGFycltpXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBhcnJbaV1bal0gPSBpICogdGhpcy5zaXplICsgaiArIDE7XHJcbiAgICAgICAgICB0aGlzLmJnUG9zQXJyLnB1c2goXHJcbiAgICAgICAgICAgIGAke01hdGgucm91bmQoMTAwIC8gKHRoaXMuc2l6ZSAtIDEpICogail9JSAke01hdGgucm91bmQoMTAwIC8gKHRoaXMuc2l6ZSAtIDEpICogaSl9JWBcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXJyO1xyXG4gIH1cclxuXHJcbiAgc2h1ZmZsZSgpIHtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgZm9yICh0aGlzLmNvdW50ZXIgPSAwOyB0aGlzLmNvdW50ZXIgPCB0aGlzLnNpemUgKiogMzsgdGhpcy5jb3VudGVyICs9IDEpIHtcclxuICAgICAgc3dpdGNoIChNYXRoLmZsb29yKDQgKiBNYXRoLnJhbmRvbSgpKSkge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgdGhpcy5tb3ZlKCd1cCcpO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgIC8vICBNT1ZFIFJJR0hUXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ3JpZ2h0Jyk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgLy8gIE1PVkUgRE9XTlxyXG4gICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgdGhpcy5tb3ZlKCdsZWZ0Jyk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckJvYXJkKCkge1xyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBjb25zdCBib2FyZFdpZHRoID0gYCR7dGhpcy5ib2FyZFdpZHRofXJlbWA7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuXHJcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5hcnJbaV1bal0gPyAnY2VsbCcgOiAnY2VsbCBlbXB0eSc7XHJcbiAgICAgICAgY29uc3QgYmdGb3JDZWxsID0gdGhpcy5hcnJbaV1bal0gPyBgYmFja2dyb3VuZDogdXJsKC4uL2Fzc2V0cy8ke3RoaXMuaW1nTnVtYn0uanBnKTtgIDogJyc7XHJcblxyXG4gICAgICAgIGNvbnN0IGRyYWdnYWJsZSA9ICEhdGhpcy5hcnJbaV1bal07XHJcbiAgICAgICAgY29uc3QgYkdwb3MgPSB0aGlzLmJnUG9zQXJyW2NlbGxOdW1iZXIgLSAxXTtcclxuICAgICAgICBvcmRlciArPSAxO1xyXG5cclxuICAgICAgICBib2FyZCArPSBgPGRpdiBcclxuICAgICAgICAgIHN0eWxlPSd3aWR0aDoke3RoaXMuY2VsbFNpemV9cmVtO1xyXG4gICAgICAgICAgaGVpZ2h0OiR7dGhpcy5jZWxsU2l6ZX1yZW07XHJcbiAgICAgICAgICBvcmRlcjoke29yZGVyfTtcclxuICAgICAgICAgICR7YmdGb3JDZWxsfVxyXG4gICAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogJHtiR3Bvc307XHJcbiAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6ICR7Ym9hcmRXaWR0aH07J1xyXG4gICAgICAgICAgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfSdcclxuICAgICAgICAgIGNsYXNzPScke2NsYXNzTmFtZX0nXHJcbiAgICAgICAgICBkcmFnZ2FibGU9XCIke2RyYWdnYWJsZX1cIj4ke2NlbGxOdW1iZXJ9PC9kaXY+YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcclxuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBib2FyZFdpZHRoO1xyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgZHJhdyhtb2QpIHtcclxuICAgIGNvbnN0IHJlbVBlclRpY2sgPSB0aGlzLmNlbGxTaXplIC8gKHRoaXMuYW5pbWF0aW9uVGltZSAtIG1vZCkgKiB0aGlzLnRpbWVQYXNzZWQ7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHstcmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cmVtUGVyVGlja31yZW0pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7LXJlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHtyZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKG1vZCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcobW9kKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigwKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKDApO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlZIC0gaiA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHRlbXAgPSB6ZXJvLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHplcm8uc3R5bGUub3JkZXIgPSB0aGlzLmUuc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLm9yZGVyID0gdGVtcDtcclxuXHJcbiAgICAgICAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICBpZiAodGhpcy5lbXB0eVggPT09IHRoaXMuZW1wdHlZICYmIHRoaXMuZW1wdHlZID09PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja1dpbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudGltZXJDLnRpbWVyUGF1c2UoKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5zZXRXaW5NZXNzYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2hlY2tXaW4oKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIGlmICh0aGlzLndpbltpXVtqXSAhPT0gdGhpcy5hcnJbaV1bal0pIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHNldFdpbk1lc3NhZ2UoY2hlYXQpIHtcclxuICAgIGNvbnN0IHdpbkJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvYXJkJyk7XHJcbiAgICB3aW5Cb2FyZC5jbGFzc0xpc3QuYWRkKCd3aW4nKTtcclxuXHJcbiAgICBpZiAoY2hlYXQpIHtcclxuICAgICAgd2luQm9hcmQuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPSd3aW4tdGV4dCc+0KfQmNCi0JXQoCE8L3NwYW4+YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbkJvYXJkLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0nd2luLXRleHQnPtCj0YDQsCEg0JLRiyDRgNC10YjQuNC70Lgg0LPQvtC70L7QstC+0LvQvtC80LrRgyDQt9CwICR7ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAnLnRpbWUnXHJcbiAgICAgICkuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyPC9zcGFuPmA7XHJcbiAgICB9XHJcbiAgICB3aW5Cb2FyZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKC4uL2Fzc2V0cy8ke3RoaXMuaW1nTnVtYn0uanBnKWA7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5yYW5kb21JbWdOdW1iZXIoMTUwLCAxKTtcclxuICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xyXG4gICAgdGhpcy5tb3Zlc0NvdW50ZXIgPSAwO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuICAgIHRoaXMuc2l6ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS52YWx1ZTtcclxuXHJcbiAgICB0aGlzLmNlbGxTaXplID0gcGFyc2VGbG9hdCh0aGlzLmJvYXJkV2lkdGggLyB0aGlzLnNpemUgLSAyICogdGhpcy5tYXJnaW5TaXplKS50b0ZpeGVkKDMpO1xyXG5cclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuXHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcblxyXG4gICAgdGhpcy5hcnIgPSB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICB0aGlzLndpbiA9IHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuXHJcbiAgICB0aGlzLnNodWZmbGUoKTtcclxuXHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcbiAgICB0aGlzLnRpbWVyQy5pbml0KCk7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWQoKSB7XHJcbiAgICB0aGlzLmNlbGxTaXplID0gcGFyc2VGbG9hdCh0aGlzLmJvYXJkV2lkdGggLyB0aGlzLnNpemUgLSAyICogdGhpcy5tYXJnaW5TaXplKS50b0ZpeGVkKDMpO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuICAgIHRoaXMud2luID0gdGhpcy5jcmVhdGVCb2FyZCgpO1xyXG4gICAgdGhpcy50aW1lckMuaW5pdCgpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=