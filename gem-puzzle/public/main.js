(()=>{"use strict";class t{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}timerPause(){clearInterval(this.time)}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}}const e=new class{constructor(){this.timerC=new t,this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=400,this.boardWidth=40.8,this.marginSize=.1,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":0!==this.emptyX?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1):this.move("down");break;case"down":this.emptyX!==this.size-1?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1):this.move("up");break;case"right":this.emptyY!==this.size-1?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1):this.move("left");break;case"left":0!==this.emptyY?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1):this.move("right");break;default:throw new Error(">:(")}}createBoard(){const t=[];this.bgPosArr=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?(t[e][i]=e*this.size+i+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*i)}% ${Math.round(100/(this.size-1)*e)}%`)):t[e][i]=0}return t}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.move("right"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 3:this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;default:throw t-=1,new Error(">:(")}}renderBoard(){let t="";const e=this.boardWidth+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let h=0;h<this.size;h+=1){i=this.arr[s][h];const n=this.arr[s][h]?"cell":"cell empty",o=!!this.arr[s][h],a=this.bgPosArr[i-1];r+=1,t+=`<div style='width:${this.cellSize}rem; height:${this.cellSize}rem; order:${r}; background-position: ${a}; background-size: ${e};' id='cell-${i}' class='${n}' draggable="${o}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s)}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation()):this.emptyY-i>0&&(this.direction="right",this.moveAnimation()),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(this.timerC.timerPause(),document.querySelector(".board").innerHTML+=`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов`)}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void this.history.push([this.emptyX,this.emptyY])}}checkWin(){for(let t=0;t<this.size;t+=1)for(let e=0;e<this.size;e+=1)if(t+e!==2*(this.size-1)&&this.win[t][e]!==this.arr[t][e])return!1;return!0}init(){this.history=[],this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),this.removeBoard(),this.emptyX=this.size-1,this.emptyY=this.size-1,this.arr=this.createBoard(),this.win=this.createBoard(),this.shuffle(),this.renderBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),this.win=this.createBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},i=document.createElement("header");i.classList.add("header"),i.innerHTML='<h1 class="heading">gem puzzle</h1>',document.body.appendChild(i);const s=document.createElement("div");s.classList.add("menu"),s.innerHTML='  \n  <div class="settings">\n    <button class="new-game btn">New</button>\n    <button class="save btn">Save</button>\n    <button class="load btn">Load</button>\n    <div class="size">\n      <select id="fieldSize">\n      <option selected="selected" value="4" disabled>Field size</option>\n        <option value="3">3</option>\n        <option value="4">4</option>\n        <option value="5">5</option>\n        <option value="6">6</option>\n        <option value="7">7</option>\n        <option value="8">8</option>\n      </select>\n    </div>\n  </div>\n  <div class="counters">\n    <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n    <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  </div>',document.body.appendChild(s),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({bgPosition:e.bgPosArr,history:e.history,size:e.size,boardTable:e.arr,time:e.timerC.currentTime,moves:e.movesCounter,zero:[e.emptyX,e.emptyY]}))})),document.querySelector(".load").addEventListener("click",(()=>{const{bgPosition:t,history:i,size:s,boardTable:r,time:h,moves:n,zero:o}=JSON.parse(localStorage.getItem("gameSave"));e.bgPosArr=t,e.history=i,e.size=s,e.timerC.currentTime=h,e.movesCounter=n,e.arr=r,e.load(),e.timerC.load(),[e.emptyX,e.emptyY]=o})),document.getElementById("fieldSize").addEventListener("change",(()=>{e.init(),e.timerC.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL1RpbWVyLmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9Cb2FyZC5qcyJdLCJuYW1lcyI6WyJUaW1lciIsInRoaXMiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZXRJbnRlcnZhbCIsInNlY1RvTWluQW5kU2VjIiwibWludXRlcyIsIk1hdGgiLCJmbG9vciIsInNlYyIsInRvRml4ZWQiLCJ0aW1lciIsInJlbmRlclRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRpbWVyU3RvcCIsImNhbGNDdXJyZW50VGltZSIsImJvYXJkIiwidGltZXJDIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhbmltYXRpb25UaW1lIiwiYm9hcmRXaWR0aCIsIm1hcmdpblNpemUiLCJyZW1vdmVCb2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbSIsImJvZHkiLCJyZW1vdmVDaGlsZCIsImRpcmVjdGlvbiIsImFyciIsIm1vdmUiLCJFcnJvciIsImJnUG9zQXJyIiwiaSIsImoiLCJwdXNoIiwicm91bmQiLCJyYW5kb20iLCJjZWxsTnVtYmVyIiwib3JkZXIiLCJjbGFzc05hbWUiLCJkcmFnZ2FibGUiLCJiR3BvcyIsImNlbGxTaXplIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJyZW1QZXJUaWNrIiwidGltZVBhc3NlZCIsImUiLCJ0cmFuc2Zvcm0iLCJpbkFuaW1hdGlvbiIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsImRyYXciLCJudW1iZXIiLCJsZW5ndGgiLCJhYnMiLCJtb3Zlc0NvdW50ZXIiLCJ6ZXJvIiwibW92ZUFuaW1hdGlvbiIsInNldFRpbWVvdXQiLCJ0ZW1wIiwiY2hlY2tXaW4iLCJ0aW1lclBhdXNlIiwid2luIiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJjcmVhdGVCb2FyZCIsInNodWZmbGUiLCJyZW5kZXJCb2FyZCIsImluaXQiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsInN3YXAiLCJwYXJzZUludCIsImRyYWdTdGFydCIsImRyYWdPdmVyIiwiZHJhZ0Ryb3AiLCJkcmFnRW5kIiwiaGVhZGVyIiwibWVudSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYmdQb3NpdGlvbiIsImJvYXJkVGFibGUiLCJtb3ZlcyIsInBhcnNlIiwiZ2V0SXRlbSIsImxvYWQiXSwibWFwcGluZ3MiOiJtQkFBZSxNQUFNQSxFQUNuQixjQUNFQyxLQUFLQyxZQUFjLEVBSXJCLGtCQUNFRCxLQUFLRSxLQUFPQyxhQUFZLEtBQ3RCSCxLQUFLQyxhQUFlLEVBQ3BCRCxLQUFLSSxtQkFDSixLQUdMLGlCQUNFSixLQUFLSyxRQUFVQyxLQUFLQyxNQUFNUCxLQUFLQyxZQUFjLElBRTdDRCxLQUFLUSxLQUFPUixLQUFLQyxZQUFjLElBQUlRLFFBQVEsR0FDM0NULEtBQUtVLE1BQVEsR0FBR1YsS0FBS0ssV0FBV0wsS0FBS1EsSUFBTSxHQUFLLElBQU0sS0FBS1IsS0FBS1EsTUFDaEVSLEtBQUtXLGNBR1AsWUFDRUMsY0FBY1osS0FBS0UsTUFDbkJGLEtBQUtVLE1BQVEsT0FDYlYsS0FBS1csY0FHUCxhQUNFQyxjQUFjWixLQUFLRSxNQUdyQixjQUNFVyxTQUFTQyxjQUFjLFNBQVNDLFVBQVlmLEtBQUtVLE1BR25ELE9BQ0VWLEtBQUtnQixZQUNMaEIsS0FBS0MsWUFBYyxLQUNuQkQsS0FBS2lCLGtCQUdQLE9BQ0VqQixLQUFLZ0IsWUFDTGhCLEtBQUtJLGlCQUNMSixLQUFLVyxjQUVMWCxLQUFLaUIsbUJDNUNULE1BQU1DLEVBQVEsSUNBQyxNQUNiLGNBQ0VsQixLQUFLbUIsT0FB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Q2JDLFdBQVlqRixFQUFNbUIsU0FDbEJqQixRQUFTRixFQUFNRSxRQUNmQyxLQUFNSCxFQUFNRyxLQUNaK0UsV0FBWWxGLEVBQU1nQixJQUNsQmhDLEtBQU1nQixFQUFNQyxPQUFPbEIsWUFDbkJvRyxNQUFPbkYsRUFBTWtELGFBQ2JDLEtBQU0sQ0FBRW5ELEVBQU1JLE9BQVFKLEVBQU1LLGNBS2xDVixTQUFTQyxjQUFjLFNBQVNzRSxpQkFBaUIsU0FBUyxLQUN4RCxNQUFNLFdBQUVlLEVBQVUsUUFBRS9FLEVBQU8sS0FBRUMsRUFBSSxXQUFFK0UsRUFBVSxLQUFFbEcsRUFBSSxNQUFFbUcsRUFBSyxLQUFFaEMsR0FBUzRCLEtBQUtLLE1BQ3hFUCxhQUFhUSxRQUFRLGFBRXZCckYsRUFBTW1CLFNBQVc4RCxFQUNqQmpGLEVBQU1FLFFBQVVBLEVBQ2hCRixFQUFNRyxLQUFPQSxFQUNiSCxFQUFNQyxPQUFPbEIsWUFBY0MsRUFDM0JnQixFQUFNa0QsYUFBZWlDLEVBQ3JCbkYsRUFBTWdCLElBQU1rRSxFQUNabEYsRUFBTXNGLE9BQ050RixFQUFNQyxPQUFPcUYsUUFDWHRGLEVBQU1JLE9BQVFKLEVBQU1LLFFBQVc4QyxLQUduQ3hELFNBQVMrRCxlQUFlLGFBQWFRLGlCQUFpQixVQUFVLEtBQzlEbEUsRUFBTWdFLE9BQ05oRSxFQUFNQyxPQUFPK0QsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IDA7XHJcbiAgICAvLyB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gIH1cclxuXHJcbiAgY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4gICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IDE7XHJcbiAgICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIH0sIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgc2VjVG9NaW5BbmRTZWMoKSB7XHJcbiAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MCk7XHJcblxyXG4gICAgdGhpcy5zZWMgPSAodGhpcy5jdXJyZW50VGltZSAlIDYwKS50b0ZpeGVkKDApO1xyXG4gICAgdGhpcy50aW1lciA9IGAke3RoaXMubWludXRlc306JHt0aGlzLnNlYyA8IDEwID8gJzAnIDogJyd9JHt0aGlzLnNlY31gO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJTdG9wKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWUpO1xyXG4gICAgdGhpcy50aW1lciA9ICcwOjAwJztcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuICB9XHJcblxyXG4gIHRpbWVyUGF1c2UoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUaW1lcigpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJykuaW5uZXJIVE1MID0gdGhpcy50aW1lcjtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnRpbWVyU3RvcCgpO1xyXG4gICAgdGhpcy5jdXJyZW50VGltZSA9IG51bGw7XHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLnNlY1RvTWluQW5kU2VjKCk7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcblxyXG4gICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5cclxuY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoKTtcclxuXHJcblxyXG5jb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoZWFkZXInKTtcclxuaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2hlYWRlcicpO1xyXG5oZWFkZXIuaW5uZXJIVE1MID0gJzxoMSBjbGFzcz1cImhlYWRpbmdcIj5nZW0gcHV6emxlPC9oMT4nO1xyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlYWRlcik7XHJcblxyXG5jb25zdCBtZW51ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbm1lbnUuY2xhc3NMaXN0LmFkZCgnbWVudScpO1xyXG5cclxubWVudS5pbm5lckhUTUwgPSBgICBcclxuICA8ZGl2IGNsYXNzPVwic2V0dGluZ3NcIj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJuZXctZ2FtZSBidG5cIj5OZXc8L2J1dHRvbj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJzYXZlIGJ0blwiPlNhdmU8L2J1dHRvbj5cclxuICAgIDxidXR0b24gY2xhc3M9XCJsb2FkIGJ0blwiPkxvYWQ8L2J1dHRvbj5cclxuICAgIDxkaXYgY2xhc3M9XCJzaXplXCI+XHJcbiAgICAgIDxzZWxlY3QgaWQ9XCJmaWVsZFNpemVcIj5cclxuICAgICAgPG9wdGlvbiBzZWxlY3RlZD1cInNlbGVjdGVkXCIgdmFsdWU9XCI0XCIgZGlzYWJsZWQ+RmllbGQgc2l6ZTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI0XCI+NDwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI1XCI+NTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI2XCI+Njwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI3XCI+Nzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI4XCI+ODwvb3B0aW9uPlxyXG4gICAgICA8L3NlbGVjdD5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJjb3VudGVyc1wiPlxyXG4gICAgPGRpdiBjbGFzcz1cInRpbWVyXCI+PHNwYW4+VGltZXI6PC9zcGFuPjxzcGFuIGNsYXNzPVwidGltZVwiPjA6MDA8L3NwYW4+PC9kaXY+XHJcbiAgICA8ZGl2IGNsYXNzPVwibW92ZXNcIj48c3Bhbj5Nb3Zlczo8L3NwYW4+PHNwYW4gY2xhc3M9XCJtb3ZlXCI+MDwvc3Bhbj48L2Rpdj5cclxuICA8L2Rpdj5gO1xyXG5cclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZW51KTtcclxuXHJcbmJvYXJkLmluaXQoKTtcclxuXHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LWdhbWUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcblxyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYXZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcblxyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFxyXG4gICAgJ2dhbWVTYXZlJyxcclxuICAgIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgYmdQb3NpdGlvbjogYm9hcmQuYmdQb3NBcnIsXHJcbiAgICAgIGhpc3Rvcnk6IGJvYXJkLmhpc3RvcnksXHJcbiAgICAgIHNpemU6IGJvYXJkLnNpemUsXHJcbiAgICAgIGJvYXJkVGFibGU6IGJvYXJkLmFycixcclxuICAgICAgdGltZTogYm9hcmQudGltZXJDLmN1cnJlbnRUaW1lLFxyXG4gICAgICBtb3ZlczogYm9hcmQubW92ZXNDb3VudGVyLFxyXG4gICAgICB6ZXJvOiBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF1cclxuICAgIH0pXHJcbiAgKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGNvbnN0IHsgYmdQb3NpdGlvbiwgaGlzdG9yeSwgc2l6ZSwgYm9hcmRUYWJsZSwgdGltZSwgbW92ZXMsIHplcm8gfSA9IEpTT04ucGFyc2UoXHJcbiAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2FtZVNhdmUnKVxyXG4gICk7XHJcbiAgYm9hcmQuYmdQb3NBcnIgPSBiZ1Bvc2l0aW9uO1xyXG4gIGJvYXJkLmhpc3RvcnkgPSBoaXN0b3J5O1xyXG4gIGJvYXJkLnNpemUgPSBzaXplO1xyXG4gIGJvYXJkLnRpbWVyQy5jdXJyZW50VGltZSA9IHRpbWU7XHJcbiAgYm9hcmQubW92ZXNDb3VudGVyID0gbW92ZXM7XHJcbiAgYm9hcmQuYXJyID0gYm9hcmRUYWJsZTtcclxuICBib2FyZC5sb2FkKCk7XHJcbiAgYm9hcmQudGltZXJDLmxvYWQoKTtcclxuICBbIGJvYXJkLmVtcHR5WCwgYm9hcmQuZW1wdHlZIF0gPSB6ZXJvO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWVsZFNpemUnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XHJcbiAgYm9hcmQuaW5pdCgpO1xyXG4gIGJvYXJkLnRpbWVyQy5pbml0KCk7XHJcbn0pO1xyXG5cclxuXHJcbiIsImltcG9ydCBUaW1lciBmcm9tICcuL1RpbWVyLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudGltZXJDID0gbmV3IFRpbWVyKCk7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMuc2l6ZSA9IDQ7XHJcbiAgICB0aGlzLmVtcHR5WCA9IDA7XHJcbiAgICB0aGlzLmVtcHR5WSA9IDA7XHJcbiAgICB0aGlzLmFuaW1hdGlvblRpbWUgPSA0MDA7XHJcbiAgICB0aGlzLmJvYXJkV2lkdGggPSA0MC44O1xyXG4gICAgdGhpcy5tYXJnaW5TaXplID0gMC4xO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCA9ICgpID0+IHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkJykuZm9yRWFjaCgoZWxlbSkgPT4ge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIG1vdmUoZGlyZWN0aW9uKSB7XHJcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVggIT09XHJcbiAgICAgICAgICAwIC8qICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlYIC0gMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVswXSkgKi9cclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYIC0gMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlYIC09IDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlYICE9PVxyXG4gICAgICAgICAgdGhpcy5zaXplIC1cclxuICAgICAgICAgICAgMSAvKiAmJlxyXG4gICAgICAgICAgKHRoaXMuaGlzdG9yeS5sZW5ndGggPD0gMiB8fCB0aGlzLmVtcHR5WCArIDEgIT09IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMl1bMF0pICovXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggKyAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCArPSAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgIT09XHJcbiAgICAgICAgICB0aGlzLnNpemUgLVxyXG4gICAgICAgICAgICAxIC8qICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlZICsgMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVsxXSkgKi9cclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgKyAxXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZICs9IDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgIT09XHJcbiAgICAgICAgICAwIC8qICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlZIC0gMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVsxXSkgKi9cclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSAtIDFdID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNyZWF0ZUJvYXJkKCkge1xyXG4gICAgY29uc3QgYXJyID0gW107XHJcblxyXG4gICAgdGhpcy5iZ1Bvc0FyciA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBhcnJbaV0gPSBbXTtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGlmIChpICsgaiAhPT0gKHRoaXMuc2l6ZSAtIDEpICogMikge1xyXG4gICAgICAgICAgYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgICAgdGhpcy5iZ1Bvc0Fyci5wdXNoKFxyXG4gICAgICAgICAgICBgJHtNYXRoLnJvdW5kKDEwMCAvICh0aGlzLnNpemUgLSAxKSAqIGopfSUgJHtNYXRoLnJvdW5kKDEwMCAvICh0aGlzLnNpemUgLSAxKSAqIGkpfSVgXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhcnJbaV1bal0gPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxuICB9XHJcblxyXG4gIHNodWZmbGUoKSB7XHJcbiAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZSAqKiAzOyBpICs9IDEpIHtcclxuICAgICAgc3dpdGNoIChNYXRoLmZsb29yKDQgKiBNYXRoLnJhbmRvbSgpKSkge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgdGhpcy5tb3ZlKCd1cCcpO1xyXG5cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuXHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG5cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgdGhpcy5tb3ZlKCdsZWZ0Jyk7XHJcblxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGkgLT0gMTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckJvYXJkKCkge1xyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBjb25zdCBib2FyZFdpZHRoID0gYCR7dGhpcy5ib2FyZFdpZHRofXJlbWA7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuICAgICAgICBjb25zdCBkcmFnZ2FibGUgPSAhIXRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIGNvbnN0IGJHcG9zID0gdGhpcy5iZ1Bvc0FycltjZWxsTnVtYmVyIC0gMV07XHJcbiAgICAgICAgb3JkZXIgKz0gMTtcclxuXHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J3dpZHRoOiR7dGhpcy5jZWxsU2l6ZX1yZW07IGhlaWdodDoke3RoaXNcclxuICAgICAgICAgIC5jZWxsU2l6ZX1yZW07IG9yZGVyOiR7b3JkZXJ9OyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAke2JHcG9zfTsgYmFja2dyb3VuZC1zaXplOiAke2JvYXJkV2lkdGh9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcbiAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gYm9hcmRXaWR0aDtcclxuICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gYm9hcmQ7XHJcblxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIGRyYXcoKSB7XHJcbiAgICBjb25zdCByZW1QZXJUaWNrID0gdGhpcy5jZWxsU2l6ZSAvIHRoaXMuYW5pbWF0aW9uVGltZSAqIHRoaXMudGltZVBhc3NlZDtcclxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAwLCAkey1yZW1QZXJUaWNrfXJlbSlgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggMCwgJHtyZW1QZXJUaWNrfXJlbSlgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSggJHstcmVtUGVyVGlja31yZW0sIDApYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAke3JlbVBlclRpY2t9cmVtLCAwKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVBbmltYXRpb24oKSB7XHJcbiAgICB0aGlzLmluQW5pbWF0aW9uID0gdHJ1ZTtcclxuICAgIHRoaXMuc3RhcnQgPSBEYXRlLm5vdygpO1xyXG5cclxuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMudGltZVBhc3NlZCA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0O1xyXG5cclxuICAgICAgaWYgKHRoaXMudGltZVBhc3NlZCA+PSB0aGlzLmFuaW1hdGlvblRpbWUpIHtcclxuICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpO1xyXG4gICAgICAgIHRoaXMuaW5BbmltYXRpb24gPSBmYWxzZTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfSwgMjApO1xyXG4gIH1cclxuXHJcbiAgc3dhcChudW1iZXIpIHtcclxuICAgIGlmICh0aGlzLmluQW5pbWF0aW9uKSByZXR1cm47XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFyci5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYXJyW2ldLmxlbmd0aDsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXJyW2ldW2pdID09PSBudW1iZXIpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlYIC0gaSkgPD0gMSAmJiB0aGlzLmVtcHR5WSAtIGogPT09IDApIHx8XHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WSAtIGopIDw9IDEgJiYgdGhpcy5lbXB0eVggLSBpID09PSAwKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIE1vdmUgY291bnRlclxyXG4gICAgICAgICAgICB0aGlzLm1vdmVzQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgemVybyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXX1gKTtcclxuICAgICAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFycltpXVtqXX1gKTtcclxuXHJcbiAgICAgICAgICAgIC8vICBmaW5kIHdoZXJlIGFyZSB3ZSBtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYIC0gaSA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICd1cCc7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVggLSBpID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2Rvd24nO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlZIC0gaiA8IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gemVyby5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB6ZXJvLnN0eWxlLm9yZGVyID0gdGhpcy5lLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS5vcmRlciA9IHRlbXA7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYID09PSB0aGlzLmVtcHR5WSAmJiB0aGlzLmVtcHR5WSA9PT0gdGhpcy5zaXplIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnRpbWVyQy50aW1lclBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgICAgICAgICAgJy5ib2FyZCdcclxuICAgICAgICAgICAgICAgICAgKS5pbm5lckhUTUwgKz0gYNCj0YDQsCEg0JLRiyDRgNC10YjQuNC70Lgg0LPQvtC70L7QstC+0LvQvtC80LrRgyDQt9CwICR7ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbm5lckhUTUx9INC4ICR7ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUx9INGF0L7QtNC+0LJgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5hbmltYXRpb25UaW1lKTtcclxuICAgICAgICAgICAgWyB0aGlzLmFycltpXVtqXSwgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSBdID0gW1xyXG4gICAgICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0sXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbaV1bal1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eVggPSBpO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WSA9IGo7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNoZWNrV2luKCkge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy53aW5baV1bal0gIT09IHRoaXMuYXJyW2ldW2pdKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLm1vdmVzQ291bnRlciA9IDA7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG4gICAgdGhpcy5zaXplID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpZWxkU2l6ZScpLnZhbHVlO1xyXG5cclxuICAgIHRoaXMuY2VsbFNpemUgPSBwYXJzZUZsb2F0KHRoaXMuYm9hcmRXaWR0aCAvIHRoaXMuc2l6ZSAtIDIgKiB0aGlzLm1hcmdpblNpemUpLnRvRml4ZWQoMyk7XHJcblxyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCgpO1xyXG5cclxuICAgIHRoaXMuZW1wdHlYID0gdGhpcy5zaXplIC0gMTtcclxuICAgIHRoaXMuZW1wdHlZID0gdGhpcy5zaXplIC0gMTtcclxuXHJcbiAgICB0aGlzLmFyciA9IHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMud2luID0gdGhpcy5jcmVhdGVCb2FyZCgpO1xyXG5cclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG5cclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuICAgIHRoaXMudGltZXJDLmluaXQoKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIHRoaXMuY2VsbFNpemUgPSBwYXJzZUZsb2F0KHRoaXMuYm9hcmRXaWR0aCAvIHRoaXMuc2l6ZSAtIDIgKiB0aGlzLm1hcmdpblNpemUpLnRvRml4ZWQoMyk7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG4gICAgdGhpcy53aW4gPSB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnRpbWVyQy5pbml0KCk7XHJcblxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKS5mb3JFYWNoKChjZWxsKSA9PiB7XHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChldnQpID0+IHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB0aGlzLnN3YXAocGFyc2VJbnQoZWxlbS5pbm5lckhUTUwsIDEwKSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3Zlcik7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyYWdEcm9wKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==