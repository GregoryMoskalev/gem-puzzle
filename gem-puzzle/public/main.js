(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.arr=[],this.movesCounter=null,this.animationTime=400,this.cellSize=104,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter;let t,e="";for(let i=0,s=1;i<this.size;i+=1)for(let r=0;r<this.size;r+=1){t=this.arr[i][r];const h=this.arr[i][r]?"cell":"cell empty",a=!!this.arr[i][r];s+=1,e+=`<div style='order:${s};' id='cell-${t}' class='${h}' draggable="${a}">${t}</div>`}const i=document.createElement("div");i.classList.add("board"),i.innerHTML=e,document.body.appendChild(i)}createBoard(){this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}px)`;break;case"down":this.e.style.transform=`translate( 0, ${t}px)`;break;case"left":this.e.style.transform=`translate( ${-t}px, 0)`;break;case"right":this.e.style.transform=`translate( ${t}px, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-i<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-i>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform=""}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void console.table(this.arr)}}init(){this.removeBoard(),this.createBoard(),this.shuffle(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=new class{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=0,this.calcCurrentTime()}},i=document.createElement("header");i.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n</header>',document.body.appendChild(i),t.init(),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init(),e.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvQm9hcmQuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9UaW1lci5qcyJdLCJuYW1lcyI6WyJib2FyZCIsInRoaXMiLCJoaXN0b3J5Iiwic2l6ZSIsImVtcHR5WCIsImVtcHR5WSIsImFyciIsIm1vdmVzQ291bnRlciIsImFuaW1hdGlvblRpbWUiLCJjZWxsU2l6ZSIsInJlbW92ZUJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsZW0iLCJib2R5IiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3Rpb24iLCJFcnJvciIsInB1c2giLCJpIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibW92ZSIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJjZWxsTnVtYmVyIiwib3JkZXIiLCJqIiwiY2xhc3NOYW1lIiwiZHJhZ2dhYmxlIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsInB4UGVyVGljayIsInRpbWVQYXNzZWQiLCJlIiwic3R5bGUiLCJ0cmFuc2Zvcm0iLCJpbkFuaW1hdGlvbiIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInRpbWVyIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiZHJhdyIsIm51bWJlciIsImxlbmd0aCIsImFicyIsInplcm8iLCJjb25zb2xlIiwibG9nIiwibW92ZUFuaW1hdGlvbiIsInNldFRpbWVvdXQiLCJ0ZW1wIiwidGFibGUiLCJjcmVhdGVCb2FyZCIsInNodWZmbGUiLCJyZW5kZXJCb2FyZCIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwidGFyZ2V0Iiwic3dhcCIsInBhcnNlSW50IiwiZHJhZ1N0YXJ0IiwiZHJhZ092ZXIiLCJkcmFnRHJvcCIsImRyYWdFbmQiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZWNUb01pbkFuZFNlYyIsIm1pbnV0ZXMiLCJzZWMiLCJ0b0ZpeGVkIiwicmVuZGVyVGltZXIiLCJ0aW1lclN0b3AiLCJjYWxjQ3VycmVudFRpbWUiLCJoZWFkZXIiLCJpbml0Il0sIm1hcHBpbmdzIjoibUJBR0EsTUFBTUEsRUFBUSxJQ0hDLE1BQ2IsY0FDRUMsS0FBS0MsUUFBVSxHQUNmRCxLQUFLRSxLQUFPLEVBQ1pGLEtBQUtHLE9BQVMsRUFDZEgsS0FBS0ksT0FBUyxFQUNkSixLQUFLSyxJQUFNLEdBQ1hMLEtBQUtNLGFBQWUsS0FDcEJOLEtBQUtPLGNBQWdCLElBQ3JCUCxLQUFLUSxTQUFXLElBQ2hCUixLQUFLUyxZQUFjLEtBQ2pCQyxTQUFTQyxpQkFBaUIsVUFBVUMsU0FBU0MsSUFDM0NILFNBQVNJLEtBQUtDLFlBQVlGLE9BT2hDLEtBQUtHLEdBQ0gsT0FBUUEsR0FDTixJQUFLLEtBQ0hoQixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxRQUFVSixLQUFLSyxJQUFJTCxLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQ3BFSixLQUFLSyxJQUFJTCxLQUFLRyxPQUFTLEdBQUdILEtBQUtJLFFBQVUsRUFDekNKLEtBQUtHLFFBQVUsRUFDZixNQUNGLElBQUssT0FDSEgsS0FBS0ssSUFBSUwsS0FBS0csUUFBUUgsS0FBS0ksUUFBVUosS0FBS0ssSUFBSUwsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUNwRUosS0FBS0ssSUFBSUwsS0FBS0csT0FBUyxHQUFHSCxLQUFLSSxRQUFVLEVBQ3pDSixLQUFLRyxRQUFVLEVBQ2YsTUFDRixJQUFLLFFBQ0hILEtBQUtLLElBQUlMLEtBQUtHLFFBQVFILEtBQUtJLFFBQVVKLEtBQUtLLElBQUlMLEtBQUtHLFFBQVFILEtBQUtJLE9BQVMsR0FDekVKLEtBQUtLLElBQUlMLEtBQUtHLFFBQVFILEtBQUtJLE9BQVMsR0FBSyxFQUN6Q0osS0FBS0ksUUFBVSxFQUNmLE1BQ0YsSUFBSyxPQUNISixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxRQUFVSixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxPQUFTLEdBQ3pFSixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxPQUFTLEdBQUssRUFDekNKLEtBQUtJLFFBQVUsRUFDZixNQUNGLFFBQ0UsTUFBTSxJQUFJYSxNQUFNLFFBSXRCLFVBR0VqQixLQUFLQyxRQUFRaUIsS0FBSyxDQUFFbEIsS0FBS0csT0FBUUgsS0FBS0ksU0FFdEMsSUFBSyxJQUFJZSxFQUFJLEVBQUdBLEVBQUluQixLQUFLRSxNQUFRLEVBQUdpQixHQUFLLEVBQ3ZDLE9BQVFDLEtBQUtDLE1BQU0sRUFBSUQsS0FBS0UsV0FDMUIsS0FBSyxFQUNpQixJQUFoQnRCLEtBQUtHLE9BR1BILEtBQUt1QixLQUFLLE1BR1Z2QixLQUFLdUIsS0FBSyxRQUVadkIsS0FBS0MsUUFBUWlCLEtBQUssQ0FBRWxCLEtBQUtHLE9BQVFILEtBQUtJLFNBQ3RDLE1BQ0YsS0FBSyxFQUNDSixLQUFLSSxTQUFXSixLQUFLRSxLQUFPLEVBRTlCRixLQUFLdUIsS0FBSyxTQUdWdkIsS0FBS3VCLEtBQUssUUFFWnZCLEtBQUtDLFFBQVFpQixLQUFLLENBQUVsQixLQUFLRyxPQUFRSCxLQUFLSSxTQUN0QyxNQUNGLEtBQUssRUFDQ0osS0FBS0csU0FBV0gsS0FBS0UsS0FBTyxFQUU5QkYsS0FBS3VCLEtBQUssUUFHVnZCLEtBQUt1QixLQUFLLE1BRVp2QixLQUFLQyxRQUFRaUIsS0FBSyxDQUFFbEIsS0FBS0csT0FBUUgsS0FBS0ksU0FDdEMsTUFDRixLQUFLLEVBQ2lCLElBQWhCSixLQUFLSSxPQUVQSixLQUFLdUIsS0FBSyxTQUdWdkIsS0FBS3VCLEtBQUssU0FDVnZCLEtBQUtDLFFBQVFpQixLQUFLLENBQUVsQixLQUFLRyxPQUFRSCxLQUFLSSxVQUV4QyxNQUNGLFFBRUUsTUFEQWUsR0FBSyxFQUNDLElBQUlGLE1BQU0sUUFLeEIsY0FDRWpCLEtBQUtNLGFBQWUsRUFDcEJJLFNBQVNjLGNBQWMsU0FBU0MsVUFBWXpCLEtBQUtNLGFBRWpELElBQ0lvQixFQURBM0IsRUFBUSxHQUdaLElBQUssSUFBSW9CLEVBQUksRUFBR1EsRUFBUSxFQUFHUixFQUFJbkIsS0FBS0UsS0FBTWlCLEdBQUssRUFDN0MsSUFBSyxJQUFJUyxFQUFJLEVBQUdBLEVBQUk1QixLQUFLRSxLQUFNMEIsR0FBSyxFQUFHLENBQ3JDRixFQUFhMUIsS0FBS0ssSUFBSWMsR0FBR1MsR0FDekIsTUFBTUMsRUFBWTdCLEtBQUtLLElBQUljLEdBQUdTLEdBQUssT0FBUyxhQUN0Q0UsSUFBYzlCLEtBQUtLLElBQUljLEdBQUdTLEdBQ2hDRCxHQUFTLEVBQ1Q1QixHQUFTLHFCQUFxQjRCLGdCQUFvQkQsYUFBc0JHLGlCQUF5QkMsTUFBY0osVUFJbkgsTUFBTUssRUFBVXJCLFNBQVNzQixjQUFjLE9BQ3ZDRCxFQUFRRSxVQUFVQyxJQUFJLFNBRXRCSCxFQUFRTixVQUFZMUIsRUFFcEJXLFNBQVNJLEtBQUtxQixZQUFZSixHQUc1QixjQUNFL0IsS0FBS0csT0FBU0gsS0FBS0UsS0FBTyxFQUMxQkYsS0FBS0ksT0FBU0osS0FBS0UsS0FBTyxFQUMxQixJQUFLLElBQUlpQixFQUFJLEVBQUdBLEVBQUluQixLQUFLRSxLQUFNaUIsR0FBSyxFQUFHLENBQ3JDbkIsS0FBS0ssSUFBSWMsR0FBSyxHQUNkLElBQUssSUFBSVMsRUFBSSxFQUFHQSxFQUFJNUIsS0FBS0UsS0FBTTBCLEdBQUssRUFDOUJULEVBQUlTLElBQXdCLEdBQWpCNUIsS0FBS0UsS0FBTyxHQUN6QkYsS0FBS0ssSUFBSWMsR0FBR1MsR0FBS1QsRUFBSW5CLEtBQUtFLEtBQU8wQixFQUFJLEVBRXJDNUIsS0FBS0ssSUFBSWMsR0FBR1MsR0FBSyxHQU16QixPQUNFLE1BQU1RLEVBQVlwQyxLQUFLUSxTQUFXUixLQUFLTyxjQUFnQlAsS0FBS3FDLFdBQzVELE9BQVFyQyxLQUFLZ0IsV0FDWCxJQUFLLEtBQ0hoQixLQUFLc0MsRUFBRUMsTUFBTUMsVUFBWSxrQkFBa0JKLE9BQzNDLE1BQ0YsSUFBSyxPQUNIcEMsS0FBS3NDLEVBQUVDLE1BQU1DLFVBQVksaUJBQWlCSixPQUMxQyxNQUNGLElBQUssT0FDSHBDLEtBQUtzQyxFQUFFQyxNQUFNQyxVQUFZLGVBQWVKLFVBQ3hDLE1BQ0YsSUFBSyxRQUNIcEMsS0FBS3NDLEVBQUVDLE1BQU1DLFVBQVksY0FBY0osVUFDdkMsTUFDRixRQUNFLE1BQU0sSUFBSW5CLE1BQU0sUUFJdEIsZ0JBQ0VqQixLQUFLeUMsYUFBYyxFQUNuQnpDLEtBQUswQyxNQUFRQyxLQUFLQyxNQUVsQjVDLEtBQUs2QyxNQUFRQyxhQUFZLEtBR3ZCLEdBRkE5QyxLQUFLcUMsV0FBYU0sS0FBS0MsTUFBUTVDLEtBQUswQyxNQUVoQzFDLEtBQUtxQyxZQUFjckMsS0FBS08sY0FHMUIsT0FGQXdDLGNBQWMvQyxLQUFLNkMsWUFDbkI3QyxLQUFLeUMsYUFBYyxHQUlyQnpDLEtBQUtnRCxTQUNKLElBR0wsS0FBS0MsR0FDSCxJQUFJakQsS0FBS3lDLFlBRVQsSUFBSyxJQUFJdEIsRUFBSSxFQUFHQSxFQUFJbkIsS0FBS0ssSUFBSTZDLE9BQVEvQixHQUFLLEVBQ3hDLElBQUssSUFBSVMsRUFBSSxFQUFHQSxFQUFJNUIsS0FBS0ssSUFBSWMsR0FBRytCLE9BQVF0QixHQUFLLEVBQzNDLEdBQUk1QixLQUFLSyxJQUFJYyxHQUFHUyxLQUFPcUIsSUFFbEI3QixLQUFLK0IsSUFBSW5ELEtBQUtHLE9BQVNnQixJQUFNLEdBQUtuQixLQUFLSSxPQUFTd0IsR0FBTSxHQUN0RFIsS0FBSytCLElBQUluRCxLQUFLSSxPQUFTd0IsSUFBTSxHQUFLNUIsS0FBS0csT0FBU2dCLEdBQU0sR0FDdkQsQ0FFQW5CLEtBQUtNLGNBQWdCLEVBQ3JCSSxTQUFTYyxjQUFjLFNBQVNDLFVBQVl6QixLQUFLTSxhQUVqRCxNQUFNOEMsRUFBTzFDLFNBQVNjLGNBQWMsU0FBU3hCLEtBQUtLLElBQUlMLEtBQUtHLFFBQVFILEtBQUtJLFNBb0N4RSxPQW5DQUosS0FBS3NDLEVBQUk1QixTQUFTYyxjQUFjLFNBQVN4QixLQUFLSyxJQUFJYyxHQUFHUyxJQUdqRDVCLEtBQUtHLE9BQVNnQixFQUFJLEdBQ3BCa0MsUUFBUUMsSUFBSSxPQUNadEQsS0FBS2dCLFVBQVksS0FDakJoQixLQUFLdUQsaUJBQ0l2RCxLQUFLRyxPQUFTZ0IsRUFBSSxHQUMzQm5CLEtBQUtnQixVQUFZLE9BQ2pCaEIsS0FBS3VELGlCQUNJdkQsS0FBS0ksT0FBU3dCLEVBQUksR0FDM0I1QixLQUFLZ0IsVUFBWSxPQUNqQmhCLEtBQUt1RCxnQkFDTEYsUUFBUUMsSUFBSSxTQUNIdEQsS0FBS0ksT0FBU3dCLEVBQUksSUFDM0I1QixLQUFLZ0IsVUFBWSxRQUNqQmhCLEtBQUt1RCxnQkFDTEYsUUFBUUMsSUFBSSxVQUdkRSxZQUFXLEtBQ1QsTUFBTUMsRUFBT0wsRUFBS2IsTUFBTVosTUFDeEJ5QixFQUFLYixNQUFNWixNQUFRM0IsS0FBS3NDLEVBQUVDLE1BQU1aLE1BQ2hDM0IsS0FBS3NDLEVBQUVDLE1BQU1aLE1BQVE4QixFQUVyQnpELEtBQUtzQyxFQUFFQyxNQUFNQyxVQUFZLEtBQ3hCeEMsS0FBS08sZ0JBRU5QLEtBQUtLLElBQUljLEdBQUdTLEdBQUk1QixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxTQUFZLENBQ3ZESixLQUFLSyxJQUFJTCxLQUFLRyxRQUFRSCxLQUFLSSxRQUMzQkosS0FBS0ssSUFBSWMsR0FBR1MsSUFFZDVCLEtBQUtHLE9BQVNnQixFQUNkbkIsS0FBS0ksT0FBU3dCLE9BQ2R5QixRQUFRSyxNQUFNMUQsS0FBS0ssTUFRN0IsT0FDRUwsS0FBS1MsY0FDTFQsS0FBSzJELGNBQ0wzRCxLQUFLNEQsVUFDTDVELEtBQUs2RCxjQUVMUixRQUFRSyxNQUFNMUQsS0FBS0ssS0FFbkJLLFNBQVNDLGlCQUFpQixTQUFTQyxTQUFTa0QsSUFDMUNBLEVBQUtDLGlCQUFpQixXQUFZQyxJQUNoQyxNQUFNbkQsRUFBT21ELEVBQUlDLE9BQ2pCakUsS0FBS2tFLEtBQUtDLFNBQVN0RCxFQUFLWSxVQUFXLFFBR3JDcUMsRUFBS0MsaUJBQWlCLFlBQWEvRCxLQUFLb0UsV0FFeENOLEVBQUtDLGlCQUFpQixXQUFZL0QsS0FBS3FFLFVBRXZDUCxFQUFLQyxpQkFBaUIsT0FBUS9ELEtBQUtzRSxVQUVuQ1IsRUFBS0MsaUJBQWlCLFVBQVcvRCxLQUFLdUUsY0QzUHRDMUIsRUFBUSxJRUpDLE1BQ2IsY0FDRTdDLEtBQUt3RSxZQUFjLEVBSXJCLGtCQUNFeEUsS0FBS3lFLEtBQU8zQixhQUFZLEtBQ3RCOUMsS0FBS3dFLGFBQWUsRUFDcEJ4RSxLQUFLMEUsbUJBQ0osS0FHTCxpQkFDRTFFLEtBQUsyRSxRQUFVdkQsS0FBS0MsTUFBTXJCLEtBQUt3RSxZQUFjLElBRTdDeEUsS0FBSzRFLEtBQU81RSxLQUFLd0UsWUFBYyxJQUFJSyxRQUFRLEdBQzNDN0UsS0FBSzZDLE1BQVEsR0FBRzdDLEtBQUsyRSxXQUFXM0UsS0FBSzRFLElBQU0sR0FBSyxJQUFNLEtBQUs1RSxLQUFLNEUsTUFDaEU1RSxLQUFLOEUsY0FHUCxZQUNFL0IsY0FBYy9DLEtBQUt5RSxNQUNuQnpFLEtBQUs2QyxNQUFRLE9BQ2I3QyxLQUFLOEUsY0FHUCxjQUNFcEUsU0FBU2MsY0FBYyxTQUFTQyxVQUFZekIsS0FBSzZDLE1BR25ELE9BQ0U3QyxLQUFLK0UsWUFDTC9FLEtBQUt3RSxZQUFjLEVBQ25CeEUsS0FBS2dGLG9CRjVCSEMsRUFBU3ZFLFNBQVNzQixjQUFjLFVBRXRDaUQsRUFBT3hELFVBQVksZ1BBT25CZixTQUFTSSxLQUFLcUIsWUFBWThDLEdBRTFCbEYsRUFBTW1GLE9BQ05yQyxFQUFNcUMsT0FFTnhFLFNBQVNjLGNBQWMsYUFBYXVDLGlCQUFpQixTQUFTLEtBQzVEaEUsRUFBTW1GLE9BQ05yQyxFQUFNcUMsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvYXJkIGZyb20gJy4vQm9hcmQuanMnO1xyXG5pbXBvcnQgVGltZXIgZnJvbSAnLi9UaW1lci5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5jb25zdCB0aW1lciA9IG5ldyBUaW1lcigpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcblxyXG5oZWFkZXIuaW5uZXJIVE1MID0gYCAgXHJcbjxoZWFkZXIgY2xhc3M9XCJoZWFkZXJcIj5cclxuICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWVcIj5OZXcgZ2FtZTwvYnV0dG9uPlxyXG4gIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wOjAwPC9zcGFuPjwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG48L2hlYWRlcj5gO1xyXG5cclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG5cclxuYm9hcmQuaW5pdCgpO1xyXG50aW1lci5pbml0KCk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LWdhbWUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcbiAgdGltZXIuaW5pdCgpO1xyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hcnIgPSBbXTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gbnVsbDtcclxuICAgIHRoaXMuYW5pbWF0aW9uVGltZSA9IDQwMDtcclxuICAgIHRoaXMuY2VsbFNpemUgPSAxMDQ7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkID0gKCkgPT4ge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9hcmQnKS5mb3JFYWNoKChlbGVtKSA9PiB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gbGV0IHNpemUgPSA0O1xyXG5cclxuICBtb3ZlKGRpcmVjdGlvbikge1xyXG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVggLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WSArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNodWZmbGUoKSB7XHJcbiAgICAvLyB0aGlzLmVtcHR5WCA9IHNpemUgLSAxO1xyXG4gICAgLy8gdGhpcy5lbXB0eVkgPSBzaXplIC0gMTtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplICoqIDM7IGkgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuICAgICAgICBjb25zdCBkcmFnZ2FibGUgPSAhIXRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J29yZGVyOiR7b3JkZXJ9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcblxyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQm9hcmQoKSB7XHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHRoaXMuYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcHhQZXJUaWNrID0gdGhpcy5jZWxsU2l6ZSAvIHRoaXMuYW5pbWF0aW9uVGltZSAqIHRoaXMudGltZVBhc3NlZDtcclxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAwLCAkey1weFBlclRpY2t9cHgpYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cHhQZXJUaWNrfXB4KWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAkey1weFBlclRpY2t9cHgsIDApYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAke3B4UGVyVGlja31weCwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5pbkFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuXHJcbiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRpbWVQYXNzZWQgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRpbWVQYXNzZWQgPj0gdGhpcy5hbmltYXRpb25UaW1lKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTtcclxuICAgICAgICB0aGlzLmluQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH0sIDIwKTtcclxuICB9XHJcblxyXG4gIHN3YXAobnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbkFuaW1hdGlvbikgcmV0dXJuO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnIubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmFycltpXS5sZW5ndGg7IGogKz0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFycltpXVtqXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WCAtIGkpIDw9IDEgJiYgdGhpcy5lbXB0eVkgLSBqID09PSAwKSB8fFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVkgLSBqKSA8PSAxICYmIHRoaXMuZW1wdHlYIC0gaSA9PT0gMClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIGNvdW50ZXJcclxuICAgICAgICAgICAgdGhpcy5tb3Zlc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vdmUnKS5pbm5lckhUTUwgPSB0aGlzLm1vdmVzQ291bnRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHplcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV19YCk7XHJcbiAgICAgICAgICAgIHRoaXMuZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbaV1bal19YCk7XHJcblxyXG4gICAgICAgICAgICAvLyAgZmluZCB3aGVyZSBhcmUgd2UgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCAtIGkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwIScpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3VwJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WCAtIGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqIDwgMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgLSBqID4gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3JpZ2h0JztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmlnaHQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHplcm8uc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgemVyby5zdHlsZS5vcmRlciA9IHRoaXMuZS5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUub3JkZXIgPSB0ZW1wO1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcblxyXG4gICAgICAgICAgICBbIHRoaXMuYXJyW2ldW2pdLCB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldIF0gPSBbXHJcbiAgICAgICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSxcclxuICAgICAgICAgICAgICB0aGlzLmFycltpXVtqXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5WCA9IGk7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlZID0gajtcclxuICAgICAgICAgICAgY29uc29sZS50YWJsZSh0aGlzLmFycik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnNodWZmbGUoKTtcclxuICAgIHRoaXMucmVuZGVyQm9hcmQoKTtcclxuXHJcbiAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIC8vIHRoaXMudGltZXIgPSAnMDowMCc7XHJcbiAgfVxyXG5cclxuICBjYWxjQ3VycmVudFRpbWUoKSB7XHJcbiAgICB0aGlzLnRpbWUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY3VycmVudFRpbWUgKz0gMTtcclxuICAgICAgdGhpcy5zZWNUb01pbkFuZFNlYygpO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG5cclxuICBzZWNUb01pbkFuZFNlYygpIHtcclxuICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IodGhpcy5jdXJyZW50VGltZSAvIDYwKTtcclxuXHJcbiAgICB0aGlzLnNlYyA9ICh0aGlzLmN1cnJlbnRUaW1lICUgNjApLnRvRml4ZWQoMCk7XHJcbiAgICB0aGlzLnRpbWVyID0gYCR7dGhpcy5taW51dGVzfToke3RoaXMuc2VjIDwgMTAgPyAnMCcgOiAnJ30ke3RoaXMuc2VjfWA7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcbiAgfVxyXG5cclxuICB0aW1lclN0b3AoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgICB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyVGltZXIoKSB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGltZScpLmlubmVySFRNTCA9IHRoaXMudGltZXI7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuY3VycmVudFRpbWUgPSAwO1xyXG4gICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIGNhbGNTdGFydFRpbWUoKSB7XHJcbi8vICAgdGhpcy5zdGFydERhdGUgPSBEYXRlLm5vdygpO1xyXG4vLyAgIGNvbnNvbGUubG9nKHRoaXMuc3RhcnREYXRlKTtcclxuLy8gfVxyXG5cclxuLy8gY2FsY0N1cnJlbnRUaW1lKCkge1xyXG4vLyAgIHRoaXMuY3VycmVudFRpbWUgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydERhdGU7XHJcbi8vICAgY29uc29sZS5sb2codGhpcy5jdXJyZW50VGltZSk7XHJcbi8vIH1cclxuXHJcbi8vIGluaXRUaW1lcigpIHtcclxuLy8gICB0aGlzLmNhbGNTdGFydFRpbWUoKTtcclxuLy8gICB0aGlzLnRpbWUoKTtcclxuLy8gfVxyXG5cclxuLy8gbXNUb01pbkFuZFNlYygpIHtcclxuLy8gICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKHRoaXMuY3VycmVudFRpbWUgLyA2MDAwMCk7XHJcbi8vICAgdGhpcy5zZWMgPSAoKHRoaXMuY3VycmVudFRpbWUgJSA2MDAwMCkgLyAxMDAwKS50b0ZpeGVkKDApO1xyXG5cclxuLy8gICByZXR1cm4gYCR7dGhpcy5taW51dGVzfToke3RoaXMuc2VjIDwgMTAgPyAnMCcgOiAnJ30ke3RoaXMuc2VjfWA7XHJcbi8vIH1cclxuXHJcbi8vIHRpbWUoKSB7XHJcbi8vICAgdGhpcy50aW1lID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4vLyAgICAgdGhpcy5jYWxjQ3VycmVudFRpbWUoKTtcclxuLy8gICAgIGNvbnNvbGUubG9nKHRoaXMubXNUb01pbkFuZFNlYygpKTtcclxuLy8gICB9LCA1MDApO1xyXG4vLyB9XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=