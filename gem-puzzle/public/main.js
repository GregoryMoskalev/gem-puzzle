(()=>{"use strict";class t{constructor(){this.currentTime=0}calcCurrentTime(){this.time=setInterval((()=>{this.currentTime+=1,this.secToMinAndSec()}),1e3)}secToMinAndSec(){this.minutes=Math.floor(this.currentTime/60),this.sec=(this.currentTime%60).toFixed(0),this.timer=`${this.minutes}:${this.sec<10?"0":""}${this.sec}`,this.renderTimer()}timerStop(){clearInterval(this.time),this.timer="0:00",this.renderTimer()}timerPause(){clearInterval(this.time)}renderTimer(){document.querySelector(".time").innerHTML=this.timer}init(){this.timerStop(),this.currentTime=null,this.calcCurrentTime()}load(){this.timerStop(),this.secToMinAndSec(),this.renderTimer(),this.calcCurrentTime()}}const e=new class{constructor(){this.timerC=new t,this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.animationTime=200,this.boardWidth=40.8,this.marginSize=.1,this.soundOn=!0,this.winSound=new Audio("../assets/win.mp3"),this.slideSound=new Audio("../assets/slide.mp3"),this.slideSound.volume=.2,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}randomImgNumber(t,e){this.imgNumb=Math.floor(Math.random()*(t-e)+e)}back(){this.history.pop(),this.backTimer()}backTimer(){setTimeout((()=>{if(this.history.length){const[t,e]=this.history.pop();this.e=document.querySelector("#cell-"+this.arr[t][e]),this.moveAnimation([t,e]),setTimeout((()=>{const i=this.arr[this.emptyX][this.emptyY];this.arr[this.emptyX][this.emptyY]=this.arr[t][e],this.arr[t][e]=i,this.emptyX=t,this.emptyY=e,this.removeBoard(),this.renderBoard(),this.playSlideSound(),this.backTimer()}),this.animationTime)}else this.checkWin()&&(this.setWinMessage(!0),this.playWinSound())}),this.animationTime)}move(t){switch(t){case"up":0!==this.emptyX&&(this.history.length<=2||this.emptyX-1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"down":this.emptyX!==this.size-1&&(this.history.length<=2||this.emptyX+1!==this.history[this.history.length-2][0])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"right":this.emptyY!==this.size-1&&(this.history.length<=2||this.emptyY+1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;case"left":0!==this.emptyY&&(this.history.length<=2||this.emptyY-1!==this.history[this.history.length-2][1])?(this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1,this.history.push([this.emptyX,this.emptyY])):this.counter-=1;break;default:throw new Error(">:(")}}createBoard(){const t=[];this.bgPosArr=[];for(let e=0;e<this.size;e+=1){t[e]=[];for(let i=0;i<this.size;i+=1)e+i!==2*(this.size-1)?(t[e][i]=e*this.size+i+1,this.bgPosArr.push(`${Math.round(100/(this.size-1)*i)}% ${Math.round(100/(this.size-1)*e)}%`)):t[e][i]=0}return t}shuffle(){for(this.history.push([this.emptyX,this.emptyY]),this.counter=0;this.counter<this.size**3;this.counter+=1)switch(Math.floor(4*Math.random())){case 0:this.move("up");break;case 1:this.move("right");break;case 2:this.move("down");break;case 3:this.move("left");break;default:throw new Error(">:(")}}renderBoard(){let t="";const e=this.boardWidth+"rem";let i;for(let s=0,r=1;s<this.size;s+=1)for(let h=0;h<this.size;h+=1){i=this.arr[s][h];const n=this.arr[s][h]?"cell":"cell empty",o=!!this.arr[s][h],a=this.bgPosArr[i-1],m=this.arr[s][h]?`background: url(../assets/images/${this.imgNumb}.jpg); background-position: ${a}; background-size: ${e};`:"";r+=1,t+=`<div \n          style='width:${this.cellSize}rem;\n          height:${this.cellSize}rem;\n          order:${r};\n          ${m}'\n          id='cell-${i}'\n          class='${n}'\n          draggable="${o}">${i}</div>`}const s=document.createElement("div");s.classList.add("board"),s.style.width=e,s.innerHTML=t,document.body.appendChild(s)}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}rem)`;break;case"down":this.e.style.transform=`translate( 0, ${t}rem)`;break;case"left":this.e.style.transform=`translate( ${-t}rem, 0)`;break;case"right":this.e.style.transform=`translate( ${t}rem, 0)`;break;default:throw new Error(">:(")}}moveAnimation([t,e]){this.emptyX<t?this.direction="up":this.emptyX>t?this.direction="down":this.emptyY<e?this.direction="left":this.emptyY>e&&(this.direction="right"),this.inAnimation=!0,this.start=Date.now(),this.timer=setInterval((()=>{if(this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime)return clearInterval(this.timer),void(this.inAnimation=!1);this.draw()}),20)}toggleSound(){this.soundOn=!this.soundOn}swap(t){if(!this.inAnimation)for(let e=0;e<this.arr.length;e+=1)for(let i=0;i<this.arr[e].length;i+=1)if(this.arr[e][i]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-i==0||Math.abs(this.emptyY-i)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][i]),this.moveAnimation([e,i]),this.playSlideSound(),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform="",this.emptyX===this.emptyY&&this.emptyY===this.size-1&&this.checkWin()&&(this.timerC.timerPause(),this.setWinMessage(),this.playWinSound())}),this.animationTime),[this.arr[e][i],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][i]],this.emptyX=e,this.emptyY=i,void this.history.push([this.emptyX,this.emptyY])}}checkWin(){for(let t=0;t<this.size;t+=1)for(let e=0;e<this.size;e+=1)if(t+e!==2*(this.size-1)&&this.win[t][e]!==this.arr[t][e])return!1;return!0}setWinMessage(t){this.winBoard=document.querySelector(".board"),this.winBoard.classList.add("win"),this.winBoard.innerHTML+=`<div style="background-image: url(../assets/images/${this.imgNumb}.jpg);" class='win-text'>${t?"ЧИТЕР!":`Ура! Вы решили головоломку за ${document.querySelector(".time").innerHTML} и ${document.querySelector(".move").innerHTML} ходов</div>`}</div>`,setTimeout((()=>{this.winBoard.querySelector(".win-text").style.opacity=1}),50)}playWinSound(){this.soundOn&&(this.winSound.currentTime=0,this.winSound.play())}playSlideSound(){this.soundOn&&(this.slideSound.currentTime=0,this.slideSound.play())}init(){this.randomImgNumber(150,1),this.history=[],this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter,this.size=document.getElementById("fieldSize").value,this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),this.removeBoard(),this.emptyX=this.size-1,this.emptyY=this.size-1,this.arr=this.createBoard(),this.win=this.createBoard(),this.shuffle(),this.renderBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}load(){this.cellSize=parseFloat(this.boardWidth/this.size-2*this.marginSize).toFixed(3),document.querySelector(".move").innerHTML=this.movesCounter,this.removeBoard(),this.renderBoard(),this.win=this.createBoard(),this.timerC.init(),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},i=document.createElement("header");i.classList.add("header"),i.innerHTML='<h1 class="heading">gem puzzle</h1>',document.body.appendChild(i);const s=document.createElement("div");s.classList.add("menu"),s.innerHTML=`  \n  <div class="settings">\n    <button class="new-game btn">New</button>\n    <button class="save btn">Save</button>\n    <button class="load btn">Load</button>\n    <button class="sound btn ${e.soundOn?"btn-on":""}">Sound</button>\n    <div class="size">\n      <select id="fieldSize">\n      <option selected="selected" value="4" disabled>Field size</option>\n        <option value="3">3</option>\n        <option value="4">4</option>\n        <option value="5">5</option>\n        <option value="6">6</option>\n        <option value="7">7</option>\n        <option value="8">8</option>\n      </select>\n    </div>\n    <button class="cheat btn">CHEAT</button>\n  </div>\n  <div class="counters">\n    <div class="timer"><span>Timer:</span><span class="time">0:00</span></div>\n    <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n  </div>`,document.body.appendChild(s),e.init(),document.querySelector(".new-game").addEventListener("click",(()=>{e.init()})),document.querySelector(".save").addEventListener("click",(()=>{localStorage.setItem("gameSave",JSON.stringify({bgPosition:e.bgPosArr,history:e.history,size:e.size,boardTable:e.arr,time:e.timerC.currentTime,moves:e.movesCounter,zero:[e.emptyX,e.emptyY],imgNumb:e.imgNumb}))})),document.querySelector(".load").addEventListener("click",(()=>{const{bgPosition:t,history:i,size:s,boardTable:r,time:h,moves:n,zero:o,imgNumb:a}=JSON.parse(localStorage.getItem("gameSave"));e.bgPosArr=t,e.history=i,e.size=s,e.timerC.currentTime=h,e.movesCounter=n,e.arr=r,[e.emptyX,e.emptyY]=o,e.imgNumb=a,e.load(),e.timerC.load()})),document.getElementById("fieldSize").addEventListener("change",(()=>{e.init(),e.timerC.init()})),document.querySelector(".cheat").addEventListener("click",(()=>{e.timerC.timerPause(),e.back()})),document.querySelector(".sound").addEventListener("click",(t=>{e.toggleSound(),e.soundOn?t.target.classList.add("btn-on"):t.target.classList.remove("btn-on")}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL1RpbWVyLmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9Cb2FyZC5qcyJdLCJuYW1lcyI6WyJUaW1lciIsInRoaXMiLCJjdXJyZW50VGltZSIsInRpbWUiLCJzZXRJbnRlcnZhbCIsInNlY1RvTWluQW5kU2VjIiwibWludXRlcyIsIk1hdGgiLCJmbG9vciIsInNlYyIsInRvRml4ZWQiLCJ0aW1lciIsInJlbmRlclRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRpbWVyU3RvcCIsImNhbGNDdXJyZW50VGltZSIsImJvYXJkIiwidGltZXJDIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhbmltYXRpb25UaW1lIiwiYm9hcmRXaWR0aCIsIm1hcmdpblNpemUiLCJzb3VuZE9uIiwid2luU291bmQiLCJBdWRpbyIsInNsaWRlU291bmQiLCJ2b2x1bWUiLCJyZW1vdmVCb2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbSIsImJvZHkiLCJyZW1vdmVDaGlsZCIsIm1heCIsIm1pbiIsImltZ051bWIiLCJyYW5kb20iLCJwb3AiLCJiYWNrVGltZXIiLCJzZXRUaW1lb3V0IiwibGVuZ3RoIiwieCIsInkiLCJlIiwiYXJyIiwibW92ZUFuaW1hdGlvbiIsInRlbXAiLCJyZW5kZXJCb2FyZCIsInBsYXlTbGlkZVNvdW5kIiwiY2hlY2tXaW4iLCJzZXRXaW5NZXNzYWdlIiwicGxheVdpblNvdW5kIiwiZGlyZWN0aW9uIiwicHVzaCIsImNvdW50ZXIiLCJFcnJvciIsImJnUG9zQXJyIiwiaSIsImoiLCJyb3VuZCIsIm1vdmUiLCJjZWxsTnVtYmVyIiwib3JkZXIiLCJjbGFzc05hbWUiLCJkcmFnZ2FibGUiLCJiR3BvcyIsImJnRm9yQ2VsbCIsImNlbGxTaXplIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsIndpZHRoIiwiYXBwZW5kQ2hpbGQiLCJyZW1QZXJUaWNrIiwidGltZVBhc3NlZCIsInRyYW5zZm9ybSIsImluQW5pbWF0aW9uIiwic3RhcnQiLCJEYXRlIiwibm93IiwiZHJhdyIsIm51bWJlciIsImFicyIsIm1vdmVzQ291bnRlciIsInplcm8iLCJ0aW1lclBhdXNlIiwid2luIiwiY2hlYXQiLCJ3aW5Cb2FyZCIsIm9wYWNpdHkiLCJwbGF5IiwicmFuZG9tSW1nTnVtYmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJjcmVhdGVCb2FyZCIsInNodWZmbGUiLCJpbml0IiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJzd2FwIiwicGFyc2VJbnQiLCJkcmFnU3RhcnQiLCJkcmFnT3ZlciIsImRyYWdEcm9wIiwiZHJhZ0VuZCIsImhlYWRlciIsIm1lbnUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImJnUG9zaXRpb24iLCJib2FyZFRhYmxlIiwibW92ZXMiLCJwYXJzZSIsImdldEl0ZW0iLCJsb2FkIiwiYmFjayIsInRvZ2dsZVNvdW5kIiwicmVtb3ZlIl0sIm1hcHBpbmdzIjoibUJBQWUsTUFBTUEsRUFDbkIsY0FDRUMsS0FBS0MsWUFBYyxFQUlyQixrQkFDRUQsS0FBS0UsS0FBT0MsYUFBWSxLQUN0QkgsS0FBS0MsYUFBZSxFQUNwQkQsS0FBS0ksbUJBQ0osS0FHTCxpQkFDRUosS0FBS0ssUUFBVUMsS0FBS0MsTUFBTVAsS0FBS0MsWUFBYyxJQUU3Q0QsS0FBS1EsS0FBT1IsS0FBS0MsWUFBYyxJQUFJUSxRQUFRLEdBQzNDVCxLQUFLVSxNQUFRLEdBQUdWLEtBQUtLLFdBQVdMLEtBQUtRLElBQU0sR0FBSyxJQUFNLEtBQUtSLEtBQUtRLE1BQ2hFUixLQUFLVyxjQUdQLFlBQ0VDLGNBQWNaLEtB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T0FBTyxjIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIC8vIHRoaXMudGltZXIgPSAnMDowMCc7XHJcbiAgfVxyXG5cclxuICBjYWxjQ3VycmVudFRpbWUoKSB7XHJcbiAgICB0aGlzLnRpbWUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY3VycmVudFRpbWUgKz0gMTtcclxuICAgICAgdGhpcy5zZWNUb01pbkFuZFNlYygpO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG5cclxuICBzZWNUb01pbkFuZFNlYygpIHtcclxuICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IodGhpcy5jdXJyZW50VGltZSAvIDYwKTtcclxuXHJcbiAgICB0aGlzLnNlYyA9ICh0aGlzLmN1cnJlbnRUaW1lICUgNjApLnRvRml4ZWQoMCk7XHJcbiAgICB0aGlzLnRpbWVyID0gYCR7dGhpcy5taW51dGVzfToke3RoaXMuc2VjIDwgMTAgPyAnMCcgOiAnJ30ke3RoaXMuc2VjfWA7XHJcbiAgICB0aGlzLnJlbmRlclRpbWVyKCk7XHJcbiAgfVxyXG5cclxuICB0aW1lclN0b3AoKSB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZSk7XHJcbiAgICB0aGlzLnRpbWVyID0gJzA6MDAnO1xyXG4gICAgdGhpcy5yZW5kZXJUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgdGltZXJQYXVzZSgpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclRpbWVyKCkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKS5pbm5lckhUTUwgPSB0aGlzLnRpbWVyO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMudGltZXJTdG9wKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbnVsbDtcclxuICAgIHRoaXMuY2FsY0N1cnJlbnRUaW1lKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy50aW1lclN0b3AoKTtcclxuICAgIHRoaXMuc2VjVG9NaW5BbmRTZWMoKTtcclxuICAgIHRoaXMucmVuZGVyVGltZXIoKTtcclxuXHJcbiAgICB0aGlzLmNhbGNDdXJyZW50VGltZSgpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgQm9hcmQgZnJvbSAnLi9Cb2FyZC5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcbmhlYWRlci5jbGFzc0xpc3QuYWRkKCdoZWFkZXInKTtcclxuaGVhZGVyLmlubmVySFRNTCA9ICc8aDEgY2xhc3M9XCJoZWFkaW5nXCI+Z2VtIHB1enpsZTwvaDE+JztcclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG5cclxuY29uc3QgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5tZW51LmNsYXNzTGlzdC5hZGQoJ21lbnUnKTtcclxuXHJcbm1lbnUuaW5uZXJIVE1MID0gYCAgXHJcbiAgPGRpdiBjbGFzcz1cInNldHRpbmdzXCI+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWUgYnRuXCI+TmV3PC9idXR0b24+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwic2F2ZSBidG5cIj5TYXZlPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwibG9hZCBidG5cIj5Mb2FkPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwic291bmQgYnRuICR7Ym9hcmQuc291bmRPbiA/ICdidG4tb24nIDogJyd9XCI+U291bmQ8L2J1dHRvbj5cclxuICAgIDxkaXYgY2xhc3M9XCJzaXplXCI+XHJcbiAgICAgIDxzZWxlY3QgaWQ9XCJmaWVsZFNpemVcIj5cclxuICAgICAgPG9wdGlvbiBzZWxlY3RlZD1cInNlbGVjdGVkXCIgdmFsdWU9XCI0XCIgZGlzYWJsZWQ+RmllbGQgc2l6ZTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCIzXCI+Mzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI0XCI+NDwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI1XCI+NTwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI2XCI+Njwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI3XCI+Nzwvb3B0aW9uPlxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCI4XCI+ODwvb3B0aW9uPlxyXG4gICAgICA8L3NlbGVjdD5cclxuICAgIDwvZGl2PlxyXG4gICAgPGJ1dHRvbiBjbGFzcz1cImNoZWF0IGJ0blwiPkNIRUFUPC9idXR0b24+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cImNvdW50ZXJzXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwidGltZXJcIj48c3Bhbj5UaW1lcjo8L3NwYW4+PHNwYW4gY2xhc3M9XCJ0aW1lXCI+MDowMDwvc3Bhbj48L2Rpdj5cclxuICAgIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDwvZGl2PmA7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lbnUpO1xyXG5cclxuYm9hcmQuaW5pdCgpO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy1nYW1lJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgYm9hcmQuaW5pdCgpO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYXZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXHJcbiAgICAnZ2FtZVNhdmUnLFxyXG4gICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBiZ1Bvc2l0aW9uOiBib2FyZC5iZ1Bvc0FycixcclxuICAgICAgaGlzdG9yeTogYm9hcmQuaGlzdG9yeSxcclxuICAgICAgc2l6ZTogYm9hcmQuc2l6ZSxcclxuICAgICAgYm9hcmRUYWJsZTogYm9hcmQuYXJyLFxyXG4gICAgICB0aW1lOiBib2FyZC50aW1lckMuY3VycmVudFRpbWUsXHJcbiAgICAgIG1vdmVzOiBib2FyZC5tb3Zlc0NvdW50ZXIsXHJcbiAgICAgIHplcm86IFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSxcclxuICAgICAgaW1nTnVtYjogYm9hcmQuaW1nTnVtYlxyXG4gICAgfSlcclxuICApO1xyXG59KTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY29uc3QgeyBiZ1Bvc2l0aW9uLCBoaXN0b3J5LCBzaXplLCBib2FyZFRhYmxlLCB0aW1lLCBtb3ZlcywgemVybywgaW1nTnVtYiB9ID0gSlNPTi5wYXJzZShcclxuICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYW1lU2F2ZScpXHJcbiAgKTtcclxuICBib2FyZC5iZ1Bvc0FyciA9IGJnUG9zaXRpb247XHJcbiAgYm9hcmQuaGlzdG9yeSA9IGhpc3Rvcnk7XHJcbiAgYm9hcmQuc2l6ZSA9IHNpemU7XHJcbiAgYm9hcmQudGltZXJDLmN1cnJlbnRUaW1lID0gdGltZTtcclxuICBib2FyZC5tb3Zlc0NvdW50ZXIgPSBtb3ZlcztcclxuICBib2FyZC5hcnIgPSBib2FyZFRhYmxlO1xyXG4gIFsgYm9hcmQuZW1wdHlYLCBib2FyZC5lbXB0eVkgXSA9IHplcm87XHJcbiAgYm9hcmQuaW1nTnVtYiA9IGltZ051bWI7XHJcbiAgYm9hcmQubG9hZCgpO1xyXG4gIGJvYXJkLnRpbWVyQy5sb2FkKCk7XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpZWxkU2l6ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuICBib2FyZC5pbml0KCk7XHJcbiAgYm9hcmQudGltZXJDLmluaXQoKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hlYXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBib2FyZC50aW1lckMudGltZXJQYXVzZSgpO1xyXG4gIGJvYXJkLmJhY2soKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc291bmQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICBib2FyZC50b2dnbGVTb3VuZCgpO1xyXG4gIGlmIChib2FyZC5zb3VuZE9uKSB7XHJcbiAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2J0bi1vbicpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2J0bi1vbicpO1xyXG4gIH1cclxufSk7XHJcbiIsImltcG9ydCBUaW1lciBmcm9tICcuL1RpbWVyLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudGltZXJDID0gbmV3IFRpbWVyKCk7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMuc2l6ZSA9IDQ7XHJcbiAgICB0aGlzLmVtcHR5WCA9IDA7XHJcbiAgICB0aGlzLmVtcHR5WSA9IDA7XHJcbiAgICB0aGlzLmFuaW1hdGlvblRpbWUgPSAyMDA7XHJcblxyXG4gICAgdGhpcy5ib2FyZFdpZHRoID0gNDAuODtcclxuICAgIHRoaXMubWFyZ2luU2l6ZSA9IDAuMTtcclxuICAgIHRoaXMuc291bmRPbiA9IHRydWU7XHJcbiAgICB0aGlzLndpblNvdW5kID0gbmV3IEF1ZGlvKCcuLi9hc3NldHMvd2luLm1wMycpO1xyXG4gICAgdGhpcy5zbGlkZVNvdW5kID0gbmV3IEF1ZGlvKCcuLi9hc3NldHMvc2xpZGUubXAzJyk7XHJcbiAgICB0aGlzLnNsaWRlU291bmQudm9sdW1lID0gMC4yO1xyXG4gICAgdGhpcy5yZW1vdmVCb2FyZCA9ICgpID0+IHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJvYXJkJykuZm9yRWFjaCgoZWxlbSkgPT4ge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHJhbmRvbUltZ051bWJlcihtYXgsIG1pbikge1xyXG4gICAgdGhpcy5pbWdOdW1iID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pO1xyXG4gIH1cclxuXHJcbiAgYmFjaygpIHtcclxuICAgIHRoaXMuaGlzdG9yeS5wb3AoKTtcclxuICAgIHRoaXMuYmFja1RpbWVyKCk7XHJcbiAgfVxyXG5cclxuICBiYWNrVGltZXIoKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuaGlzdG9yeS5sZW5ndGgpIHtcclxuICAgICAgICBjb25zdCBbIHgsIHkgXSA9IHRoaXMuaGlzdG9yeS5wb3AoKTtcclxuICAgICAgICB0aGlzLmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW3hdW3ldfWApO1xyXG5cclxuICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oWyB4LCB5IF0pO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHRlbXAgPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3hdW3ldO1xyXG4gICAgICAgICAgdGhpcy5hcnJbeF1beV0gPSB0ZW1wO1xyXG4gICAgICAgICAgdGhpcy5lbXB0eVggPSB4O1xyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgPSB5O1xyXG4gICAgICAgICAgdGhpcy5yZW1vdmVCb2FyZCgpO1xyXG4gICAgICAgICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG4gICAgICAgICAgdGhpcy5wbGF5U2xpZGVTb3VuZCgpO1xyXG4gICAgICAgICAgdGhpcy5iYWNrVGltZXIoKTtcclxuICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tXaW4oKSkge1xyXG4gICAgICAgIHRoaXMuc2V0V2luTWVzc2FnZSh0cnVlKTtcclxuICAgICAgICB0aGlzLnBsYXlXaW5Tb3VuZCgpO1xyXG4gICAgICB9XHJcbiAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xyXG4gIH1cclxuXHJcbiAgbW92ZShkaXJlY3Rpb24pIHtcclxuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3VwJzpcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCAhPT0gMCAmJlxyXG4gICAgICAgICAgKHRoaXMuaGlzdG9yeS5sZW5ndGggPD0gMiB8fCB0aGlzLmVtcHR5WCAtIDEgIT09IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMl1bMF0pXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVggLSAxXVt0aGlzLmVtcHR5WV07XHJcbiAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgICB0aGlzLmVtcHR5WCAtPSAxO1xyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY291bnRlciAtPSAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlYICsgMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVswXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCArIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlYICs9IDE7XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb3VudGVyIC09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEgJiZcclxuICAgICAgICAgICh0aGlzLmhpc3RvcnkubGVuZ3RoIDw9IDIgfHwgdGhpcy5lbXB0eVkgKyAxICE9PSB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDJdWzFdKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdO1xyXG4gICAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZICsgMV0gPSAwO1xyXG4gICAgICAgICAgdGhpcy5lbXB0eVkgKz0gMTtcclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNvdW50ZXIgLT0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuZW1wdHlZICE9PSAwICYmXHJcbiAgICAgICAgICAodGhpcy5oaXN0b3J5Lmxlbmd0aCA8PSAyIHx8IHRoaXMuZW1wdHlZIC0gMSAhPT0gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAyXVsxXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVkgLSAxXTtcclxuICAgICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSAtIDFdID0gMDtcclxuICAgICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb3VudGVyIC09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb2FyZCgpIHtcclxuICAgIGNvbnN0IGFyciA9IFtdO1xyXG5cclxuICAgIHRoaXMuYmdQb3NBcnIgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIGFycltpXVtqXSA9IGkgKiB0aGlzLnNpemUgKyBqICsgMTtcclxuICAgICAgICAgIHRoaXMuYmdQb3NBcnIucHVzaChcclxuICAgICAgICAgICAgYCR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBqKX0lICR7TWF0aC5yb3VuZCgxMDAgLyAodGhpcy5zaXplIC0gMSkgKiBpKX0lYFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYXJyW2ldW2pdID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbiAgfVxyXG5cclxuICBzaHVmZmxlKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICBmb3IgKHRoaXMuY291bnRlciA9IDA7IHRoaXMuY291bnRlciA8IHRoaXMuc2l6ZSAqKiAzOyB0aGlzLmNvdW50ZXIgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgLy8gIE1PVkUgVVBcclxuXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcblxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgIHRoaXMubW92ZSgncmlnaHQnKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ2Rvd24nKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVuZGVyQm9hcmQoKSB7XHJcbiAgICBsZXQgYm9hcmQgPSAnJztcclxuICAgIGNvbnN0IGJvYXJkV2lkdGggPSBgJHt0aGlzLmJvYXJkV2lkdGh9cmVtYDtcclxuICAgIGxldCBjZWxsTnVtYmVyO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwLCBvcmRlciA9IDE7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgY2VsbE51bWJlciA9IHRoaXMuYXJyW2ldW2pdO1xyXG5cclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuXHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlID0gISF0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBiR3BvcyA9IHRoaXMuYmdQb3NBcnJbY2VsbE51bWJlciAtIDFdO1xyXG4gICAgICAgIGNvbnN0IGJnRm9yQ2VsbCA9IHRoaXMuYXJyW2ldW2pdXHJcbiAgICAgICAgICA/IGBiYWNrZ3JvdW5kOiB1cmwoLi4vYXNzZXRzL2ltYWdlcy8ke3RoaXNcclxuICAgICAgICAgICAgICAuaW1nTnVtYn0uanBnKTsgYmFja2dyb3VuZC1wb3NpdGlvbjogJHtiR3Bvc307IGJhY2tncm91bmQtc2l6ZTogJHtib2FyZFdpZHRofTtgXHJcbiAgICAgICAgICA6ICcnO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcblxyXG4gICAgICAgIGJvYXJkICs9IGA8ZGl2IFxyXG4gICAgICAgICAgc3R5bGU9J3dpZHRoOiR7dGhpcy5jZWxsU2l6ZX1yZW07XHJcbiAgICAgICAgICBoZWlnaHQ6JHt0aGlzLmNlbGxTaXplfXJlbTtcclxuICAgICAgICAgIG9yZGVyOiR7b3JkZXJ9O1xyXG4gICAgICAgICAgJHtiZ0ZvckNlbGx9J1xyXG4gICAgICAgICAgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfSdcclxuICAgICAgICAgIGNsYXNzPScke2NsYXNzTmFtZX0nXHJcbiAgICAgICAgICBkcmFnZ2FibGU9XCIke2RyYWdnYWJsZX1cIj4ke2NlbGxOdW1iZXJ9PC9kaXY+YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcclxuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBib2FyZFdpZHRoO1xyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgZHJhdygpIHtcclxuICAgIGNvbnN0IHJlbVBlclRpY2sgPSB0aGlzLmNlbGxTaXplIC8gdGhpcy5hbmltYXRpb25UaW1lICogdGhpcy50aW1lUGFzc2VkO1xyXG4gICAgc3dpdGNoICh0aGlzLmRpcmVjdGlvbikge1xyXG4gICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7LXJlbVBlclRpY2t9cmVtKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAwLCAke3JlbVBlclRpY2t9cmVtKWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAkey1yZW1QZXJUaWNrfXJlbSwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoICR7cmVtUGVyVGlja31yZW0sIDApYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbW92ZUFuaW1hdGlvbihbIHgsIHkgXSkge1xyXG4gICAgaWYgKHRoaXMuZW1wdHlYIDwgeCkge1xyXG4gICAgICB0aGlzLmRpcmVjdGlvbiA9ICd1cCc7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlYID4geCkge1xyXG4gICAgICB0aGlzLmRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eVkgPCB5KSB7XHJcbiAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSA+IHkpIHtcclxuICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW5BbmltYXRpb24gPSB0cnVlO1xyXG4gICAgdGhpcy5zdGFydCA9IERhdGUubm93KCk7XHJcblxyXG4gICAgdGhpcy50aW1lciA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgdGhpcy50aW1lUGFzc2VkID0gRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnQ7XHJcblxyXG4gICAgICBpZiAodGhpcy50aW1lUGFzc2VkID49IHRoaXMuYW5pbWF0aW9uVGltZSkge1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7XHJcbiAgICAgICAgdGhpcy5pbkFuaW1hdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9LCAyMCk7XHJcbiAgfVxyXG5cclxuICB0b2dnbGVTb3VuZCgpIHtcclxuICAgIHRoaXMuc291bmRPbiA9ICF0aGlzLnNvdW5kT247XHJcbiAgfVxyXG5cclxuICBzd2FwKG51bWJlcikge1xyXG4gICAgaWYgKHRoaXMuaW5BbmltYXRpb24pIHJldHVybjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYXJyLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5hcnJbaV0ubGVuZ3RoOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAodGhpcy5hcnJbaV1bal0gPT09IG51bWJlcikge1xyXG4gICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAoTWF0aC5hYnModGhpcy5lbXB0eVggLSBpKSA8PSAxICYmIHRoaXMuZW1wdHlZIC0gaiA9PT0gMCkgfHxcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlZIC0gaikgPD0gMSAmJiB0aGlzLmVtcHR5WCAtIGkgPT09IDApXHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgLy8gTW92ZSBjb3VudGVyXHJcbiAgICAgICAgICAgIHRoaXMubW92ZXNDb3VudGVyICs9IDE7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB6ZXJvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldfWApO1xyXG4gICAgICAgICAgICB0aGlzLmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY2VsbC0ke3RoaXMuYXJyW2ldW2pdfWApO1xyXG5cclxuICAgICAgICAgICAgLy8gIGZpbmQgd2hlcmUgYXJlIHdlIG1vdmluZ1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oWyBpLCBqIF0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5wbGF5U2xpZGVTb3VuZCgpO1xyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHplcm8uc3R5bGUub3JkZXI7XHJcbiAgICAgICAgICAgICAgemVyby5zdHlsZS5vcmRlciA9IHRoaXMuZS5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUub3JkZXIgPSB0ZW1wO1xyXG5cclxuICAgICAgICAgICAgICB0aGlzLmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5WCA9PT0gdGhpcy5lbXB0eVkgJiYgdGhpcy5lbXB0eVkgPT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrV2luKCkpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy50aW1lckMudGltZXJQYXVzZSgpO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnNldFdpbk1lc3NhZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5V2luU291bmQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMuYW5pbWF0aW9uVGltZSk7XHJcbiAgICAgICAgICAgIFsgdGhpcy5hcnJbaV1bal0sIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gXSA9IFtcclxuICAgICAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldLFxyXG4gICAgICAgICAgICAgIHRoaXMuYXJyW2ldW2pdXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlYID0gaTtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eVkgPSBqO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNoZWNrV2luKCkge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemU7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZTsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKGkgKyBqICE9PSAodGhpcy5zaXplIC0gMSkgKiAyKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy53aW5baV1bal0gIT09IHRoaXMuYXJyW2ldW2pdKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBzZXRXaW5NZXNzYWdlKGNoZWF0KSB7XHJcbiAgICB0aGlzLndpbkJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvYXJkJyk7XHJcbiAgICB0aGlzLndpbkJvYXJkLmNsYXNzTGlzdC5hZGQoJ3dpbicpO1xyXG5cclxuICAgIHRoaXMud2luQm9hcmQuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKC4uL2Fzc2V0cy9pbWFnZXMvJHt0aGlzXHJcbiAgICAgIC5pbWdOdW1ifS5qcGcpO1wiIGNsYXNzPSd3aW4tdGV4dCc+JHtjaGVhdFxyXG4gICAgICA/ICfQp9CY0KLQldCgISdcclxuICAgICAgOiBg0KPRgNCwISDQktGLINGA0LXRiNC40LvQuCDQs9C+0LvQvtCy0L7Qu9C+0LzQutGDINC30LAgJHtkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGltZScpXHJcbiAgICAgICAgICAuaW5uZXJIVE1MfSDQuCAke2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MfSDRhdC+0LTQvtCyPC9kaXY+YH08L2Rpdj5gO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMud2luQm9hcmQucXVlcnlTZWxlY3RvcignLndpbi10ZXh0Jykuc3R5bGUub3BhY2l0eSA9IDE7XHJcbiAgICB9LCA1MCk7XHJcbiAgfVxyXG5cclxuICBwbGF5V2luU291bmQoKSB7XHJcbiAgICBpZiAoIXRoaXMuc291bmRPbikgcmV0dXJuO1xyXG4gICAgdGhpcy53aW5Tb3VuZC5jdXJyZW50VGltZSA9IDA7XHJcbiAgICB0aGlzLndpblNvdW5kLnBsYXkoKTtcclxuICB9XHJcblxyXG4gIHBsYXlTbGlkZVNvdW5kKCkge1xyXG4gICAgaWYgKCF0aGlzLnNvdW5kT24pIHJldHVybjtcclxuICAgIHRoaXMuc2xpZGVTb3VuZC5jdXJyZW50VGltZSA9IDA7XHJcbiAgICB0aGlzLnNsaWRlU291bmQucGxheSgpO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMucmFuZG9tSW1nTnVtYmVyKDE1MCwgMSk7XHJcbiAgICB0aGlzLmhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnNpemUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmllbGRTaXplJykudmFsdWU7XHJcblxyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IHBhcnNlRmxvYXQodGhpcy5ib2FyZFdpZHRoIC8gdGhpcy5zaXplIC0gMiAqIHRoaXMubWFyZ2luU2l6ZSkudG9GaXhlZCgzKTtcclxuXHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcblxyXG4gICAgdGhpcy5lbXB0eVggPSB0aGlzLnNpemUgLSAxO1xyXG4gICAgdGhpcy5lbXB0eVkgPSB0aGlzLnNpemUgLSAxO1xyXG5cclxuICAgIHRoaXMuYXJyID0gdGhpcy5jcmVhdGVCb2FyZCgpO1xyXG4gICAgdGhpcy53aW4gPSB0aGlzLmNyZWF0ZUJvYXJkKCk7XHJcblxyXG4gICAgdGhpcy5zaHVmZmxlKCk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG4gICAgdGhpcy50aW1lckMuaW5pdCgpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgdGhpcy5jZWxsU2l6ZSA9IHBhcnNlRmxvYXQodGhpcy5ib2FyZFdpZHRoIC8gdGhpcy5zaXplIC0gMiAqIHRoaXMubWFyZ2luU2l6ZSkudG9GaXhlZCgzKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkKCk7XHJcbiAgICB0aGlzLnJlbmRlckJvYXJkKCk7XHJcbiAgICB0aGlzLndpbiA9IHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMudGltZXJDLmluaXQoKTtcclxuXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpLmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGV2dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVsZW0gPSBldnQudGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuc3dhcChwYXJzZUludChlbGVtLmlubmVySFRNTCwgMTApKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVyKTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJhZ0Ryb3ApO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9