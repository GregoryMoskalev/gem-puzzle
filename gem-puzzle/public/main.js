(()=>{"use strict";const t=new class{constructor(){this.history=[],this.size=4,this.emptyX=0,this.emptyY=0,this.arr=[],this.movesCounter=null,this.animationTime=300,this.cellSize=104,this.removeBoard=()=>{document.querySelectorAll(".board").forEach((t=>{document.body.removeChild(t)}))}}move(t){switch(t){case"up":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX-1][this.emptyY],this.arr[this.emptyX-1][this.emptyY]=0,this.emptyX-=1;break;case"down":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX+1][this.emptyY],this.arr[this.emptyX+1][this.emptyY]=0,this.emptyX+=1;break;case"right":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY+1],this.arr[this.emptyX][this.emptyY+1]=0,this.emptyY+=1;break;case"left":this.arr[this.emptyX][this.emptyY]=this.arr[this.emptyX][this.emptyY-1],this.arr[this.emptyX][this.emptyY-1]=0,this.emptyY-=1;break;default:throw new Error(">:(")}}shuffle(){this.history.push([this.emptyX,this.emptyY]);for(let t=0;t<this.size**3;t+=1)switch(Math.floor(4*Math.random())){case 0:0!==this.emptyX?this.move("up"):this.move("down"),this.history.push([this.emptyX,this.emptyY]);break;case 1:this.emptyY!==this.size-1?this.move("right"):this.move("left"),this.history.push([this.emptyX,this.emptyY]);break;case 2:this.emptyX!==this.size-1?this.move("down"):this.move("up"),this.history.push([this.emptyX,this.emptyY]);break;case 3:0!==this.emptyY?this.move("left"):(this.move("right"),this.history.push([this.emptyX,this.emptyY]));break;default:throw t-=1,new Error(">:(")}}renderBoard(){this.movesCounter=0,document.querySelector(".move").innerHTML=this.movesCounter;let t,e="";for(let s=0,i=1;s<this.size;s+=1)for(let r=0;r<this.size;r+=1){t=this.arr[s][r];const h=this.arr[s][r]?"cell":"cell empty",a=!!this.arr[s][r];i+=1,e+=`<div style='order:${i};' id='cell-${t}' class='${h}' draggable="${a}">${t}</div>`}const s=document.createElement("div");s.classList.add("board"),s.innerHTML=e,document.body.appendChild(s)}createBoard(){this.emptyX=this.size-1,this.emptyY=this.size-1;for(let t=0;t<this.size;t+=1){this.arr[t]=[];for(let e=0;e<this.size;e+=1)t+e!==2*(this.size-1)?this.arr[t][e]=t*this.size+e+1:this.arr[t][e]=0}}draw(){const t=this.cellSize/this.animationTime*this.timePassed;switch(this.direction){case"up":this.e.style.transform=`translate( 0, ${-t}px)`;break;case"down":this.e.style.transform=`translate( 0, ${t}px)`;break;case"left":this.e.style.transform=`translate( ${-t}px, 0)`;break;case"right":this.e.style.transform=`translate( ${t}px, 0)`;break;default:throw new Error(">:(")}}moveAnimation(){this.start=Date.now(),this.timer=setInterval((()=>{this.timePassed=Date.now()-this.start,this.timePassed>=this.animationTime?clearInterval(this.timer):this.draw()}),20)}swap(t){for(let e=0;e<this.arr.length;e+=1)for(let s=0;s<this.arr[e].length;s+=1)if(this.arr[e][s]===t&&(Math.abs(this.emptyX-e)<=1&&this.emptyY-s==0||Math.abs(this.emptyY-s)<=1&&this.emptyX-e==0)){this.movesCounter+=1,document.querySelector(".move").innerHTML=this.movesCounter;const t=document.querySelector("#cell-"+this.arr[this.emptyX][this.emptyY]);return this.e=document.querySelector("#cell-"+this.arr[e][s]),this.emptyX-e<0?(console.log("up!"),this.direction="up",this.moveAnimation()):this.emptyX-e>0?(this.direction="down",this.moveAnimation()):this.emptyY-s<0?(this.direction="left",this.moveAnimation(),console.log("left")):this.emptyY-s>0&&(this.direction="right",this.moveAnimation(),console.log("right")),setTimeout((()=>{const e=t.style.order;t.style.order=this.e.style.order,this.e.style.order=e,this.e.style.transform=""}),this.animationTime),[this.arr[e][s],this.arr[this.emptyX][this.emptyY]]=[this.arr[this.emptyX][this.emptyY],this.arr[e][s]],this.emptyX=e,this.emptyY=s,void console.table(this.arr)}}init(){this.removeBoard(),this.createBoard(),this.shuffle(),this.renderBoard(),console.table(this.arr),document.querySelectorAll(".cell").forEach((t=>{t.addEventListener("mouseup",(t=>{const e=t.target;this.swap(parseInt(e.innerHTML,10))})),t.addEventListener("dragstart",this.dragStart),t.addEventListener("dragover",this.dragOver),t.addEventListener("drop",this.dragDrop),t.addEventListener("dragend",this.dragEnd)}))}},e=document.createElement("header");e.innerHTML='  \n<header class="header">\n  <button class="new-game">New game</button>\n  <div class="timer"><span>Timer:</span><span class="time">0</span></div>\n  <div class="moves"><span>Moves:</span><span class="move">0</span></div>\n</header>',document.body.appendChild(e),t.init(),document.querySelector(".new-game").addEventListener("click",(()=>{t.init()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvYm9hcmQuanMiXSwibmFtZXMiOlsiYm9hcmQiLCJ0aGlzIiwiaGlzdG9yeSIsInNpemUiLCJlbXB0eVgiLCJlbXB0eVkiLCJhcnIiLCJtb3Zlc0NvdW50ZXIiLCJhbmltYXRpb25UaW1lIiwiY2VsbFNpemUiLCJyZW1vdmVCb2FyZCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJlbGVtIiwiYm9keSIsInJlbW92ZUNoaWxkIiwiZGlyZWN0aW9uIiwiRXJyb3IiLCJwdXNoIiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1vdmUiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiY2VsbE51bWJlciIsIm9yZGVyIiwiaiIsImNsYXNzTmFtZSIsImRyYWdnYWJsZSIsImVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJweFBlclRpY2siLCJ0aW1lUGFzc2VkIiwiZSIsInN0eWxlIiwidHJhbnNmb3JtIiwic3RhcnQiLCJEYXRlIiwibm93IiwidGltZXIiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJkcmF3IiwibnVtYmVyIiwibGVuZ3RoIiwiYWJzIiwiemVybyIsImNvbnNvbGUiLCJsb2ciLCJtb3ZlQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInRlbXAiLCJ0YWJsZSIsImNyZWF0ZUJvYXJkIiwic2h1ZmZsZSIsInJlbmRlckJvYXJkIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJzd2FwIiwicGFyc2VJbnQiLCJkcmFnU3RhcnQiLCJkcmFnT3ZlciIsImRyYWdEcm9wIiwiZHJhZ0VuZCIsImhlYWRlciIsImluaXQiXSwibWFwcGluZ3MiOiJtQkFHQSxNQUFNQSxFQUFRLElDSEMsTUFDYixjQUNFQyxLQUFL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LFNBQVMsS0FDNUQvRCxFQUFNeUUsVyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJvYXJkIGZyb20gJy4vYm9hcmQuanMnO1xyXG4vLyBpbXBvcnQgVGltZXIgZnJvbSAnLi90aW1lci5qcyc7XHJcblxyXG5jb25zdCBib2FyZCA9IG5ldyBCb2FyZCgpO1xyXG5cclxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJyk7XHJcblxyXG5oZWFkZXIuaW5uZXJIVE1MID0gYCAgXHJcbjxoZWFkZXIgY2xhc3M9XCJoZWFkZXJcIj5cclxuICA8YnV0dG9uIGNsYXNzPVwibmV3LWdhbWVcIj5OZXcgZ2FtZTwvYnV0dG9uPlxyXG4gIDxkaXYgY2xhc3M9XCJ0aW1lclwiPjxzcGFuPlRpbWVyOjwvc3Bhbj48c3BhbiBjbGFzcz1cInRpbWVcIj4wPC9zcGFuPjwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJtb3Zlc1wiPjxzcGFuPk1vdmVzOjwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vdmVcIj4wPC9zcGFuPjwvZGl2PlxyXG48L2hlYWRlcj5gO1xyXG5cclxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG5cclxuYm9hcmQuaW5pdCgpO1xyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy1nYW1lJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgYm9hcmQuaW5pdCgpO1xyXG59KTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XHJcbiAgICB0aGlzLnNpemUgPSA0O1xyXG4gICAgdGhpcy5lbXB0eVggPSAwO1xyXG4gICAgdGhpcy5lbXB0eVkgPSAwO1xyXG4gICAgdGhpcy5hcnIgPSBbXTtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gbnVsbDtcclxuICAgIHRoaXMuYW5pbWF0aW9uVGltZSA9IDMwMDtcclxuICAgIHRoaXMuY2VsbFNpemUgPSAxMDQ7XHJcbiAgICB0aGlzLnJlbW92ZUJvYXJkID0gKCkgPT4ge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9hcmQnKS5mb3JFYWNoKChlbGVtKSA9PiB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gbGV0IHNpemUgPSA0O1xyXG5cclxuICBtb3ZlKGRpcmVjdGlvbikge1xyXG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gPSB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXTtcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WCAtIDFdW3RoaXMuZW1wdHlZXSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbXB0eVggLT0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYICsgMV1bdGhpcy5lbXB0eVldID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WCArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXSA9IHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdO1xyXG4gICAgICAgIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WSArIDFdID0gMDtcclxuICAgICAgICB0aGlzLmVtcHR5WSArPSAxO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldID0gdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV07XHJcbiAgICAgICAgdGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZIC0gMV0gPSAwO1xyXG4gICAgICAgIHRoaXMuZW1wdHlZIC09IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc+OignKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNodWZmbGUoKSB7XHJcbiAgICAvLyB0aGlzLmVtcHR5WCA9IHNpemUgLSAxO1xyXG4gICAgLy8gdGhpcy5lbXB0eVkgPSBzaXplIC0gMTtcclxuICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplICoqIDM7IGkgKz0gMSkge1xyXG4gICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoNCAqIE1hdGgucmFuZG9tKCkpKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIFVQXHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBET1dOXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnZG93bicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goWyB0aGlzLmVtcHR5WCwgdGhpcy5lbXB0eVkgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICBpZiAodGhpcy5lbXB0eVkgIT09IHRoaXMuc2l6ZSAtIDEpIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgTEVGVFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ2xlZnQnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKFsgdGhpcy5lbXB0eVgsIHRoaXMuZW1wdHlZIF0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgaWYgKHRoaXMuZW1wdHlYICE9PSB0aGlzLnNpemUgLSAxKSB7XHJcbiAgICAgICAgICAgIC8vICBNT1ZFIERPV05cclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdkb3duJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBVUFxyXG4gICAgICAgICAgICB0aGlzLm1vdmUoJ3VwJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgIGlmICh0aGlzLmVtcHR5WSAhPT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgTU9WRSBMRUZUXHJcbiAgICAgICAgICAgIHRoaXMubW92ZSgnbGVmdCcpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gIE1PVkUgUklHSFRcclxuICAgICAgICAgICAgdGhpcy5tb3ZlKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChbIHRoaXMuZW1wdHlYLCB0aGlzLmVtcHR5WSBdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJz46KCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJCb2FyZCgpIHtcclxuICAgIHRoaXMubW92ZXNDb3VudGVyID0gMDtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb3ZlJykuaW5uZXJIVE1MID0gdGhpcy5tb3Zlc0NvdW50ZXI7XHJcblxyXG4gICAgbGV0IGJvYXJkID0gJyc7XHJcbiAgICBsZXQgY2VsbE51bWJlcjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMCwgb3JkZXIgPSAxOyBpIDwgdGhpcy5zaXplOyBpICs9IDEpIHtcclxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNpemU7IGogKz0gMSkge1xyXG4gICAgICAgIGNlbGxOdW1iZXIgPSB0aGlzLmFycltpXVtqXTtcclxuICAgICAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmFycltpXVtqXSA/ICdjZWxsJyA6ICdjZWxsIGVtcHR5JztcclxuICAgICAgICBjb25zdCBkcmFnZ2FibGUgPSAhIXRoaXMuYXJyW2ldW2pdO1xyXG4gICAgICAgIG9yZGVyICs9IDE7XHJcbiAgICAgICAgYm9hcmQgKz0gYDxkaXYgc3R5bGU9J29yZGVyOiR7b3JkZXJ9OycgaWQ9J2NlbGwtJHtjZWxsTnVtYmVyfScgY2xhc3M9JyR7Y2xhc3NOYW1lfScgZHJhZ2dhYmxlPVwiJHtkcmFnZ2FibGV9XCI+JHtjZWxsTnVtYmVyfTwvZGl2PmA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XHJcblxyXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2FyZDtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQm9hcmQoKSB7XHJcbiAgICB0aGlzLmVtcHR5WCA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICB0aGlzLmVtcHR5WSA9IHRoaXMuc2l6ZSAtIDE7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2l6ZTsgaSArPSAxKSB7XHJcbiAgICAgIHRoaXMuYXJyW2ldID0gW107XHJcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zaXplOyBqICs9IDEpIHtcclxuICAgICAgICBpZiAoaSArIGogIT09ICh0aGlzLnNpemUgLSAxKSAqIDIpIHtcclxuICAgICAgICAgIHRoaXMuYXJyW2ldW2pdID0gaSAqIHRoaXMuc2l6ZSArIGogKyAxO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkcmF3KCkge1xyXG4gICAgY29uc3QgcHhQZXJUaWNrID0gdGhpcy5jZWxsU2l6ZSAvIHRoaXMuYW5pbWF0aW9uVGltZSAqIHRoaXMudGltZVBhc3NlZDtcclxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgY2FzZSAndXAnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAwLCAkey1weFBlclRpY2t9cHgpYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZG93bic6XHJcbiAgICAgICAgdGhpcy5lLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoIDAsICR7cHhQZXJUaWNrfXB4KWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAkey1weFBlclRpY2t9cHgsIDApYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCAke3B4UGVyVGlja31weCwgMClgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignPjooJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQW5pbWF0aW9uKCkge1xyXG4gICAgdGhpcy5zdGFydCA9IERhdGUubm93KCk7XHJcblxyXG4gICAgdGhpcy50aW1lciA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgdGhpcy50aW1lUGFzc2VkID0gRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnQ7XHJcblxyXG4gICAgICBpZiAodGhpcy50aW1lUGFzc2VkID49IHRoaXMuYW5pbWF0aW9uVGltZSkge1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7IC8vINC30LDQutC+0L3Rh9C40YLRjCDQsNC90LjQvNCw0YbQuNGOINGH0LXRgNC10LcgMiDRgdC10LrRg9C90LTRi1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g0L7RgtGA0LjRgdC+0LLQsNGC0Ywg0LDQvdC40LzQsNGG0LjRjiDQvdCwINC80L7QvNC10L3RgiB0aW1lUGFzc2VkLCDQv9GA0L7RiNC10LTRiNC40Lkg0YEg0L3QsNGH0LDQu9CwINCw0L3QuNC80LDRhtC40LhcclxuICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9LCAyMCk7XHJcbiAgfVxyXG5cclxuICBzd2FwKG51bWJlcikge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFyci5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYXJyW2ldLmxlbmd0aDsgaiArPSAxKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXJyW2ldW2pdID09PSBudW1iZXIpIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgKE1hdGguYWJzKHRoaXMuZW1wdHlYIC0gaSkgPD0gMSAmJiB0aGlzLmVtcHR5WSAtIGogPT09IDApIHx8XHJcbiAgICAgICAgICAgIChNYXRoLmFicyh0aGlzLmVtcHR5WSAtIGopIDw9IDEgJiYgdGhpcy5lbXB0eVggLSBpID09PSAwKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vIE1vdmUgY291bnRlclxyXG4gICAgICAgICAgICB0aGlzLm1vdmVzQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW92ZScpLmlubmVySFRNTCA9IHRoaXMubW92ZXNDb3VudGVyO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgemVybyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjZWxsLSR7dGhpcy5hcnJbdGhpcy5lbXB0eVhdW3RoaXMuZW1wdHlZXX1gKTtcclxuICAgICAgICAgICAgdGhpcy5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2NlbGwtJHt0aGlzLmFycltpXVtqXX1gKTtcclxuXHJcbiAgICAgICAgICAgIC8vICBmaW5kIHdoZXJlIGFyZSB3ZSBtb3ZpbmdcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlYIC0gaSA8IDApIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXAhJyk7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW1wdHlYIC0gaSA+IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgICAgICAgICAgICB0aGlzLm1vdmVBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPCAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAnbGVmdCc7XHJcbiAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2xlZnQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5WSAtIGogPiAwKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIHRoaXMubW92ZUFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyaWdodCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gemVyby5zdHlsZS5vcmRlcjtcclxuICAgICAgICAgICAgICB6ZXJvLnN0eWxlLm9yZGVyID0gdGhpcy5lLnN0eWxlLm9yZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS5vcmRlciA9IHRlbXA7XHJcblxyXG4gICAgICAgICAgICAgIHRoaXMuZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuICAgICAgICAgICAgfSwgdGhpcy5hbmltYXRpb25UaW1lKTtcclxuXHJcbiAgICAgICAgICAgIFsgdGhpcy5hcnJbaV1bal0sIHRoaXMuYXJyW3RoaXMuZW1wdHlYXVt0aGlzLmVtcHR5WV0gXSA9IFtcclxuICAgICAgICAgICAgICB0aGlzLmFyclt0aGlzLmVtcHR5WF1bdGhpcy5lbXB0eVldLFxyXG4gICAgICAgICAgICAgIHRoaXMuYXJyW2ldW2pdXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHlYID0gaTtcclxuICAgICAgICAgICAgdGhpcy5lbXB0eVkgPSBqO1xyXG4gICAgICAgICAgICBjb25zb2xlLnRhYmxlKHRoaXMuYXJyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMucmVtb3ZlQm9hcmQoKTtcclxuICAgIHRoaXMuY3JlYXRlQm9hcmQoKTtcclxuICAgIHRoaXMuc2h1ZmZsZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJCb2FyZCgpO1xyXG5cclxuICAgIGNvbnNvbGUudGFibGUodGhpcy5hcnIpO1xyXG5cclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJykuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbSA9IGV2dC50YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5zd2FwKHBhcnNlSW50KGVsZW0uaW5uZXJIVE1MLCAxMCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnQpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXIpO1xyXG5cclxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcmFnRHJvcCk7XHJcblxyXG4gICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzLmRyYWdFbmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=